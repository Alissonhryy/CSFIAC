<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Sistema de gest√£o de cursos CSF + Qualifica√ß√£o e Renda">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>üìö</text></svg>">
    <title>CSF + Qualifica√ß√£o e Renda</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Adicionando SheetJS para leitura de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Adicionando Chart.js para gr√°fico pizza -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Adicionando html2canvas para captura de tela -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --background: #0f172a;
            --sidebar: #020617;
            --surface: #1e293b;
            --surface-hover: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #334155;
            --overlay: rgba(0, 0, 0, 0.7);
            --card: #1e293b; /* Adicionado para consist√™ncia */
        }

        /* Modo Claro */
        :root.light-mode {
            --background: #f8fafc;
            --sidebar: #ffffff;
            --surface: #ffffff;
            --surface-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --card: #ffffff;
            --overlay: rgba(0, 0, 0, 0.5);
        }

        /* ==================== MODO COMPACTO ==================== */
        .compact-mode .course-card {
            padding: 0.75rem !important;
            min-height: auto !important;
        }
        .compact-mode .course-card .course-header {
            margin-bottom: 0.5rem;
        }
        .compact-mode .course-card .course-title {
            font-size: 0.9rem !important;
        }
        .compact-mode .course-card .course-info {
            gap: 0.25rem !important;
        }
        .compact-mode .course-card .course-info-item {
            font-size: 0.75rem !important;
            padding: 0.15rem 0 !important;
        }
        .compact-mode .course-card .course-info-item .material-icons {
            font-size: 14px !important;
        }
        .compact-mode .course-card .status-badge {
            font-size: 0.65rem !important;
            padding: 0.15rem 0.5rem !important;
        }
        .compact-mode .course-card .course-actions button {
            padding: 4px !important;
        }
        .compact-mode .course-card .course-actions .material-icons {
            font-size: 16px !important;
        }
        .compact-mode .courses-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) !important;
            gap: 0.75rem !important;
        }
        .compact-mode .course-note {
            display: none;
        }
        .compact-mode .course-alert {
            padding: 0.5rem !important;
            font-size: 0.75rem !important;
        }

        /* Bot√£o toggle modo compacto */
        .view-toggle-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .view-toggle-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ==================== SKELETON LOADING ==================== */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: linear-gradient(90deg, var(--surface) 25%, var(--surface-hover) 50%, var(--surface) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        .skeleton-card {
            height: 200px;
            border-radius: 16px;
        }
        .skeleton-text {
            height: 1rem;
            margin-bottom: 0.5rem;
        }
        .skeleton-text.short { width: 60%; }
        .skeleton-text.medium { width: 80%; }
        .skeleton-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        /* ==================== ANIMA√á√ïES SUAVES ==================== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .animate-slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        .animate-scale-in {
            animation: scaleIn 0.2s ease-out forwards;
        }
        .page-section {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .page-section:not(.active) {
            opacity: 0;
            transform: translateY(10px);
        }
        .page-section.active {
            animation: fadeIn 0.4s ease-out;
        }
        .course-card, .kpi-card, .instructor-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s ease;
            opacity: 0;
        }
        .collapsible-content.expanded {
            max-height: 2000px;
            opacity: 1;
        }

        /* ==================== BREADCRUMBS ==================== */
        .breadcrumbs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--surface);
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            flex-wrap: wrap;
        }
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }
        .breadcrumb-item:hover {
            color: var(--primary);
        }
        .breadcrumb-item.active {
            color: var(--text-primary);
            font-weight: 500;
            cursor: default;
        }
        .breadcrumb-separator {
            color: var(--text-muted);
        }
        .breadcrumb-item .material-icons {
            font-size: 18px;
        }

        /* ==================== NOTIFICA√á√ïES PUSH ==================== */
        .notification-banner {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 380px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideInRight 0.4s ease-out;
            display: none;
        }
        .notification-banner.show {
            display: block;
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        .notification-banner.hiding {
            animation: slideOutRight 0.3s ease-in forwards;
        }
        @keyframes slideOutRight {
            to { opacity: 0; transform: translateX(100%); }
        }
        .notification-banner-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .notification-banner-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .notification-banner-title .material-icons {
            color: var(--warning);
        }
        .notification-banner-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }
        .notification-banner-close:hover {
            background: var(--surface-hover);
        }
        .notification-banner-body {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .notification-banner-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .notification-badge-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ==================== SWIPE GESTURES (MOBILE) ==================== */
        .swipeable-card {
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
        }
        .swipe-actions {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            display: flex;
            align-items: center;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .swipe-action-btn {
            height: 100%;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            cursor: pointer;
        }
        .swipe-action-btn.edit {
            background: var(--primary);
        }
        .swipe-action-btn.delete {
            background: var(--danger);
        }
        .swipe-action-btn .material-icons {
            font-size: 24px;
        }
        .swipeable-card.swiped .swipe-actions {
            transform: translateX(0);
        }
        .swipeable-card .card-content {
            background: var(--card);
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease;
        }
        .swipeable-card.swiping .card-content {
            transition: none;
        }

        /* ==================== PWA INSTALL PROMPT ==================== */
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            display: none;
            align-items: center;
            gap: 1rem;
            max-width: 90%;
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 100%); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .pwa-install-prompt.show {
            display: flex;
        }
        .pwa-install-icon {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pwa-install-icon .material-icons {
            font-size: 28px;
            color: white;
        }
        .pwa-install-text h4 {
            margin: 0 0 0.25rem;
            color: var(--text-primary);
        }
        .pwa-install-text p {
            margin: 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .pwa-install-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Tema Verde */
        :root.theme-green {
            --primary: #10b981;
            --primary-hover: #059669;
        }
        
        :root.theme-green:not(.light-mode) {
            --background: #0f172a;
            --sidebar: #064e3b;
            --surface: #065f46;
            --surface-hover: #047857;
            --text-primary: #f8fafc;
            --text-secondary: #d1fae5;
            --text-muted: #a7f3d0;
            --border: #10b981;
            --overlay: rgba(15, 23, 42, 0.8);
            --card: #065f46;
        }
        
        :root.theme-green.light-mode {
            --background: #ecfdf5;
            --sidebar: #d1fae5;
            --surface: #a7f3d0;
            --surface-hover: #6ee7b7;
            --text-primary: #064e3b;
            --text-secondary: #065f46;
            --text-muted: #10b981;
            --border: #10b981;
            --overlay: rgba(16, 185, 129, 0.5);
            --card: #d1fae5;
        }
        
        /* Tema Roxo */
        :root.theme-purple {
            --primary: #8b5cf6;
            --primary-hover: #7c3aed;
        }
        
        :root.theme-purple:not(.light-mode) {
            --background: #0f172a;
            --sidebar: #581c87;
            --surface: #6b21a8;
            --surface-hover: #7c3aed;
            --text-primary: #f8fafc;
            --text-secondary: #e9d5ff;
            --text-muted: #ddd6fe;
            --border: #8b5cf6;
            --overlay: rgba(15, 23, 42, 0.8);
            --card: #6b21a8;
        }
        
        :root.theme-purple.light-mode {
            --background: #faf5ff;
            --sidebar: #f3e8ff;
            --surface: #e9d5ff;
            --surface-hover: #ddd6fe;
            --text-primary: #581c87;
            --text-secondary: #6b21a8;
            --text-muted: #8b5cf6;
            --border: #8b5cf6;
            --overlay: rgba(139, 92, 246, 0.5);
            --card: #f3e8ff;
        }

        /* Tema Azul */
        :root.theme-blue {
            --primary: #3b82f6;
            --primary-hover: #2563eb;
        }
        
        :root.theme-blue:not(.light-mode) {
            --background: #0f172a;
            --sidebar: #1e3a8a;
            --surface: #1e40af;
            --surface-hover: #2563eb;
            --text-primary: #f8fafc;
            --text-secondary: #dbeafe;
            --text-muted: #bfdbfe;
            --border: #3b82f6;
            --overlay: rgba(15, 23, 42, 0.8);
            --card: #1e40af;
        }
        
        :root.theme-blue.light-mode {
            --background: #eff6ff;
            --sidebar: #dbeafe;
            --surface: #bfdbfe;
            --surface-hover: #93c5fd;
            --text-primary: #1e3a8a;
            --text-secondary: #1e40af;
            --text-muted: #3b82f6;
            --border: #3b82f6;
            --overlay: rgba(59, 130, 246, 0.5);
            --card: #dbeafe;
        }

        /* Tema Laranja */
        :root.theme-orange {
            --primary: #f97316;
            --primary-hover: #ea580c;
        }
        
        :root.theme-orange:not(.light-mode) {
            --background: #0f172a;
            --sidebar: #7c2d12;
            --surface: #9a3412;
            --surface-hover: #c2410c;
            --text-primary: #f8fafc;
            --text-secondary: #fed7aa;
            --text-muted: #fdba74;
            --border: #f97316;
            --overlay: rgba(15, 23, 42, 0.8);
            --card: #9a3412;
        }
        
        :root.theme-orange.light-mode {
            --background: #fff7ed;
            --sidebar: #ffedd5;
            --surface: #fed7aa;
            --surface-hover: #fdba74;
            --text-primary: #7c2d12;
            --text-secondary: #9a3412;
            --text-muted: #f97316;
            --border: #f97316;
            --overlay: rgba(249, 115, 22, 0.5);
            --card: #ffedd5;
        }

        /* Tema Rosa */
        :root.theme-pink {
            --primary: #ec4899;
            --primary-hover: #db2777;
        }
        
        :root.theme-pink:not(.light-mode) {
            --background: #0f172a;
            --sidebar: #831843;
            --surface: #9f1239;
            --surface-hover: #be185d;
            --text-primary: #f8fafc;
            --text-secondary: #fce7f3;
            --text-muted: #fbcfe8;
            --border: #ec4899;
            --overlay: rgba(15, 23, 42, 0.8);
            --card: #9f1239;
        }
        
        :root.theme-pink.light-mode {
            --background: #fdf2f8;
            --sidebar: #fce7f3;
            --surface: #fbcfe8;
            --surface-hover: #f9a8d4;
            --text-primary: #831843;
            --text-secondary: #9f1239;
            --text-muted: #ec4899;
            --border: #ec4899;
            --overlay: rgba(236, 72, 153, 0.5);
            --card: #fce7f3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-card {
            background: var(--surface);
            padding: 2.5rem;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 2rem;
            justify-content: center;
            flex-direction: column;
        }

        .login-logo .material-icons {
            font-size: 80px;
            color: var(--primary);
        }

        .login-logo h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .login-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 14px;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-direction: column;
            justify-content: center;
        }

        .sidebar-logo .material-icons {
            font-size: 48px;
            color: var(--primary);
        }

        .sidebar-logo h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            text-align: center;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--surface);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--surface);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item .material-icons {
            font-size: 22px;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-details h4 {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .user-details span {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            margin-left: auto;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--surface);
            color: var(--danger);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px;
        }

        /* Bot√£o fixo para abrir sidebar no mobile */
        .mobile-sidebar-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .mobile-sidebar-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .mobile-sidebar-toggle:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .mobile-sidebar-toggle {
                display: flex;
            }
        }

        .search-box {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-box .material-icons {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-box input {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 12px 12px 44px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #7c3aed);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--surface-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-icon {
            padding: 10px;
            aspect-ratio: 1;
        }

        .btn .material-icons {
            transition: transform 0.3s ease;
        }

        .btn:hover .material-icons {
            transform: scale(1.2) rotate(10deg);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Transformando KPI cards em cards interativos com anima√ß√µes */
        .kpi-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .kpi-card:hover::before {
            opacity: 1;
        }

        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .kpi-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .kpi-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.4s ease;
        }

        .kpi-card:hover .kpi-icon {
            transform: rotate(10deg) scale(1.1);
        }

        .kpi-icon::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 14px;
            padding: 2px;
            background: linear-gradient(135deg, currentColor, transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .kpi-card:hover .kpi-icon::after {
            opacity: 0.6;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .kpi-icon.purple { 
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(168, 85, 247, 0.3)); 
            color: #c4b5fd;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }
        .kpi-icon.green { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3)); 
            color: #6ee7b7;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        .kpi-icon.blue { 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3)); 
            color: #93c5fd;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }
        .kpi-icon.orange { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3)); 
            color: #fcd34d;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            transition: all 0.4s ease;
            position: relative;
        }

        .kpi-card:hover .kpi-value {
            transform: scale(1.05);
            color: var(--primary);
        }

        .kpi-label {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            transition: color 0.3s ease;
        }

        .kpi-card:hover .kpi-label {
            color: var(--text-secondary);
        }

        /* Course Cards */
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
        }
        
        /* Tablets grandes - manter 3 colunas */
        @media (max-width: 1400px) and (min-width: 1024px) {
            .courses-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.125rem;
            }
        }
        
        /* Tablets - 2 colunas */
        @media (max-width: 1023px) and (min-width: 769px) {
            .courses-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }
        
        /* Mobile - 1 coluna */
        @media (max-width: 768px) {
            .courses-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* Cards de cursos com anima√ß√µes mais interativas */
        .course-card {
            background: var(--surface);
            border-radius: 14px;
            padding: 1.25rem;
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .course-card:hover::before {
            left: 100%;
        }

        .course-card:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
            border-color: var(--primary);
        }
        
        /* Micro-intera√ß√µes melhoradas */
        .course-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .course-card:active {
            transform: translateY(-2px) scale(0.99);
        }
        
        /* Espa√ßamento consistente - sistema de 8px */
        .course-card * {
            box-sizing: border-box;
        }

        .course-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 0.875rem;
        }

        .course-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            transition: color 0.3s ease;
            line-height: 1.4;
        }

        .course-card:hover .course-title {
            color: var(--primary);
        }

        .course-id {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .course-actions {
            display: flex;
            gap: 4px;
        }

        .course-actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .course-actions button::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 8px;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .course-actions button:hover::before {
            opacity: 0.1;
        }

        .course-actions button:hover {
            transform: scale(1.2) rotate(5deg);
        }

        .course-actions button:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .course-actions button.delete:hover {
            color: var(--danger);
        }

        .course-actions button.drive:hover {
            color: var(--success);
        }

        .course-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .course-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .course-info-item .material-icons {
            font-size: 16px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        /* Estilo para anota√ß√£o do curso no card */
        .course-note {
            background: rgba(99, 102, 241, 0.1);
            border-left: 3px solid var(--primary);
            padding: 6px 10px;
            margin-top: 8px;
            border-radius: 0 6px 6px 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 6px;
        }

        .course-note .material-icons {
            font-size: 14px;
            color: var(--primary);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .course-note-text {
            word-break: break-word;
            line-height: 1.4;
        }
        
        /* Alertas nos cards */
        .course-alert {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            position: relative;
            animation: pulseAlert 2s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }
        
        .course-alert.warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(251, 191, 36, 0.05) 100%);
            border-color: var(--warning);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
        }
        
        .course-alert-icon {
            width: 40px;
            height: 40px;
            background: var(--danger);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            animation: pulseIcon 1.5s ease-in-out infinite;
        }
        
        .course-alert.warning .course-alert-icon {
            background: var(--warning);
        }
        
        .course-alert-content {
            flex: 1;
            min-width: 0;
        }
        
        .course-alert-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .course-alert-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }
        
        .course-alert-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .course-alert.warning .course-alert-action {
            background: var(--warning);
        }
        
        .course-alert-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0.9;
        }
        
        @keyframes pulseAlert {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
            }
            50% {
                box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
            }
        }
        
        @keyframes pulseIcon {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .course-card.has-alert {
            border-color: var(--danger);
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }
        
        .course-card.has-alert.warning-alert {
            border-color: var(--warning);
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
        }

        /* Adicionando anima√ß√£o pulsante aos status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
        }

        .status-badge::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .status-badge.concluido { 
            background: rgba(16, 185, 129, 0.15); 
            color: #34d399;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        .status-badge.andamento { 
            background: rgba(59, 130, 246, 0.15); 
            color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }
        .status-badge.pendente { 
            background: rgba(245, 158, 11, 0.15); 
            color: #fbbf24;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
        }
        .status-badge.cancelado { 
            background: rgba(239, 68, 68, 0.15); 
            color: #f87171;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }

        /* Badges de status mais vis√≠veis e informativos - MELHORADO */
        .status-badge {
            font-size: 0.8rem;
            padding: 6px 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1.5px solid currentColor;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }
        
        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }
        
        .status-badge.concluido { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%); 
            color: #34d399;
            border-color: #34d399;
        }
        .status-badge.andamento { 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%); 
            color: #60a5fa;
            border-color: #60a5fa;
        }
        .status-badge.pendente { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%); 
            color: #fbbf24;
            border-color: #fbbf24;
        }
        .status-badge.cancelado { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%); 
            color: #f87171;
            border-color: #f87171;
        }

        /* Anima√ß√µes de loading mais elaboradas */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-content {
            text-align: center;
            color: white;
            margin-top: 20px;
        }

        /* Feedback visual em a√ß√µes */
        .action-feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Progresso visual nos cards */
        .course-progress {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }

        .course-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-hover));
            border-radius: 2px;
            transition: width 0.6s ease;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        /* A√ß√µes r√°pidas mais acess√≠veis */
        .quick-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .course-card:hover .quick-actions {
            opacity: 1;
        }

        .quick-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .quick-action-btn:hover {
            transform: scale(1.1);
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        /* Estilos para modo de visualiza√ß√£o */
        .view-mode-selector {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .view-mode-btn {
            padding: 8px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .view-mode-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .view-mode-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Estilos para modo lista */
        .courses-list .course-card {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        /* Estilos para modo timeline */
        .courses-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 2rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--surface);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            animation: shake 0.3s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .form-error {
            color: var(--danger);
            font-size: 0.75rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Label opcional para campos n√£o obrigat√≥rios */
        .optional-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 400;
            margin-left: 4px;
        }

        /* Calendar */
        .calendar-container {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            /* Adicionando efeitos de hover e transi√ß√µes suaves */
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .calendar-container:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            /* Adicionando gradiente sutil no header */
            background: linear-gradient(135deg, var(--surface) 0%, rgba(99, 102, 241, 0.05) 100%);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-nav button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            /* Melhorando anima√ß√µes dos bot√µes de navega√ß√£o */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .calendar-nav button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(99, 102, 241, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .calendar-nav button:hover::before {
            width: 100px;
            height: 100px;
        }

        .calendar-nav button:hover {
            background: var(--surface-hover);
            color: var(--primary);
            transform: scale(1.1);
        }

        .calendar-nav button:active {
            transform: scale(0.95);
        }

        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            /* Adicionando gradiente de texto */
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
        }
        
        .calendar-grid.week-view {
            grid-template-columns: repeat(5, 1fr);
        }
        
        .calendar-grid.week-view .calendar-day {
            min-height: 200px;
        }
        
        .calendar-grid.day-view {
            grid-template-columns: 1fr;
            padding: 1rem;
        }
        
        /* Day View Styles */
        .day-view-container {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 400px;
        }
        
        .day-view-container.today {
            border: 2px solid var(--primary);
        }
        
        .day-view-container.holiday {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.05) 0%, var(--surface) 100%);
        }
        
        .day-view-holiday {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(251, 191, 36, 0.15);
            border-radius: 8px;
            color: var(--warning);
            font-weight: 500;
            margin-bottom: 1rem;
        }
        
        .day-view-empty {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .day-view-empty .material-icons {
            font-size: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .day-view-empty p {
            margin-bottom: 1.5rem;
        }
        
        .day-view-events {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .day-view-event {
            background: var(--background);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .day-view-event:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .day-view-event.status-pendente { border-left-color: #f59e0b; }
        .day-view-event.status-andamento { border-left-color: #3b82f6; }
        .day-view-event.status-concluido { border-left-color: #22c55e; }
        .day-view-event.status-cancelado { border-left-color: #ef4444; opacity: 0.7; }
        
        .day-event-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .day-event-type {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .day-event-type.start {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }
        
        .day-event-type.end {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .day-event-status {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .day-event-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }
        
        .day-event-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .day-event-info span {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .day-event-info .material-icons {
            font-size: 16px;
            color: var(--text-muted);
        }
        
        .day-event-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        .add-event-day-btn {
            margin-top: 1.5rem;
        }
        
        .week-view-day {
            min-height: 180px;
        }
        
        /* Toggle de visualiza√ß√£o */
        .calendar-view-toggle {
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .view-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .view-btn:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .view-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .view-btn .material-icons {
            font-size: 20px;
        }
        
        /* Estat√≠sticas do calend√°rio */
        .calendar-stats {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .calendar-stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .calendar-stat .material-icons {
            font-size: 20px;
            color: var(--primary);
        }
        
        .calendar-stat span:not(.material-icons) {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* A√ß√µes do header do calend√°rio */
        .calendar-header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        #calendarDatePicker {
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-primary);
        }
        
        /* Legenda */
        .calendar-legend {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .legend-title {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        /* Preview tooltip do curso */
        .course-preview-tooltip {
            position: fixed;
            z-index: 10000;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            min-width: 280px;
            max-width: 350px;
            overflow: hidden;
            pointer-events: none;
            animation: tooltipFade 0.2s ease;
        }
        
        @keyframes tooltipFade {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .preview-header {
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark, #4f46e5) 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .preview-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
        }
        
        .preview-status.pendente { background: #f59e0b; }
        .preview-status.andamento { background: #3b82f6; }
        .preview-status.concluido { background: #22c55e; }
        .preview-status.cancelado { background: #ef4444; }
        
        .preview-title {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .preview-body {
            padding: 0.75rem 1rem;
        }
        
        .preview-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .preview-info .material-icons {
            font-size: 16px;
            color: var(--text-muted);
        }
        
        /* Feriados no calend√°rio */
        .calendar-day.holiday {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
        }
        
        .calendar-day.holiday .calendar-date {
            color: var(--warning);
        }
        
        .holiday-name {
            font-size: 0.65rem;
            color: var(--warning);
            font-weight: 500;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Indicador de quantidade de cursos */
        .day-course-count {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary);
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day {
            position: relative;
        }
        
        /* Eventos - Design Clean */
        .calendar-event {
            position: relative;
            padding-left: 10px;
        }
        
        .calendar-event::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 80%;
            border-radius: 2px;
        }
        
        /* Cores por status - apenas indicador lateral */
        .calendar-event.status-pendente {
            background: rgba(245, 158, 11, 0.1);
            color: var(--text-primary);
        }
        .calendar-event.status-pendente::before {
            background: #f59e0b;
        }
        
        .calendar-event.status-andamento {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }
        .calendar-event.status-andamento::before {
            background: #3b82f6;
        }
        
        .calendar-event.status-concluido {
            background: rgba(34, 197, 94, 0.1);
            color: var(--text-primary);
        }
        .calendar-event.status-concluido::before {
            background: #22c55e;
        }
        
        .calendar-event.status-cancelado {
            background: rgba(239, 68, 68, 0.1);
            color: var(--text-muted);
            opacity: 0.6;
            text-decoration: line-through;
        }
        .calendar-event.status-cancelado::before {
            background: #ef4444;
        }
        
        /* Evento de in√≠cio - destaque verde */
        .calendar-event.start {
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%);
            border-left: 3px solid #22c55e;
            padding-left: 6px;
        }
        .calendar-event.start::before {
            display: none;
        }
        .calendar-event.start .event-label {
            color: #22c55e;
            font-weight: 600;
            font-size: 0.6rem;
        }
        
        /* Evento de fim - destaque vermelho */
        .calendar-event.end {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%);
            border-left: 3px solid #ef4444;
            padding-left: 6px;
        }
        .calendar-event.end::before {
            display: none;
        }
        .calendar-event.end .event-label {
            color: #ef4444;
            font-weight: 600;
            font-size: 0.6rem;
        }
        
        .calendar-event.custom-event {
            color: white;
            font-weight: 500;
            padding-left: 8px;
        }
        .calendar-event.custom-event::before {
            display: none;
        }
        
        .calendar-event.more-events {
            background: var(--surface-hover);
            color: var(--text-muted);
            font-size: 0.65rem;
            text-align: center;
            padding-left: 8px;
        }
        .calendar-event.more-events::before {
            display: none;
        }
        
        /* Bot√£o adicionar evento no dia */
        .add-event-btn {
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            opacity: 0.8;
        }
        
        .add-event-btn .material-icons {
            font-size: 14px;
        }
        
        .calendar-day:hover .add-event-btn {
            display: flex;
        }
        
        .add-event-btn:hover {
            transform: scale(1.1);
            opacity: 1;
        }
        
        /* Presets de cor */
        .color-preset {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-preset:hover {
            transform: scale(1.1);
            border-color: var(--text-primary);
        }
        
        /* Cursor para double click */
        .calendar-day:not(.other-month) {
            cursor: pointer;
        }
        
        /* ==================== SISTEMA DE TAREFAS ==================== */
        
        .task-pending-badge {
            background: var(--warning);
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }
        
        .tasks-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .task-stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }
        
        .task-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .task-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-stat-icon .material-icons {
            font-size: 24px;
            color: white;
        }
        
        .task-stat-icon.pending { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .task-stat-icon.today { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .task-stat-icon.overdue { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .task-stat-icon.completed { background: linear-gradient(135deg, #22c55e, #16a34a); }
        
        .task-stat-info {
            display: flex;
            flex-direction: column;
        }
        
        .task-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .task-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .tasks-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .task-filter-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .task-filter-btn .material-icons {
            font-size: 18px;
        }
        
        .task-filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .task-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .tasks-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .task-group {
            margin-bottom: 1.5rem;
        }
        
        .task-group-header {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .task-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: all 0.2s;
            position: relative;
        }
        
        .task-item:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .task-item.completed {
            opacity: 0.7;
            background: var(--surface-hover);
        }
        
        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }
        
        .task-item.overdue {
            border-left: 4px solid var(--danger);
        }
        
        .task-item.today {
            border-left: 4px solid var(--primary);
        }
        
        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .task-checkbox:hover {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }
        
        .task-checkbox.checked .material-icons {
            color: white;
            font-size: 16px;
        }
        
        .task-content {
            flex: 1;
            min-width: 0;
        }
        
        .task-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            flex-shrink: 0;
        }
        
        .task-priority.high {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .task-priority.medium {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }
        
        .task-priority.low {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }
        
        .task-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .task-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .task-meta-item .material-icons {
            font-size: 16px;
        }
        
        .task-meta-item.overdue {
            color: var(--danger);
            font-weight: 500;
        }
        
        .task-actions {
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .task-item:hover .task-actions {
            opacity: 1;
        }
        
        .task-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            background: var(--surface-hover);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .task-action-btn .material-icons {
            font-size: 18px;
        }
        
        .task-action-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .task-action-btn.delete:hover {
            background: var(--danger);
        }
        
        .tasks-empty {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .tasks-empty .material-icons {
            font-size: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .tasks-empty h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        
        /* Subtarefas */
        .subtasks {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px dashed var(--border);
        }
        
        .subtask-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .subtask-item.completed {
            text-decoration: line-through;
            color: var(--text-muted);
        }
        
        .subtask-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .subtask-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }
        
        .subtask-checkbox .material-icons {
            font-size: 14px;
            color: white;
        }
        
        /* Modal de tarefa */
        .subtask-input-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .subtask-list {
            margin-top: 0.75rem;
        }
        
        .subtask-list-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--surface-hover);
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }
        
        .subtask-list-item span {
            flex: 1;
        }
        
        .subtask-remove-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px;
        }
        
        .subtask-remove-btn:hover {
            color: var(--danger);
        }
        
        /* Anima√ß√£o de tarefa conclu√≠da */
        .task-completed-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .task-completed-overlay.show {
            opacity: 1;
        }
        
        .task-completed-content {
            background: var(--surface);
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .task-completed-overlay.show .task-completed-content {
            transform: scale(1);
            animation: celebratePop 0.5s ease;
        }
        
        @keyframes celebratePop {
            0% { transform: scale(0.5); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .task-completed-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            animation: celebrateSpin 0.5s ease;
        }
        
        @keyframes celebrateSpin {
            0% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            100% { transform: rotate(0); }
        }
        
        .task-completed-icon .material-icons {
            font-size: 40px;
            color: white;
        }
        
        .task-completed-content h3 {
            font-size: 1.5rem;
            color: var(--success);
            margin-bottom: 0.5rem;
        }
        
        .task-completed-content p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .calendar-day-header {
            padding: 1rem;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            background: var(--background);
            /* Adicionando anima√ß√£o de pulso nos headers */
            animation: headerPulse 3s ease-in-out infinite;
        }

        @keyframes headerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .calendar-day {
            min-height: 100px;
            padding: 0.5rem;
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            /* Adicionando transi√ß√µes e efeitos hover interativos */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .calendar-day:hover::before {
            opacity: 1;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .calendar-day:nth-child(5n) {
            border-right: none;
        }

        .calendar-day.other-month {
            background: var(--background);
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .calendar-day.other-month:hover {
            opacity: 0.8;
        }

        .calendar-day.today {
            background: rgba(99, 102, 241, 0.1);
            /* Adicionando anima√ß√£o de brilho no dia atual */
            position: relative;
            animation: todayGlow 2s ease-in-out infinite;
        }

        @keyframes todayGlow {
            0%, 100% {
                box-shadow: inset 0 0 20px rgba(99, 102, 241, 0.2);
            }
            50% {
                box-shadow: inset 0 0 30px rgba(99, 102, 241, 0.4);
            }
        }

        .calendar-date {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .calendar-day:hover .calendar-date {
            color: var(--primary);
            transform: scale(1.1);
        }

        .calendar-day.today .calendar-date {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Adicionando anima√ß√£o de pulso no dia atual */
            animation: datePulse 1.5s ease-in-out infinite;
        }

        @keyframes datePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .calendar-event {
            font-size: 0.7rem;
            padding: 3px 6px;
            border-radius: 4px;
            margin-bottom: 3px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
            z-index: 1;
            transition: all 0.2s ease;
            transform-origin: left center;
        }

        .calendar-event:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 20;
            opacity: 1 !important;
        }

        .calendar-event.start { 
            background: var(--success); 
            color: white;
            /* Adicionando anima√ß√£o de entrada */
            animation: eventSlideIn 0.5s ease-out;
        }
        
        .calendar-event.end { 
            background: var(--danger); 
            color: white;
            animation: eventSlideIn 0.5s ease-out;
        }
        
        .calendar-event.ongoing { 
            background: var(--info); 
            color: white;
            animation: eventSlideIn 0.5s ease-out;
        }

        @keyframes eventSlideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Adicionando estilo para o bot√£o "Hoje" */
        #todayBtn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        #todayBtn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        #todayBtn:hover::before {
            width: 200px;
            height: 200px;
        }

        #todayBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        #todayBtn:active {
            transform: translateY(0);
        }

        /* Pages */
        .page-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: pageFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes pageFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Instructors */
        .instructor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .instructor-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            text-align: center;
        }

        .instructor-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            margin: 0 auto 1rem;
        }

        .instructor-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .instructor-specialty {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .instructor-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .instructor-stat {
            text-align: center;
        }

        .instructor-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .instructor-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .instructor-actions {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .instructor-actions .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .instructor-actions .btn-whatsapp:hover {
            background: #128C7E;
        }

        /* Settings */
        .settings-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .settings-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text);
        }

        .settings-card h3 .material-icons {
            color: var(--primary);
            font-size: 28px;
        }

        .settings-card .description {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 3.5rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.02) 0%, rgba(99, 102, 241, 0.05) 100%);
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .file-upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-upload-area:hover::before {
            opacity: 1;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(99, 102, 241, 0.12) 100%);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15);
        }

        .file-upload-area .material-icons {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 1.25rem;
            display: block;
            transition: transform 0.3s ease;
        }

        .file-upload-area:hover .material-icons {
            transform: scale(1.1);
        }

        .file-upload-area .upload-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin: 0 0 0.75rem 0;
            line-height: 1.4;
        }

        .file-upload-area .upload-subtitle {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin: 0.5rem 0;
            line-height: 1.5;
        }

        .file-upload-area .upload-formats {
            font-size: 0.875rem;
            color: var(--primary);
            margin: 0.75rem 0 0.5rem 0;
            font-weight: 500;
        }

        .file-upload-area .upload-columns {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0.5rem auto 0 auto;
            max-width: 90%;
            line-height: 1.4;
        }

        .file-info {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: var(--background);
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .file-info .material-icons {
            color: var(--primary);
            font-size: 24px;
        }

        .file-info p {
            margin: 0;
            font-size: 0.95rem;
            color: var(--text);
            font-weight: 500;
        }

        .export-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .export-actions .btn {
            justify-content: center;
        }

        .danger-zone {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(239, 68, 68, 0.02) 100%);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .danger-zone-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ef4444;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .danger-zone-title .material-icons {
            font-size: 20px;
        }

        .danger-zone-description {
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }


        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state .material-icons {
            font-size: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
            opacity: 0;
            transform: translateX(120%);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            min-width: 320px;
            max-width: 500px;
            position: relative;
            overflow: hidden;
        }
        
        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }
        
        .toast .material-icons {
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .toast span:last-child {
            flex: 1;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .toast .toast-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .toast .toast-close:hover {
            opacity: 1;
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .toast.success { 
            border-left: 4px solid var(--success);
            color: var(--success);
        }
        .toast.error { 
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }
        .toast.warning { 
            border-left: 4px solid var(--warning);
            color: var(--warning);
        }
        .toast.info { 
            border-left: 4px solid var(--info);
            color: var(--info);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Users Section */
        .users-table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th,
        .users-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .users-table th {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        .users-table tr:hover td {
            background: var(--surface-hover);
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .role-badge.admin { background: rgba(239, 68, 68, 0.15); color: #f87171; }
        .role-badge.editor { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .role-badge.viewer { background: rgba(16, 185, 129, 0.15); color: #34d399; }

        /* Novo layout do Activity Log - estilo timeline moderno */
        .activity-log {
            max-height: 500px;
            overflow-y: auto;
            padding: 1rem;
        }

        .activity-log-grid {
            display: grid;
            gap: 0;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 1rem 0;
            position: relative;
        }

        .activity-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 18px;
            top: 48px;
            bottom: -8px;
            width: 2px;
            background: var(--border);
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }

        .activity-icon.add { background: var(--success); color: white; }
        .activity-icon.edit { background: var(--info); color: white; }
        .activity-icon.delete { background: var(--danger); color: white; }

        .activity-content {
            flex: 1;
            background: var(--background);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border);
        }

        .activity-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .activity-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--surface);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .activity-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .activity-user {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .activity-user .material-icons {
            font-size: 14px;
        }

        /* Novo layout do Relat√≥rio Geral */
        .report-preview {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 2rem;
            color: #ffffff;
        }

        .report-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .report-header h2 {
            color: #ffffff;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .report-header p {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        .report-kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .report-kpi-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .report-kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
        }

        .report-kpi-label {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            margin-top: 0.25rem;
        }

        .report-kpi-card.green .report-kpi-value { color: #34d399; }
        .report-kpi-card.blue .report-kpi-value { color: #60a5fa; }
        .report-kpi-card.yellow .report-kpi-value { color: #fbbf24; }
        .report-kpi-card.red .report-kpi-value { color: #f87171; }
        .report-kpi-card.purple .report-kpi-value { color: #a78bfa; }

        .report-section {
            margin-bottom: 1.5rem;
        }

        .report-section h3 {
            color: #ffffff;
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-section h3 .material-icons {
            font-size: 20px;
            color: var(--primary);
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .report-table th,
        .report-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .report-table th {
            background: rgba(255,255,255,0.05);
            font-weight: 600;
            color: rgba(255,255,255,0.9);
        }

        .report-table td {
            color: rgba(255,255,255,0.8);
        }

        .report-table tr:hover td {
            background: rgba(255,255,255,0.05);
        }

        .report-chart {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .report-city-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .report-city-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-city-name {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.9);
        }

        .report-city-count {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Course Details */
        .course-detail-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .course-detail-item:last-child {
            border-bottom: none;
        }

        .course-detail-item .material-icons {
            color: var(--primary);
            font-size: 24px;
        }

        .course-detail-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .course-detail-value {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .course-detail-value a {
            color: var(--info);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .course-detail-value a:hover {
            text-decoration: underline;
        }

        /* Se√ß√£o de mudar senha */
        .password-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .courses-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .course-card {
                padding: 1rem;
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .calendar-day {
                min-height: 60px;
            }

            .calendar-event {
                font-size: 0.6rem;
                padding: 2px 4px;
            }

            .report-kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Novo design interativo para a aba de configura√ß√µes */
        .settings-card {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .settings-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), #a855f7, var(--primary));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .settings-card:hover::before {
            transform: scaleX(1);
        }

        .settings-card:hover {
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.12);
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .settings-section-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .settings-icon-large {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
            animation: pulse-glow 3s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5); }
        }

        .settings-icon-large .material-icons {
            font-size: 40px;
            color: white;
        }

        .settings-header-content h3 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 0.5rem 0;
        }

        .settings-header-content p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin: 0;
        }

        .interactive-upload-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Fixed padding to prevent content cutoff */
            padding: 4rem 2.5rem;
            min-height: 350px;
            border: 3px dashed rgba(99, 102, 241, 0.3);
            border-radius: 24px;
            cursor: pointer;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.03), rgba(168, 85, 247, 0.03));
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: visible;
            margin: 2rem 0;
        }

        .interactive-upload-zone::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.2), transparent);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease;
            pointer-events: none;
        }

        .interactive-upload-zone:hover::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .interactive-upload-zone:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(168, 85, 247, 0.08));
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.25);
            border-width: 3px;
        }

        .interactive-upload-zone.drag-over {
            border-color: #a855f7;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(99, 102, 241, 0.15));
            transform: scale(1.05);
        }

        .upload-icon-container {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
        }

        .upload-icon-bg {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.3);
            transition: all 0.4s ease;
            /* Removed z-index that was causing overlap issues */
        }

        .upload-icon-bg .material-icons {
            font-size: 64px;
            color: white;
            animation: bounce-icon 2s ease-in-out infinite;
        }

        @keyframes bounce-icon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .interactive-upload-zone:hover .upload-icon-bg {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 16px 48px rgba(99, 102, 241, 0.4);
        }

        .interactive-upload-zone:hover .upload-icon-bg .material-icons {
            color: white;
        }

        .upload-text-main {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.75rem;
            /* Added margin-top for proper spacing */
            margin-top: 1.5rem;
        }

        .upload-text-sub {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            text-align: center;
            max-width: 90%;
        }

        .upload-format-tags {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .format-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .format-tag .material-icons {
            font-size: 20px;
        }

        .interactive-upload-zone:hover .format-tag {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .file-selected-display {
            display: none;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
            border: 2px solid rgba(34, 197, 94, 0.5);
            border-radius: 16px;
            margin-top: 1.5rem;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s ease;
        }
        
        .file-selected-display.show {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Melhorias de acessibilidade */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Melhorias de performance - will-change */
        .kpi-card,
        .course-card,
        .instructor-card {
            will-change: transform;
        }
        
        /* Melhorias de responsividade */
        @media (max-width: 480px) {
            .modal {
                max-width: 95%;
                margin: 1rem;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .report-kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .toast {
                min-width: auto;
                max-width: calc(100vw - 2rem);
            }
        }


        .file-selected-display .material-icons {
            font-size: 32px;
            color: #22c55e;
        }

        .file-info-text {
            flex: 1;
        }

        .file-info-text strong {
            display: block;
            color: var(--text);
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }

        .file-info-text span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .columns-info-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(99, 102, 241, 0.08));
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .columns-info-card .material-icons {
            font-size: 28px;
            color: var(--primary);
            flex-shrink: 0;
        }

        .columns-info-card strong {
            display: block;
            color: var(--text);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .columns-info-card p {
            color: var(--text-muted);
            margin: 0;
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .export-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .export-button-card {
            background: linear-gradient(135deg, var(--card), rgba(99, 102, 241, 0.02));
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .export-button-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .export-button-card:hover::before {
            left: 100%;
        }

        .export-button-card:hover {
            border-color: var(--primary);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 16px 48px rgba(99, 102, 241, 0.2);
        }

        .export-icon-wrapper {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
        }

        .export-button-card:hover .export-icon-wrapper {
            transform: rotate(360deg) scale(1.1);
        }

        .export-icon-wrapper .material-icons {
            font-size: 40px;
            color: white;
        }

        .export-button-card h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 0.5rem 0;
        }

        .export-button-card p {
            color: var(--text-muted);
            margin: 0;
            font-size: 0.9rem;
        }

        .danger-zone-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(220, 38, 38, 0.05));
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .danger-zone-card:hover {
            border-color: #ef4444;
            box-shadow: 0 20px 40px rgba(239, 68, 68, 0.15);
        }

        .danger-zone-card .settings-icon-large {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse-danger 3s ease-in-out infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 12px 32px rgba(239, 68, 68, 0.5); }
        }

        .danger-warning-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .danger-warning-box .material-icons {
            font-size: 28px;
            color: #ef4444;
        }

        .danger-warning-box p {
            color: var(--text);
            margin: 0;
            line-height: 1.6;
        }

        .danger-warning-box strong {
            color: #ef4444;
        }

        /* Estilos para organiza√ß√£o por LOTE */
        .lote-section {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .lote-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .lote-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lote-count {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .lote-edit-input {
            background: var(--background);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 700;
            width: 300px;
        }

        .lote-edit-actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .lote-edit-actions button {
            padding: 8px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lote-edit-actions button:hover {
            transform: scale(1.1);
        }
        
        /* Busca Avan√ßada e Filtros */
        .advanced-search-panel {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .filter-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .filter-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        /* Notifica√ß√µes e Alertas */
        .notification-bell {
            position: relative;
        }
        
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            z-index: 1000;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        .notifications-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 380px;
            max-height: 500px;
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        
        .notifications-panel.active {
            display: flex;
            flex-direction: column;
        }
        
        .notifications-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notifications-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .notification-item {
            padding: 1.25rem;
            border-radius: 14px;
            margin-bottom: 0.75rem;
            background: var(--background);
            border-left: 4px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .notification-item:hover {
            background: var(--surface-hover);
            transform: translateX(6px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .notification-item.urgent {
            border-left-color: var(--danger);
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.05) 0%, var(--background) 10%);
        }
        
        .notification-item.warning {
            border-left-color: var(--warning);
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.05) 0%, var(--background) 10%);
        }
        
        .notification-item.read {
            opacity: 0.7;
        }
        
        .notification-item.unread {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.08) 0%, var(--background) 20%);
        }
        
        .notification-item.success {
            border-left-color: var(--success);
        }
        
        .notification-item.error {
            border-left-color: var(--danger);
        }
        
        .notification-item.info {
            border-left-color: var(--info);
        }
        
        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--surface-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-item.success .notification-icon { color: var(--success); }
        .notification-item.error .notification-icon { color: var(--danger); }
        .notification-item.warning .notification-icon { color: var(--warning); }
        .notification-item.info .notification-icon { color: var(--info); }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .notification-time {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .notification-unread-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .notification-item.has-course {
            cursor: pointer;
        }
        
        .notification-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: var(--primary);
            margin-top: 4px;
            font-weight: 500;
        }
        
        .notification-item.has-course:hover .notification-link {
            text-decoration: underline;
        }
        
        .notification-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .notif-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--surface-hover);
            color: var(--text-primary);
        }
        
        .notif-action-btn .material-icons {
            font-size: 14px;
        }
        
        .notif-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .notif-action-btn.primary {
            background: var(--primary);
            color: white;
        }
        
        .notif-action-btn.success {
            background: var(--success);
            color: white;
        }
        
        .notif-action-btn.danger {
            background: transparent;
            color: var(--text-muted);
            padding: 5px;
        }
        
        .notif-action-btn.danger:hover {
            background: var(--danger);
            color: white;
        }
        
        .notification-item .notification-delete {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 6px;
            opacity: 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-item:hover .notification-delete {
            opacity: 1;
        }
        
        .notification-item .notification-delete:hover {
            background: var(--surface-hover);
            color: var(--danger);
        }
        
        .notification-item-minimal {
            transition: all 0.2s ease;
        }
        
        .notification-item-minimal:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .notification-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .notification-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Hist√≥rico de Altera√ß√µes */
        .history-timeline {
            position: relative;
            padding-left: 2rem;
        }
        
        .history-item {
            position: relative;
            padding-bottom: 1.5rem;
            border-left: 2px solid var(--border);
            padding-left: 1.5rem;
        }
        
        .history-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }
        
        .history-item:last-child {
            border-left: none;
        }
        
        .history-changes {
            background: var(--background);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }
        
        .history-change-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
        }
        
        .history-change-old {
            color: var(--danger);
            text-decoration: line-through;
        }
        
        .history-change-new {
            color: var(--success);
        }
        
        /* Hist√≥rico de Altera√ß√µes Completo - Timeline */
        .course-history-timeline {
            position: relative;
            padding: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-entry {
            position: relative;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            background: var(--surface);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            transition: all 0.2s ease;
        }
        
        .history-entry:hover {
            background: var(--surface-hover);
            transform: translateX(4px);
        }
        
        .history-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .history-entry-user {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .history-entry-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .history-entry-action {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .history-entry-changes {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
            font-size: 0.8rem;
        }
        
        .history-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.5rem;
            background: var(--background);
            border-radius: 6px;
        }
        
        .history-change-field {
            font-weight: 500;
            color: var(--text-secondary);
            min-width: 100px;
        }
        
        .history-change-old-value {
            color: var(--danger);
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .history-change-arrow {
            color: var(--text-muted);
        }
        
        .history-change-new-value {
            color: var(--success);
            font-weight: 500;
        }
        
        /* Arquivamento */
        /* Modo Claro/Escuro Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
        }
        
        /* Pagina√ß√£o */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem;
        }
        
        .pagination button {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination button:hover:not(:disabled) {
            background: var(--surface-hover);
            border-color: var(--primary);
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Ordena√ß√£o */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .sortable-header:hover {
            color: var(--primary);
        }
        
        .sort-icon {
            font-size: 16px;
            opacity: 0.5;
            transition: all 0.2s;
        }
        
        .sort-icon.active {
            opacity: 1;
            color: var(--primary);
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
        }
        
        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            pointer-events: none;
            z-index: 1000;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
        }
        
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--surface);
        }
        
        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
        }
        
        /* Preview de Importa√ß√£o */
        .import-preview {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid var(--border);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .preview-table th,
        .preview-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .preview-table th {
            background: var(--background);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .preview-table tr:hover td {
            background: var(--surface-hover);
        }
        
        .preview-error {
            color: var(--danger);
            font-size: 0.75rem;
        }
        
        .preview-success {
            color: var(--success);
        }
        
        /* Estat√≠sticas por Per√≠odo */
        /* Op√ß√µes de Tema */
        .theme-option {
            position: relative;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-option:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        
        .theme-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        .theme-option.active .theme-check {
            display: flex !important;
        }
        
        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        /* Atalhos de teclado - Indicador */
        .keyboard-shortcut {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: auto;
        }
        
        .keyboard-key {
            background: var(--background);
            border: 1px solid var(--border);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.7rem;
        }
        
        /* Backup autom√°tico */
        .backup-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            padding: 0.5rem;
        }
        
        .backup-status.active {
            color: var(--success);
        }
        

    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <div class="login-logo">
                <span class="material-icons" id="loginDefaultIcon">school</span>
                <h1 id="loginProjectName">CSF Manager</h1>
            </div>
            <div class="login-error" id="loginError">
                Credenciais inv√°lidas. Tente novamente.
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Usu√°rio</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Digite seu usu√°rio" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Digite sua senha" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span class="material-icons">login</span>
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="material-icons" id="sidebarDefaultIcon">school</span>
                    <h1 id="sidebarProjectName">CSF Manager</h1>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-page="dashboard">
                    <span class="material-icons">dashboard</span>
                    Dashboard
                </div>
                <div class="nav-item" data-page="courses">
                    <span class="material-icons">book</span>
                    Cursos
                </div>
                <div class="nav-item" data-page="calendar">
                    <span class="material-icons">calendar_month</span>
                    Calend√°rio
                </div>
                <div class="nav-item" data-page="tasks">
                    <span class="material-icons">checklist</span>
                    Tarefas
                    <span class="task-pending-badge" id="taskPendingBadge" style="display: none;">0</span>
                </div>
                <div class="nav-item" data-page="instructors">
                    <span class="material-icons">people</span>
                    Instrutores
                </div>
                <div class="nav-item" data-page="users" id="usersNavItem" style="display: none;">
                    <span class="material-icons">admin_panel_settings</span>
                    Usu√°rios
                </div>
                <div class="nav-item" data-page="settings">
                    <span class="material-icons">settings</span>
                    Configura√ß√µes
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <h4 id="userName">Admin</h4>
                        <span id="userRole">Administrador</span>
                    </div>
                    <button class="logout-btn" id="logoutBtn" title="Sair">
                        <span class="material-icons">logout</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Bot√£o fixo para abrir sidebar no mobile -->
        <button id="mobileSidebarToggle" class="mobile-sidebar-toggle" title="Abrir menu">
            <span class="material-icons">menu</span>
        </button>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Breadcrumbs -->
            <div class="breadcrumbs" id="breadcrumbs">
                <div class="breadcrumb-item" data-page="dashboard">
                    <span class="material-icons">home</span>
                    In√≠cio
                </div>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <div class="breadcrumb-item active" id="currentPageBreadcrumb">
                    Dashboard
                </div>
            </div>

            <!-- Push Notification Banner -->
            <div class="notification-banner" id="pushNotificationBanner">
                <div class="notification-banner-header">
                    <div class="notification-banner-title">
                        <span class="material-icons">notifications_active</span>
                        <span id="pushNotificationTitle">Alerta</span>
                    </div>
                    <button class="notification-banner-close" onclick="closePushNotification()">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="notification-banner-body" id="pushNotificationBody">
                    Mensagem da notifica√ß√£o
                </div>
                <div class="notification-banner-actions" id="pushNotificationActions">
                </div>
            </div>

            <!-- PWA Install Prompt -->
            <div class="pwa-install-prompt" id="pwaInstallPrompt">
                <div class="pwa-install-icon">
                    <span class="material-icons">install_mobile</span>
                </div>
                <div class="pwa-install-text">
                    <h4>Instalar App</h4>
                    <p>Instale o app para acesso r√°pido</p>
                </div>
                <div class="pwa-install-actions">
                    <button class="btn btn-primary" id="pwaInstallBtn" onclick="installPWA()">Instalar</button>
                    <button class="btn btn-secondary" onclick="dismissPWAPrompt()">Depois</button>
                </div>
            </div>

            <!-- Notifica√ß√µes Panel -->
            <div class="notifications-panel" id="notificationsPanel">
                <div class="notifications-header">
                    <h3>Notifica√ß√µes</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" id="refreshNotificationsBtn" title="Atualizar notifica√ß√µes" style="padding: 0.25rem 0.5rem;" onclick="refreshNotifications()">
                            <span class="material-icons" style="font-size: 18px;">refresh</span>
                        </button>
                        <button class="btn btn-secondary" id="markAllReadBtn" title="Marcar todas como lidas" style="padding: 0.25rem 0.5rem;">
                            <span class="material-icons" style="font-size: 18px;">done_all</span>
                        </button>
                        <button class="btn btn-secondary" id="clearNotificationsBtn" title="Limpar hist√≥rico" style="padding: 0.25rem 0.5rem;">
                            <span class="material-icons" style="font-size: 18px;">delete_sweep</span>
                        </button>
                        <button class="btn btn-secondary" id="closeNotificationsBtn" style="padding: 0.25rem 0.5rem;">
                            <span class="material-icons" style="font-size: 18px;">close</span>
                        </button>
                    </div>
                </div>
                <div class="notifications-list" id="notificationsList">
                    <!-- Notifica√ß√µes ser√£o renderizadas aqui -->
                </div>
            </div>
            
            <!-- Aviso de dados n√£o salvos -->
            <!-- Toggle de Tema -->
            <button class="theme-toggle" id="themeToggle" title="Alternar tema">
                <span class="material-icons" id="themeIcon">dark_mode</span>
            </button>
            
            <!-- Dashboard Page -->
            <section class="page-section active" id="dashboardPage">
                <div class="header">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <span class="material-icons">menu</span>
                    </button>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon purple">
                                <span class="material-icons">school</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="totalCourses">0</div>
                        <div class="kpi-label">Total de Cursos</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon green">
                                <span class="material-icons">check_circle</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="completedCourses">0</div>
                        <div class="kpi-label">Conclu√≠dos</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue">
                                <span class="material-icons">pending</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="ongoingCourses">0</div>
                        <div class="kpi-label">Em Andamento</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon orange">
                                <span class="material-icons">groups</span>
                            </div>
                        </div>
                        <div class="kpi-value" id="totalStudents">0</div>
                        <div class="kpi-label">Total Concludentes</div>
                    </div>
                </div>

                <!-- Relat√≥rio de Cursos no Dashboard -->
                <div class="report-section" style="margin-top: 2rem;">
                    <div class="page-header">
                        <h2 class="page-title">Relat√≥rio de Cursos</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" id="downloadReportBtn">
                                <span class="material-icons">download</span>
                                Baixar Relat√≥rio
                            </button>
                        </div>
                    </div>
                    <div id="dashboardReport">
                        <!-- Relat√≥rio ser√° renderizado aqui -->
                    </div>
                </div>
            </section>

            <!-- Courses Page -->
            <section class="page-section" id="coursesPage">
                <div class="page-header">
                    <h2 class="page-title">Cursos</h2>
                    <div class="header-actions">
                        <button class="view-toggle-btn" id="compactModeBtn" title="Modo Compacto">
                            <span class="material-icons">view_comfy</span>
                            <span class="btn-text">Compacto</span>
                        </button>
                        <button class="btn btn-secondary notification-bell" id="notificationBellBtn" title="Notifica√ß√µes">
                            <span class="material-icons">notifications</span>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <button class="btn btn-primary" id="newCourseBtn">
                            <span class="material-icons">add</span>
                            Novo Curso
                        </button>
                    </div>
                </div>
                
                <!-- Busca Avan√ßada e Filtros -->
                <div class="advanced-search-panel">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600;">Filtros</h3>
                        <button class="btn btn-secondary" id="toggleFiltersBtn" style="padding: 0.5rem 1rem;">
                            <span class="material-icons">filter_list</span>
                            Filtros
                        </button>
                    </div>
                    <div id="filtersContainer" class="filters-grid" style="display: none;">
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="filterStatus" class="form-select">
                                <option value="">Todos</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Pendente">Pendente</option>
                                <option value="Cancelado">Cancelado</option>
                    </select>
                        </div>
                        <div class="filter-group">
                            <label>LOTE</label>
                            <select id="filterLote" class="form-select">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Curso</label>
                            <select id="filterCurso" class="form-select">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ID</label>
                            <input type="text" id="filterId" class="form-input" placeholder="Digite o ID do curso" inputmode="numeric">
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-primary" id="applyFiltersBtn">Aplicar Filtros</button>
                            <button class="btn btn-secondary" id="clearFiltersBtn">Limpar</button>
                        </div>
                    </div>
                </div>
                
                
                <div id="coursesByLoteContainer">
                    <!-- Cursos organizados por LOTE ser√£o renderizados aqui -->
                </div>
                
                <!-- Pagina√ß√£o -->
                <div class="pagination" id="paginationContainer" style="display: none;">
                    <button id="prevPageBtn" class="btn btn-secondary">
                        <span class="material-icons">chevron_left</span>
                    </button>
                    <span id="pageInfo" style="padding: 0 1rem;"></span>
                    <button id="nextPageBtn" class="btn btn-secondary">
                        <span class="material-icons">chevron_right</span>
                    </button>
                </div>
            </section>

            <!-- Calendar Page -->
            <section class="page-section" id="calendarPage">
                <div class="page-header">
                    <h2 class="page-title">Calend√°rio</h2>
                    <div class="header-actions">
                        <div class="calendar-view-toggle">
                            <button class="view-btn active" data-view="month" title="Mensal">
                                <span class="material-icons">calendar_view_month</span>
                            </button>
                            <button class="view-btn" data-view="week" title="Semanal">
                                <span class="material-icons">view_week</span>
                            </button>
                            <button class="view-btn" data-view="day" title="Di√°rio">
                                <span class="material-icons">view_day</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estat√≠sticas do m√™s -->
                <div class="calendar-stats" id="calendarStats">
                    <div class="calendar-stat">
                        <span class="material-icons">event</span>
                        <span id="totalCoursesMonth">0</span> cursos no m√™s
                    </div>
                    <div class="calendar-stat">
                        <span class="material-icons">play_circle</span>
                        <span id="coursesStartingMonth">0</span> iniciando
                    </div>
                    <div class="calendar-stat">
                        <span class="material-icons">stop_circle</span>
                        <span id="coursesEndingMonth">0</span> finalizando
                    </div>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button id="prevMonth" title="M√™s anterior (‚Üê)">
                                <span class="material-icons">chevron_left</span>
                            </button>
                            <h3 class="calendar-title" id="calendarTitle">Dezembro 2024</h3>
                            <button id="nextMonth" title="Pr√≥ximo m√™s (‚Üí)">
                                <span class="material-icons">chevron_right</span>
                            </button>
                        </div>
                        <div class="calendar-header-actions">
                            <input type="date" id="calendarDatePicker" class="form-input" style="width: auto; padding: 0.5rem;" title="Ir para data">
                            <button class="btn btn-primary" id="todayBtn">
                                <span class="material-icons">today</span>
                                Hoje
                            </button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be rendered here -->
                    </div>
                    
                    <!-- Legenda -->
                    <div class="calendar-legend">
                        <div class="legend-title">Legenda:</div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--success);"></span>
                            <span>In√≠cio do curso</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--danger);"></span>
                            <span>Fim do curso</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--primary);"></span>
                            <span>Em andamento</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--warning);"></span>
                            <span>Feriado</span>
                        </div>
                    </div>
                </div>
                
                <!-- Preview do curso (tooltip) -->
                <div class="course-preview-tooltip" id="coursePreviewTooltip" style="display: none;">
                    <div class="preview-header">
                        <span class="preview-status"></span>
                        <span class="preview-title"></span>
                    </div>
                    <div class="preview-body">
                        <div class="preview-info"><span class="material-icons">person</span> <span class="preview-instructor"></span></div>
                        <div class="preview-info"><span class="material-icons">location_on</span> <span class="preview-location"></span></div>
                        <div class="preview-info"><span class="material-icons">schedule</span> <span class="preview-dates"></span></div>
                        <div class="preview-info"><span class="material-icons">groups</span> <span class="preview-students"></span></div>
                    </div>
                </div>
            </section>

            <!-- Tasks Page -->
            <section class="page-section" id="tasksPage">
                <div class="page-header">
                    <h2 class="page-title">Agenda de Tarefas</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="newTaskBtn">
                            <span class="material-icons">add_task</span>
                            Nova Tarefa
                        </button>
                    </div>
                </div>
                
                <!-- Estat√≠sticas de tarefas -->
                <div class="tasks-stats">
                    <div class="task-stat-card">
                        <div class="task-stat-icon pending">
                            <span class="material-icons">pending_actions</span>
                        </div>
                        <div class="task-stat-info">
                            <span class="task-stat-value" id="tasksPendingCount">0</span>
                            <span class="task-stat-label">Pendentes</span>
                        </div>
                    </div>
                    <div class="task-stat-card">
                        <div class="task-stat-icon today">
                            <span class="material-icons">today</span>
                        </div>
                        <div class="task-stat-info">
                            <span class="task-stat-value" id="tasksTodayCount">0</span>
                            <span class="task-stat-label">Para Hoje</span>
                        </div>
                    </div>
                    <div class="task-stat-card">
                        <div class="task-stat-icon overdue">
                            <span class="material-icons">warning</span>
                        </div>
                        <div class="task-stat-info">
                            <span class="task-stat-value" id="tasksOverdueCount">0</span>
                            <span class="task-stat-label">Atrasadas</span>
                        </div>
                    </div>
                    <div class="task-stat-card">
                        <div class="task-stat-icon completed">
                            <span class="material-icons">task_alt</span>
                        </div>
                        <div class="task-stat-info">
                            <span class="task-stat-value" id="tasksCompletedCount">0</span>
                            <span class="task-stat-label">Conclu√≠das</span>
                        </div>
                    </div>
                </div>
                
                <!-- Filtros de tarefas -->
                <div class="tasks-filters">
                    <button class="task-filter-btn active" data-filter="all">
                        <span class="material-icons">list</span> Todas
                    </button>
                    <button class="task-filter-btn" data-filter="today">
                        <span class="material-icons">today</span> Hoje
                    </button>
                    <button class="task-filter-btn" data-filter="week">
                        <span class="material-icons">date_range</span> Esta Semana
                    </button>
                    <button class="task-filter-btn" data-filter="overdue">
                        <span class="material-icons">warning</span> Atrasadas
                    </button>
                    <button class="task-filter-btn" data-filter="completed">
                        <span class="material-icons">check_circle</span> Conclu√≠das
                    </button>
                </div>
                
                <!-- Lista de tarefas -->
                <div class="tasks-container" id="tasksContainer">
                    <!-- Tarefas ser√£o renderizadas aqui -->
                </div>
            </section>

            <!-- Instructors Page -->
            <section class="page-section" id="instructorsPage">
                <div class="page-header">
                    <h2 class="page-title">Instrutores</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" id="importInstructorsBtn">
                            <span class="material-icons">upload_file</span>
                            Importar Dados
                        </button>
                    <button class="btn btn-primary" id="newInstructorBtn">
                        <span class="material-icons">person_add</span>
                        Novo Instrutor
                    </button>
                    </div>
                </div>
                <div class="instructor-grid" id="instructorGrid">
                    <!-- Instructors will be rendered here -->
                </div>
            </section>

            <!-- Users Page (Admin Only) -->
            <section class="page-section" id="usersPage">
                <div class="page-header">
                    <h2 class="page-title">Gerenciar Usu√°rios</h2>
                    <button class="btn btn-primary" id="newUserBtn">
                        <span class="material-icons">person_add</span>
                        Novo Usu√°rio
                    </button>
                </div>
                
                <!-- Adicionando se√ß√£o para alterar nome do administrador -->
                <div class="settings-card">
                    <h3>
                        <span class="material-icons">badge</span>
                        Alterar Meu Nome
                    </h3>
                    <form id="changeNameForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome Atual</label>
                                <input type="text" class="form-input" id="currentNameDisplay" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Novo Nome</label>
                                <input type="text" class="form-input" id="newAdminName" placeholder="Digite o novo nome">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span class="material-icons">save</span>
                            Alterar Nome
                        </button>
                    </form>
                </div>

                <!-- Se√ß√£o de mudar senha do admin -->
                <div class="settings-card">
                    <h3>
                        <span class="material-icons">lock</span>
                        Alterar Minha Senha
                    </h3>
                    <form id="changePasswordForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Senha Atual</label>
                                <input type="password" class="form-input" id="currentPassword" placeholder="Digite sua senha atual">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nova Senha</label>
                                <input type="password" class="form-input" id="newPassword" placeholder="Digite a nova senha">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirmar Nova Senha</label>
                            <input type="password" class="form-input" id="confirmPassword" placeholder="Confirme a nova senha">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span class="material-icons">save</span>
                            Alterar Senha
                        </button>
                    </form>
                </div>

                <div class="settings-card">
                    <h3>
                        <span class="material-icons">group</span>
                        Lista de Usu√°rios
                    </h3>
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Fun√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be rendered here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Novo layout do log de atividades -->
                <div class="settings-card">
                    <h3>
                        <span class="material-icons">history</span>
                        Log de Atividades
                    </h3>
                    <div class="activity-log" id="activityLog">
                        <!-- Activity log will be rendered here -->
                    </div>
                </div>
                
                <!-- Hist√≥rico de Altera√ß√µes Detalhado -->
                <div class="settings-card">
                    <h3>
                        <span class="material-icons">timeline</span>
                        Hist√≥rico de Altera√ß√µes
                    </h3>
                    <div id="changeHistoryContainer">
                        <!-- Hist√≥rico ser√° renderizado aqui -->
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section class="page-section" id="settingsPage">
                <div class="page-header">
                    <h2 class="page-title">Configura√ß√µes</h2>
                </div>

                <!-- Se√ß√£o de importa√ß√£o com design interativo e animado -->
                <div class="settings-card">
                    <div class="settings-section-header">
                        <div class="settings-icon-large">
                            <span class="material-icons">cloud_upload</span>
                        </div>
                        <div class="settings-header-content">
                            <h3>Importar Dados</h3>
                            <p>Importe cursos em lote usando planilhas Excel de forma r√°pida e f√°cil</p>
                        </div>
                    </div>
                    
                    <label class="interactive-upload-zone" for="excelFileInput" id="uploadZone">
                        <div class="upload-icon-container">
                            <div class="upload-icon-bg">
                                <span class="material-icons">file_upload</span>
                            </div>
                        </div>
                        <div class="upload-text-main">Arraste seu arquivo aqui</div>
                        <div class="upload-text-sub">ou clique para selecionar do seu computador</div>
                        <div class="upload-format-tags">
                            <span class="format-tag">
                                <span class="material-icons">description</span>
                                Excel (.xlsx)
                            </span>
                            <span class="format-tag">
                                <span class="material-icons">table_chart</span>
                                Excel (.xls)
                            </span>
                        </div>
                    </label>
                    <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;">
                    <input type="file" id="instructorsFileInput" accept=".xlsx,.xls" style="display: none;">
                    
                    <!-- Preview de Importa√ß√£o -->
                    <div class="import-preview" id="importPreview" style="display: none;">
                        <h4 style="margin-bottom: 1rem;">Preview dos Dados a Importar</h4>
                        <div id="previewTableContainer"></div>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" id="confirmImportBtn">Confirmar Importa√ß√£o</button>
                            <button class="btn btn-secondary" id="cancelImportBtn">Cancelar</button>
                        </div>
                    </div>
                    
                    <div class="file-selected-display" id="fileInfoBox">
                        <span class="material-icons">check_circle</span>
                        <div class="file-info-text">
                            <strong>Arquivo selecionado:</strong>
                            <span id="selectedFileName"></span>
                        </div>
                    </div>

                    <div class="columns-info-card">
                        <span class="material-icons">info</span>
                        <div>
                            <strong>Colunas esperadas na planilha:</strong>
                            <p>CURSO ‚Ä¢ ID ‚Ä¢ LOTE ‚Ä¢ CIDADE ‚Ä¢ DATA IN√çCIO ‚Ä¢ DATA FIM ‚Ä¢ ENDERE√áO ‚Ä¢ STATUS ‚Ä¢ CONCLUDENTES ‚Ä¢ CARGA HOR√ÅRIA ‚Ä¢ INSTRUTOR ‚Ä¢ TELEFONE</p>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de exporta√ß√£o com cards interativos e animados -->
                <div class="settings-card">
                    <div class="settings-section-header">
                        <div class="settings-icon-large">
                            <span class="material-icons">download</span>
                        </div>
                        <div class="settings-header-content">
                            <h3>Exportar Dados</h3>
                            <p>Fa√ßa download dos seus dados em formato CSV para backup ou an√°lise</p>
                        </div>
                    </div>
                    
                    <div class="export-buttons-grid">
                        <button class="export-button-card" id="exportCoursesBtn" title="Exportar para CSV">
                            <div class="export-icon-wrapper">
                                <span class="material-icons">file_download</span>
                            </div>
                            <h4>Exportar Cursos (CSV)</h4>
                            <p>Lista completa em formato CSV</p>
                        </button>
                        
                        <button class="export-button-card" id="exportCoursesExcelBtn" title="Exportar para Excel">
                            <div class="export-icon-wrapper">
                                <span class="material-icons">table_chart</span>
                            </div>
                            <h4>Exportar Cursos (Excel)</h4>
                            <p>Lista completa em formato Excel</p>
                        </button>
                        
                        <button class="export-button-card" id="exportCoursesPDFBtn" title="Exportar para PDF">
                            <div class="export-icon-wrapper">
                                <span class="material-icons">picture_as_pdf</span>
                            </div>
                            <h4>Exportar Cursos (PDF)</h4>
                            <p>Relat√≥rio formatado em PDF</p>
                        </button>
                        
                        <button class="export-button-card" id="exportInstructorsBtn">
                            <div class="export-icon-wrapper">
                                <span class="material-icons">people</span>
                            </div>
                            <h4>Exportar Instrutores</h4>
                            <p>Todos os instrutores e suas informa√ß√µes</p>
                        </button>
                    </div>
                </div>

                <!-- Se√ß√£o de Nome do Projeto -->
                <div class="settings-card">
                    <div class="settings-section-header">
                        <div class="settings-icon-large">
                            <span class="material-icons">title</span>
                        </div>
                        <div class="settings-header-content">
                            <h3>Nome do Projeto</h3>
                            <p>Personalize o nome do projeto que aparece na tela de login e na sidebar</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons" style="font-size: 18px;">edit</span>
                                Nome do Projeto
                            </label>
                            <input type="text" id="projectNameInput" class="form-input" placeholder="Ex: CSF Manager" maxlength="50">
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                                O nome aparecer√° na tela de login e na sidebar
                            </p>
                            <button type="button" class="btn btn-primary" id="saveProjectNameBtn" style="margin-top: 1rem;">
                                <span class="material-icons">save</span>
                                Salvar Nome
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Temas -->
                <div class="settings-card">
                    <div class="settings-section-header">
                        <div class="settings-icon-large">
                            <span class="material-icons">palette</span>
                        </div>
                        <div class="settings-header-content">
                            <h3>Temas</h3>
                            <p>Personalize a apar√™ncia da plataforma escolhendo um dos temas dispon√≠veis</p>
                        </div>
                    </div>
                    
                    <div class="themes-grid" style="margin-top: 1.5rem;">
                        <div class="theme-option" data-theme="default">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #6366f1, #4f46e5); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Padr√£o</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema original com cores √≠ndigo</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: var(--primary); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>
                        
                        <div class="theme-option" data-theme="green">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #10b981, #059669); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Verde</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema com tons de verde natural</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>
                        
                        <div class="theme-option" data-theme="purple">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Roxo</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema com tons de roxo elegante</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: #8b5cf6; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>

                        <div class="theme-option" data-theme="blue">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #3b82f6, #2563eb); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Azul</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema com tons de azul profissional</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: #3b82f6; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>

                        <div class="theme-option" data-theme="orange">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f97316, #ea580c); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Laranja</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema com tons de laranja vibrante</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: #f97316; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>

                        <div class="theme-option" data-theme="pink">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #ec4899, #db2777); height: 120px; border-radius: 12px; margin-bottom: 1rem; position: relative; overflow: hidden;">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: rgba(0,0,0,0.2); display: flex; align-items: center; padding: 0 12px;">
                                    <div style="width: 8px; height: 8px; background: white; border-radius: 50%; margin-right: 8px;"></div>
                                    <div style="flex: 1; height: 4px; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Rosa</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">Tema com tons de rosa moderno</p>
                            <div class="theme-check" style="position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: #ec4899; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white;">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customiza√ß√£o de Tema -->
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--border);">
                        <h4 style="margin-bottom: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                            <span class="material-icons">tune</span>
                            Customizar Tema
                        </h4>
                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Personalize as cores do tema escolhendo suas pr√≥prias cores
                        </p>
                        
                        <div class="custom-theme-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons" style="font-size: 18px;">palette</span>
                                    Cor Principal
                                </label>
                                <input type="color" id="customPrimaryColor" class="form-input" style="height: 50px; padding: 4px; cursor: pointer;" value="#6366f1">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons" style="font-size: 18px;">format_color_fill</span>
                                    Cor de Fundo
                                </label>
                                <input type="color" id="customBackgroundColor" class="form-input" style="height: 50px; padding: 4px; cursor: pointer;" value="#0f172a">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons" style="font-size: 18px;">view_sidebar</span>
                                    Cor da Sidebar
                                </label>
                                <input type="color" id="customSidebarColor" class="form-input" style="height: 50px; padding: 4px; cursor: pointer;" value="#020617">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons" style="font-size: 18px;">square</span>
                                    Cor de Superf√≠cie
                                </label>
                                <input type="color" id="customSurfaceColor" class="form-input" style="height: 50px; padding: 4px; cursor: pointer;" value="#1e293b">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="applyCustomThemeBtn">
                                <span class="material-icons">check</span>
                                Aplicar Cores Personalizadas
                            </button>
                            <button class="btn btn-secondary" id="resetCustomThemeBtn">
                                <span class="material-icons">refresh</span>
                                Restaurar Padr√£o
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Zona de perigo com visual de alerta interativo -->
                <div class="settings-card danger-zone-card">
                    <div class="settings-section-header">
                        <div class="settings-icon-large">
                            <span class="material-icons">warning</span>
                        </div>
                        <div class="settings-header-content">
                            <h3>Zona de Perigo</h3>
                            <p>A√ß√µes irrevers√≠veis que afetam todo o sistema</p>
                        </div>
                    </div>
                    
                    <div class="danger-warning-box">
                        <span class="material-icons">error</span>
                        <p>Esta a√ß√£o ir√° excluir <strong>permanentemente</strong> todos os cursos, instrutores e dados relacionados. Esta opera√ß√£o <strong>n√£o pode ser desfeita</strong>. Proceda com extrema cautela.</p>
                    </div>
                    
                    <button class="btn btn-danger" id="clearDataBtn">
                        <span class="material-icons">delete_forever</span>
                        Limpar Todos os Dados do Sistema
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Course Modal - Campos opcionais -->
    <div class="modal-overlay" id="courseModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="courseModalTitle">Novo Curso</h3>
                <button class="modal-close" onclick="closeModal('courseModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="courseForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nome do Curso <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="courseName" placeholder="Ex: Seguran√ßa do Trabalho NR-10">
                        <span class="form-error" id="courseNameError">Nome do curso √© obrigat√≥rio</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ID <span class="optional-label">(opcional)</span></label>
                            <input type="number" class="form-input" id="courseIdLote" placeholder="Ex: 1001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">LOTE <span class="optional-label">(opcional)</span></label>
                            <input type="text" class="form-input" id="courseLote" placeholder="Ex: Lote A">
                        </div>
                    </div>
                    <!-- Adicionando campo de Carga Hor√°ria com 3 op√ß√µes -->
                    <div class="form-group">
                        <label class="form-label">Carga Hor√°ria</label>
                        <select class="form-select" id="courseCargaHoraria">
                            <option value="">Selecione a carga hor√°ria</option>
                            <option value="20H">20H</option>
                            <option value="40H">40H</option>
                            <option value="60H">60H</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Cidade <span class="optional-label">(opcional)</span></label>
                            <input type="text" class="form-input" id="courseCity" placeholder="Ex: S√£o Paulo">
                            <span class="form-error" id="courseCityError">Cidade √© obrigat√≥ria</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Local <span class="optional-label">(opcional)</span></label>
                            <input type="text" class="form-input" id="courseLocation" placeholder="Ex: Centro de Treinamento">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data In√≠cio <span class="optional-label">(opcional)</span></label>
                            <input type="date" class="form-input" id="courseStart">
                            <span class="form-error" id="courseStartError">Data de in√≠cio √© obrigat√≥ria</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Fim <span class="optional-label">(opcional)</span></label>
                            <input type="date" class="form-input" id="courseEnd">
                            <span class="form-error" id="courseEndError">Data de fim √© obrigat√≥ria</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="courseStatus">
                                <option value="Pendente">Pendente</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                                <option value="Cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Concludentes <span class="optional-label">(opcional)</span></label>
                            <input type="number" class="form-input" id="courseStudents" placeholder="0" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Instrutor <span class="optional-label">(opcional)</span></label>
                        <div style="display: flex; gap: 8px;">
                            <select class="form-select" id="courseInstructor" style="flex: 1;">
                                <option value="">Selecione um instrutor</option>
                            </select>
                            <button type="button" class="btn btn-secondary btn-icon" onclick="openQuickInstructorModal()" title="Adicionar Instrutor">
                                <span class="material-icons">person_add</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Link do Google Drive <span class="optional-label">(opcional)</span></label>
                        <input type="url" class="form-input" id="courseDriveLink" placeholder="https://drive.google.com/...">
                    </div>
                    <!-- Campo de anota√ß√£o do curso -->
                    <div class="form-group">
                        <label class="form-label">Anota√ß√£o <span class="optional-label">(opcional)</span></label>
                        <textarea class="form-input" id="courseNote" placeholder="Digite uma anota√ß√£o que ficar√° vis√≠vel no card do curso..." rows="3" style="resize: vertical;"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('courseModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">save</span>
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Course Modal -->
    <div class="modal-overlay" id="viewCourseModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="viewCourseTitle">Detalhes do Curso</h3>
                <button class="modal-close" onclick="closeModal('viewCourseModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body" id="viewCourseBody">
                <!-- Course details will be rendered here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('viewCourseModal')"> Fechar</button>
                <button type="button" class="btn btn-primary" id="editCourseFromViewBtn">
                    <span class="material-icons">edit</span>
                    Editar
                </button>
            </div>
        </div>
    </div>

    <!-- Instructor Modal - Campos opcionais -->
    <div class="modal-overlay" id="instructorModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="instructorModalTitle">Novo Instrutor</h3>
                <button class="modal-close" onclick="closeModal('instructorModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="instructorForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nome <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="instructorName" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Especialidade <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="instructorSpecialty" placeholder="Ex: Seguran√ßa do Trabalho">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone <span class="optional-label">(opcional)</span></label>
                        <input type="tel" class="form-input" id="instructorPhone" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email <span class="optional-label">(opcional)</span></label>
                        <input type="email" class="form-input" id="instructorEmail" placeholder="email@exemplo.com">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('instructorModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">save</span>
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Instructor Modal -->
    <div class="modal-overlay" id="quickInstructorModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Adicionar Instrutor R√°pido</h3>
                <button class="modal-close" onclick="closeModal('quickInstructorModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="quickInstructorForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nome do Instrutor <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="quickInstructorName">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('quickInstructorModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">add</span>
                        Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal - Campos opcionais -->
    <div class="modal-overlay" id="userModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3 id="userModalTitle">Novo Usu√°rio</h3>
                <button class="modal-close" onclick="closeModal('userModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="userForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nome <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="newUserName" placeholder="Nome do usu√°rio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Usu√°rio (login) <span class="optional-label">(opcional)</span></label>
                        <input type="text" class="form-input" id="newUserUsername" placeholder="Nome de usu√°rio para login">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email <span class="optional-label">(opcional)</span></label>
                        <input type="email" class="form-input" id="newUserEmail" placeholder="email@exemplo.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha <span class="optional-label">(opcional)</span></label>
                        <input type="password" class="form-input" id="newUserPassword" placeholder="Senha do usu√°rio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fun√ß√£o</label>
                        <select class="form-select" id="newUserRole">
                            <option value="viewer">Visualizador</option>
                            <option value="editor">Editor</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">save</span>
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3>Relat√≥rio de Cursos</h3>
                <button class="modal-close" onclick="closeModal('reportModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="report-preview" id="reportContent">
                    <!-- Report content will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('reportModal')"> Fechar</button>
                <button type="button" class="btn btn-primary" onclick="downloadReportAsImage()">
                    <span class="material-icons">image</span>
                    Baixar como Imagem
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBq5qmLy6HAzZAeC4KCVjLfdCM77ttOU3A",
            authDomain: "csf-iac.firebaseapp.com",
            projectId: "csf-iac",
            storageBucket: "csf-iac.firebasestorage.app",
            messagingSenderId: "484645494526",
            appId: "1:484645494526:web:f5ecc23c7c0edbca320faf",
            measurementId: "G-XL3WY01E73"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let firebaseAvailable = false;

        // State
        let cursos = [];
        let instrutores = [];
        let usuarios = [];
        let activityLogs = [];
        let currentUser = null;
        let editingCourseId = null;
        let editingInstructorId = null;
        let editingUserId = null;
        let currentMonth = new Date();
        let currentCalendarView = 'month'; // 'month', 'week', 'day'
        let viewingCourseId = null;
        let loteNames = {}; // Inicializar vari√°vel loteNames
        let isLoading = false; // Estado de loading
        let debounceTimer = null; // Timer para debounce

        const defaultUsers = [
            { id: 'admin1', name: 'Administrador', username: 'Csfiac', password: '032147', role: 'admin' },
            { id: 'editor1', name: 'Editor', username: 'Iac', password: 'Iac@123', role: 'editor' },
            { id: 'viewer1', name: 'Visualizador', username: 'viewer', password: 'viewer123', role: 'viewer' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeApp();
            checkAuth();
            setupEventListeners();
            setupDragAndDrop(); // Chamada para configurar o drag and drop
            setupModalCloseOnOutsideClick(); // Configurar fechamento de modais ao clicar fora
            initNotificationSystem(); // Inicializar sistema de notifica√ß√µes
            setupCalendarKeyboardNav(); // Navega√ß√£o por teclado no calend√°rio
            setupCalendarDatePicker(); // Date picker do calend√°rio
            initTaskSystem(); // Inicializar sistema de tarefas
            // Carregar nome do projeto ao inicializar
            loadProjectName();
        });

        async function initializeApp() {
            try {
                await db.collection('_test_connection').doc('test').get();
                firebaseAvailable = true;
                console.log('Firebase conectado com sucesso!');
                await initializeUsers();
            } catch (error) {
                console.warn('Firebase n√£o dispon√≠vel, usando localStorage:', error.message);
                firebaseAvailable = false;
                initializeLocalStorage();
            }
        }

        function initializeLocalStorage() {
            if (!localStorage.getItem('usuarios')) {
                localStorage.setItem('usuarios', JSON.stringify(defaultUsers));
            }
            if (!localStorage.getItem('cursos')) {
                localStorage.setItem('cursos', JSON.stringify([]));
            }
            if (!localStorage.getItem('instrutores')) {
                localStorage.setItem('instrutores', JSON.stringify([]));
            }
            if (!localStorage.getItem('activityLogs')) {
                localStorage.setItem('activityLogs', JSON.stringify([]));
            }
            if (!localStorage.getItem('loteNames')) {
                localStorage.setItem('loteNames', JSON.stringify({}));
            }
            loteNames = JSON.parse(localStorage.getItem('loteNames') || '{}');
            
            // Sincronizar loteNames do Firebase se dispon√≠vel
            if (firebaseAvailable) {
                syncLoteNamesFromFirebase();
            }
        }
        
        async function syncLoteNamesFromFirebase() {
            try {
                const snapshot = await db.collection('loteNames').get();
                if (!snapshot.empty) {
                    const firebaseLoteNames = {};
                    snapshot.docs.forEach(doc => {
                        firebaseLoteNames[doc.id] = doc.data().name;
                    });
                    // Mesclar com localStorage
                    loteNames = { ...loteNames, ...firebaseLoteNames };
                    localStorage.setItem('loteNames', JSON.stringify(loteNames));
                }
            } catch (error) {
                console.warn('Erro ao sincronizar loteNames do Firebase:', error);
            }
        }

        async function initializeUsers() {
            try {
                const snapshot = await db.collection('usuarios').get();
                if (snapshot.empty) {
                    for (const user of defaultUsers) {
                        await db.collection('usuarios').doc(user.id).set(user);
                    }
                }
            } catch (error) {
                console.error('Error initializing users:', error);
            }
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            }
        }

        // Auth Functions
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            const defaultUser = defaultUsers.find(u => u.username === username && u.password === password);
            
            if (defaultUser) {
                currentUser = { ...defaultUser };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('loginError').classList.remove('show');
                showApp();
                logActivity('Login', `${currentUser.name} fez login`, 'add');
                return;
            }
            
            if (!firebaseAvailable) {
                const localUsers = JSON.parse(localStorage.getItem('usuarios') || '[]');
                const localUser = localUsers.find(u => u.username === username && u.password === password);
                
                if (localUser) {
                    currentUser = { ...localUser };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    document.getElementById('loginError').classList.remove('show');
                    showApp();
                    logActivity('Login', `${currentUser.name} fez login`, 'add');
                    return;
                }
                
                document.getElementById('loginError').classList.add('show');
                return;
            }

            try {
                const snapshot = await db.collection('usuarios').where('username', '==', username).get();
                
                if (!snapshot.empty) {
                    const userDoc = snapshot.docs[0];
                    const userData = userDoc.data();
                    
                    if (userData.password === password) {
                        currentUser = { id: userDoc.id, ...userData };
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        document.getElementById('loginError').classList.remove('show');
                        showApp();
                        logActivity('Login', `${currentUser.name} fez login`, 'add');
                        return;
                    }
                }
                
                document.getElementById('loginError').classList.add('show');
            } catch (error) {
                console.error('Erro no login Firebase:', error);
                document.getElementById('loginError').classList.add('show');
            }
        }

        function showApp() {
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            const roleLabels = { admin: 'Administrador', editor: 'Editor', viewer: 'Visualizador' };
            document.getElementById('userRole').textContent = roleLabels[currentUser.role];
            
            if (document.getElementById('currentNameDisplay')) {
                document.getElementById('currentNameDisplay').value = currentUser.name;
            }
            
            if (currentUser.role === 'admin') {
                document.getElementById('usersNavItem').style.display = 'flex';
            } else {
                document.getElementById('usersNavItem').style.display = 'none';
            }

            if (currentUser.role === 'viewer') {
                document.getElementById('newCourseBtn').style.display = 'none';
                document.getElementById('newInstructorBtn').style.display = 'none';
                // Esconder configura√ß√µes para visualizadores
                const settingsNavItem = document.querySelector('.nav-item[data-page="settings"]');
                if (settingsNavItem) settingsNavItem.style.display = 'none';
            } else {
                document.getElementById('newCourseBtn').style.display = 'flex';
                document.getElementById('newInstructorBtn').style.display = 'flex';
                const settingsNavItem = document.querySelector('.nav-item[data-page="settings"]');
                if (settingsNavItem) settingsNavItem.style.display = 'flex';
            }

            loadData();
            
            // Garantir renderiza√ß√£o inicial ap√≥s carregar dados
            setTimeout(() => {
                renderCalendar();
                if (document.getElementById('coursesPage')?.classList.contains('active')) {
                    renderCoursesByLote();
                }
            }, 500);
        }

        // Data Loading - Otimizado com debounce
        let dataUpdateTimer = null;
        function loadData() {
            if (firebaseAvailable) {
                db.collection('cursos').onSnapshot(snapshot => {
                    cursos = snapshot.docs.map(doc => {
                        const courseData = { id: doc.id, ...doc.data() };
                        // Normalizar status ao carregar
                        if (courseData.status) {
                            courseData.status = normalizeStatus(courseData.status);
                        }
                        return courseData;
                    });
                    
                    // Debounce para evitar m√∫ltiplas renderiza√ß√µes
                    if (dataUpdateTimer) clearTimeout(dataUpdateTimer);
                    dataUpdateTimer = setTimeout(() => {
                    updateKPIs();
                    renderCalendar();
                    renderDashboardReport();
                    // Atualizar filtros com os dados carregados
                    updateLoteFilter();
                    updateCursoFilter();
                    if (document.getElementById('coursesPage')?.classList.contains('active')) {
                        renderCoursesByLote();
                    }
                    }, 100);
                }, error => {
                    console.error('Erro ao carregar cursos:', error);
                    loadFromLocalStorage();
                });

                db.collection('instrutores').onSnapshot(snapshot => {
                    instrutores = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderInstructors();
                    updateInstructorSelect();
                }, error => {
                    console.error('Erro ao carregar instrutores:', error);
                    loadFromLocalStorage();
                });

                db.collection('usuarios').onSnapshot(snapshot => {
                    usuarios = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderUsers();
                    // Update current user name if it changed
                    if (currentUser && currentUser.id) {
                        const updatedUser = usuarios.find(u => u.id === currentUser.id);
                        if (updatedUser && updatedUser.name !== currentUser.name) {
                            currentUser = { ...currentUser, name: updatedUser.name };
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            document.getElementById('userName').textContent = currentUser.name;
                            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
                        }
                        if (updatedUser && updatedUser.role !== currentUser.role) {
                             currentUser = { ...currentUser, role: updatedUser.role };
                             localStorage.setItem('currentUser', JSON.stringify(currentUser));
                             const roleLabels = { admin: 'Administrador', editor: 'Editor', viewer: 'Visualizador' };
                             document.getElementById('userRole').textContent = roleLabels[currentUser.role];
                            if (currentUser.role === 'admin') {
                                document.getElementById('usersNavItem').style.display = 'flex';
                            } else {
                                document.getElementById('usersNavItem').style.display = 'none';
                            }
                             if (currentUser.role === 'viewer') {
                                document.getElementById('newCourseBtn').style.display = 'none';
                                document.getElementById('newInstructorBtn').style.display = 'none';
                            } else {
                                document.getElementById('newCourseBtn').style.display = 'flex';
                                document.getElementById('newInstructorBtn').style.display = 'flex';
                            }
                        }
                    }
                }, error => {
                    console.error('Erro ao carregar usu√°rios:', error);
                    loadFromLocalStorage();
                });

                db.collection('activities').orderBy('timestamp', 'desc').limit(100).onSnapshot(snapshot => {
                    activityLogs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderActivityLogs();
                }, error => {
                    console.error('Erro ao carregar logs:', error);
                    loadFromLocalStorage();
                });
            } else {
                loadFromLocalStorage();
            }
        }

        function loadFromLocalStorage() {
            cursos = JSON.parse(localStorage.getItem('cursos') || '[]');
            // Normalizar status de todos os cursos ao carregar
            cursos = cursos.map(course => {
                if (course.status) {
                    course.status = normalizeStatus(course.status);
                }
                return course;
            });
            instrutores = JSON.parse(localStorage.getItem('instrutores') || '[]');
            usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
            activityLogs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
            loteNames = JSON.parse(localStorage.getItem('loteNames') || '{}');
            
            // Salvar cursos normalizados de volta
            localStorage.setItem('cursos', JSON.stringify(cursos));
            
            // Usar requestAnimationFrame para otimizar renderiza√ß√µes
            requestAnimationFrame(() => {
            updateKPIs();
            renderCalendar();
            renderInstructors();
            updateInstructorSelect();
            renderUsers();
            renderActivityLogs();
            renderDashboardReport();
            // Atualizar filtros com os dados carregados
            updateLoteFilter();
            updateCursoFilter();
            if (document.getElementById('coursesPage')?.classList.contains('active')) {
                renderCoursesByLote();
            }
            });
        }

        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });

            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById(`${page}Page`).classList.add('active');
            document.getElementById('sidebar').classList.remove('active');
            
            // Atualizar breadcrumbs
            if (typeof updateBreadcrumbs === 'function') {
                updateBreadcrumbs(page);
            }
            
            // Renderizar conte√∫do espec√≠fico da p√°gina
            if (page === 'settings') {
                renderChangeHistory();
                updateInstructorFilter();
                // Atualizar tema ativo na interface
                const savedColorTheme = localStorage.getItem('colorTheme') || 'default';
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.classList.toggle('active', option.dataset.theme === savedColorTheme);
                });
                // Reinicializar customiza√ß√£o de tema quando entrar na p√°gina
                setTimeout(() => initializeCustomTheme(), 100);
            }
            
            if (page === 'courses') {
                renderCoursesByLote();
            } else if (page === 'dashboard') {
                renderDashboardReport();
            } else if (page === 'calendar') {
                renderCalendar();
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Render Functions
        function renderCourses(searchTerm = '') {
            const grid = document.getElementById('coursesGrid');
            let filtered = cursos;

            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filtered = cursos.filter(c => 
                    c.curso?.toLowerCase().includes(term) ||
                    c.cidade?.toLowerCase().includes(term) ||
                    c.instrutor?.toLowerCase().includes(term) ||
                    c.loteResponsavel?.toLowerCase().includes(term)
                );
            }
            
            // Aplicar ordena√ß√£o (prioriza cursos com alertas)
            filtered = sortCourses(filtered);

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <span class="material-icons">school</span>
                        <h3>Nenhum curso encontrado</h3>
                        <p>${searchTerm ? 'Tente uma busca diferente' : 'Adicione seu primeiro curso'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(course => {
                const statusClass = getStatusClass(course.status);
                const canEdit = currentUser?.role !== 'viewer';
                const alerts = getCourseAlerts(course);
                const hasAlert = alerts.length > 0;
                const alertClass = hasAlert ? (alerts[0].severity === 'warning' ? 'warning-alert' : '') : '';
                
                return `
                    <div class="course-card ${hasAlert ? 'has-alert ' + alertClass : ''}" onclick="openViewCourseModal('${course.id}')">
                        <div class="course-header">
                            <div>
                                <div class="course-title">${course.curso || 'Sem nome'}</div>
                                <div class="course-id">ID da Turma: ${course.idLote || 'N/A'}${course.loteResponsavel ? ' | ' + course.loteResponsavel : ''}</div>
                            </div>
                            ${canEdit ? `
                                <div class="course-actions" onclick="event.stopPropagation()">
                                    ${course.driveLink ? `
                                        <button class="drive" onclick="openDriveLink('${course.driveLink}')" title="Abrir Google Drive">
                                            <span class="material-icons">folder</span>
                                        </button>
                                    ` : ''}
                                    <button onclick="openCourseModal('${course.id}')" title="Editar">
                                        <span class="material-icons">edit</span>
                                    </button>
                                    <button class="delete" onclick="deleteCourse('${course.id}')" title="Excluir">
                                        <span class="material-icons">delete</span>
                                    </button>
                                </div>
                            ` : `
                                <div class="course-actions" onclick="event.stopPropagation()">
                                    ${course.driveLink ? `
                                        <button class="drive" onclick="openDriveLink('${course.driveLink}')" title="Abrir Google Drive">
                                            <span class="material-icons">folder</span>
                                        </button>
                                    ` : ''}
                                </div>
                            `}
                        </div>
                        <div class="course-info">
                            <div class="course-info-item">
                                <span class="material-icons">location_on</span>
                                ${course.cidade || 'Local n√£o definido'}${course.local ? ' - ' + course.local : ''}
                            </div>
                            <div class="course-info-item">
                                <span class="material-icons">event</span>
                                <span>Per√≠odo: ${course.inicio && course.fim ? formatDate(course.inicio) + ' - ' + formatDate(course.fim) : course.inicio ? formatDate(course.inicio) : course.fim ? formatDate(course.fim) : 'N√£o informado'}</span>
                            </div>
                            <div class="course-info-item">
                                <span class="material-icons">person</span>
                                ${course.instrutor || 'Instrutor n√£o definido'}
                            </div>
                            <div class="course-info-item">
                                <span class="material-icons">groups</span>
                                ${course.alunos || 0} concludentes
                            </div>
                            <div>
                                <span class="status-badge ${statusClass}">${normalizeStatus(course.status)}</span>
                            </div>
                        </div>
                        <!-- Exibi√ß√£o da anota√ß√£o no card -->
                        ${course.nota ? `
                            <div class="course-note">
                                <span class="material-icons">sticky_note_2</span>
                                <span class="course-note-text">${course.nota}</span>
                            </div>
                        ` : ''}
                        ${renderCourseAlerts(alerts, course.id)}
                    </div>
                `;
            }).join('');
        }

        function openDriveLink(link) {
            if (link) {
                window.open(link, '_blank');
            }
        }

        function openViewCourseModal(courseId) {
            viewingCourseId = courseId;
            const course = cursos.find(c => c.id === courseId);
            if (!course) return;

            document.getElementById('viewCourseTitle').textContent = course.curso || 'Detalhes do Curso';
            
            const statusClass = getStatusClass(course.status);
            
            const body = document.getElementById('viewCourseBody');
            body.innerHTML = `
                <div class="course-detail-item">
                    <span class="material-icons">school</span>
                    <div>
                        <div class="course-detail-label">Nome do Curso</div>
                        <div class="course-detail-value">${course.curso || 'N√£o informado'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">tag</span>
                    <div>
                        <div class="course-detail-label">ID</div>
                        <div class="course-detail-value">${course.idLote || 'N/A'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">folder</span>
                    <div>
                        <div class="course-detail-label">Lote</div>
                        <div class="course-detail-value">${course.lote || course.loteResponsavel || 'N√£o informado'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">hourglass_bottom</span>
                    <div>
                        <div class="course-detail-label">Carga Hor√°ria</div>
                        <div class="course-detail-value">${course.cargaHoraria || 'N√£o informada'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">location_city</span>
                    <div>
                        <div class="course-detail-label">Cidade</div>
                        <div class="course-detail-value">${course.cidade || 'N√£o informado'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">place</span>
                    <div>
                        <div class="course-detail-label">Endere√ßo</div>
                        <div class="course-detail-value">${course.local || 'N√£o informado'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">event</span>
                    <div>
                        <div class="course-detail-label">Per√≠odo</div>
                        <div class="course-detail-value">${course.inicio && course.fim ? formatDate(course.inicio) + ' - ' + formatDate(course.fim) : course.inicio ? formatDate(course.inicio) : course.fim ? formatDate(course.fim) : 'N√£o informado'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">person</span>
                    <div>
                        <div class="course-detail-label">Instrutor</div>
                        <div class="course-detail-value">${course.instrutor || 'N√£o definido'}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">groups</span>
                    <div>
                        <div class="course-detail-label">Concludentes</div>
                        <div class="course-detail-value">${course.alunos || 0}</div>
                    </div>
                </div>
                <div class="course-detail-item">
                    <span class="material-icons">info</span>
                    <div>
                        <div class="course-detail-label">Status</div>
                        <div class="course-detail-value"><span class="status-badge ${statusClass}">${course.status || 'Pendente'}</span></div>
                    </div>
                </div>
                ${course.driveLink ? `
                <div class="course-detail-item">
                    <span class="material-icons">folder</span>
                    <div>
                        <div class="course-detail-label">Google Drive</div>
                        <div class="course-detail-value">
                            <a href="${course.driveLink}" target="_blank">
                                <span class="material-icons" style="font-size: 18px;">open_in_new</span>
                                Abrir pasta do curso
                            </a>
                        </div>
                    </div>
                </div>
                ` : ''}
                 ${course.nota ? `
                <div class="course-detail-item">
                    <span class="material-icons">chat_bubble_outline</span>
                    <div>
                        <div class="course-detail-label">Observa√ß√£o</div>
                        <div class="course-detail-value">${course.nota}</div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Hist√≥rico de Altera√ß√µes -->
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--border);">
                    <h4 style="margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                        <span class="material-icons" style="font-size: 20px;">history</span>
                        Hist√≥rico de Altera√ß√µes
                    </h4>
                    ${renderCourseHistory(courseId)}
                </div>
            `;

            const editBtn = document.getElementById('editCourseFromViewBtn');
            if (currentUser?.role !== 'viewer') {
                editBtn.style.display = 'flex';
                editBtn.onclick = () => {
                    closeModal('viewCourseModal');
                    openCourseModal(courseId);
                };
            } else {
                editBtn.style.display = 'none';
            }

            document.getElementById('viewCourseModal').classList.add('active');
        }
        
        // Fun√ß√µes auxiliares

        function renderInstructors() {
            const grid = document.getElementById('instructorGrid');

            if (instrutores.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <span class="material-icons">people</span>
                        <h3>Nenhum instrutor cadastrado</h3>
                        <p>Adicione seu primeiro instrutor</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = instrutores.map(instructor => {
                const coursesCount = cursos.filter(c => c.instrutor === instructor.nome).length;
                const canEdit = currentUser?.role !== 'viewer';
                const phone = instructor.telefone ? instructor.telefone.replace(/\D/g, '') : '';

                return `
                    <div class="instructor-card">
                        <div class="instructor-avatar">${instructor.nome?.charAt(0) || '?'}</div>
                        <div class="instructor-name">${instructor.nome || 'Sem nome'}</div>
                        <div class="instructor-specialty">${instructor.especialidade || 'Sem especialidade'}</div>
                        <div class="instructor-stats">
                            <div class="instructor-stat">
                                <div class="instructor-stat-value">${coursesCount}</div>
                                <div class="instructor-stat-label">Cursos</div>
                            </div>
                        </div>
                        <div class="instructor-actions">
                            ${phone ? `
                                <button class="btn btn-whatsapp btn-icon" onclick="openWhatsApp('${phone}')" title="Enviar mensagem no WhatsApp">
                                    <span class="material-icons">chat</span>
                                </button>
                            ` : ''}
                            ${canEdit ? `
                                <button class="btn btn-secondary btn-icon" onclick="openInstructorModal('${instructor.id}')" title="Editar">
                                    <span class="material-icons">edit</span>
                                </button>
                                <button class="btn btn-danger btn-icon" onclick="deleteInstructor('${instructor.id}')" title="Excluir">
                                    <span class="material-icons">delete</span>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openWhatsApp(phone) {
            const formattedPhone = phone.startsWith('55') ? phone : '55' + phone;
            window.open(`https://wa.me/${formattedPhone}`, '_blank');
        }

        function renderUsers() {
            const tbody = document.getElementById('usersTableBody');
            
            tbody.innerHTML = usuarios.map(user => {
                const roleClass = user.role;
                const roleLabel = { admin: 'Admin', editor: 'Editor', viewer: 'Viewer' }[user.role];
                const isCurrentUser = user.id === currentUser?.id;

                return `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email || user.username || '-'}</td>
                        <td><span class="role-badge ${roleClass}">${roleLabel}</span></td>
                        <td>
                            ${!isCurrentUser ? `
                                <button class="btn btn-secondary btn-icon" onclick="openUserModal('${user.id}')" title="Editar">
                                    <span class="material-icons">edit</span>
                                </button>
                                <button class="btn btn-danger btn-icon" onclick="deleteUser('${user.id}')" title="Excluir">
                                    <span class="material-icons">delete</span>
                                </button>
                            ` : '<span style="color: var(--text-muted)">Usu√°rio atual</span>'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderActivityLogs() {
            const container = document.getElementById('activityLog');
            
            if (activityLogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="material-icons">history</span>
                        <h3>Nenhuma atividade registrada</h3>
                        <p>As atividades aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="activity-log-grid">
                    ${activityLogs.map(log => {
                        const iconClass = log.type || 'add';
                        const iconName = iconClass === 'add' ? 'add' : iconClass === 'edit' ? 'edit' : 'delete';
                        return `
                            <div class="activity-item">
                                <div class="activity-icon ${iconClass}">
                                    <span class="material-icons">${iconName}</span>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-header">
                                        <div class="activity-title">${log.action}</div>
                                        <div class="activity-time">${formatTimestamp(log.timestamp)}</div>
                                    </div>
                                    <div class="activity-description">${log.description}</div>
                                    <div class="activity-user">
                                        <span class="material-icons">person</span>
                                        ${log.user || 'Sistema'}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function updateKPIs() {
            document.getElementById('totalCourses').textContent = cursos.length;
            document.getElementById('completedCourses').textContent = cursos.filter(c => normalizeStatus(c.status) === 'Conclu√≠do').length;
            document.getElementById('ongoingCourses').textContent = cursos.filter(c => normalizeStatus(c.status) === 'Em Andamento').length;
            document.getElementById('totalStudents').textContent = cursos.reduce((sum, c) => sum + (parseInt(c.alunos) || 0), 0);
        }

        function updateInstructorSelect() {
            const select = document.getElementById('courseInstructor');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="">Selecione um instrutor</option>' +
                instrutores.map(i => `<option value="${i.nome}">${i.nome}</option>`).join('');
            
            select.value = currentValue;
        }

        // Calendar Functions
        
        // Feriados brasileiros (fixos e m√≥veis calculados)
        function getHolidays(year) {
            const holidays = {
                // Feriados fixos
                [`${year}-01-01`]: 'Ano Novo',
                [`${year}-04-21`]: 'Tiradentes',
                [`${year}-05-01`]: 'Dia do Trabalho',
                [`${year}-09-07`]: 'Independ√™ncia',
                [`${year}-10-12`]: 'N. Sra. Aparecida',
                [`${year}-11-02`]: 'Finados',
                [`${year}-11-15`]: 'Proclama√ß√£o da Rep√∫blica',
                [`${year}-12-25`]: 'Natal'
            };
            
            // Calcular P√°scoa (algoritmo de Meeus/Jones/Butcher)
            const a = year % 19;
            const b = Math.floor(year / 100);
            const c = year % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31);
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            
            const easter = new Date(year, month - 1, day);
            
            // Feriados m√≥veis baseados na P√°scoa
            const carnival = new Date(easter);
            carnival.setDate(easter.getDate() - 47);
            holidays[carnival.toISOString().split('T')[0]] = 'Carnaval';
            
            const carnival2 = new Date(easter);
            carnival2.setDate(easter.getDate() - 46);
            holidays[carnival2.toISOString().split('T')[0]] = 'Carnaval';
            
            const goodFriday = new Date(easter);
            goodFriday.setDate(easter.getDate() - 2);
            holidays[goodFriday.toISOString().split('T')[0]] = 'Sexta-feira Santa';
            
            holidays[easter.toISOString().split('T')[0]] = 'P√°scoa';
            
            const corpusChristi = new Date(easter);
            corpusChristi.setDate(easter.getDate() + 60);
            holidays[corpusChristi.toISOString().split('T')[0]] = 'Corpus Christi';
            
            return holidays;
        }
        
        // Eventos personalizados do calend√°rio
        let calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
        
        function saveCalendarEvents() {
            localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
        }
        
        function addCalendarEvent(date, title, description = '', color = '#6366f1') {
            const event = {
                id: 'evt-' + Date.now(),
                date,
                title,
                description,
                color
            };
            calendarEvents.push(event);
            saveCalendarEvents();
            renderCalendar();
            return event;
        }
        
        function deleteCalendarEvent(eventId) {
            calendarEvents = calendarEvents.filter(e => e.id !== eventId);
            saveCalendarEvents();
            renderCalendar();
        }
        
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            if (!grid) return;
            
            // Renderizar baseado na visualiza√ß√£o atual
            if (currentCalendarView === 'week') {
                renderWeekView();
                return;
            } else if (currentCalendarView === 'day') {
                renderDayView();
                return;
            }
            
            // Visualiza√ß√£o mensal (padr√£o)
            grid.className = 'calendar-grid';
            
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const holidays = getHolidays(year);

            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const calendarTitle = document.getElementById('calendarTitle');
            if (calendarTitle) {
                calendarTitle.textContent = `${months[month]} ${year}`;
            }

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Estat√≠sticas do m√™s
            let coursesInMonth = 0;
            let coursesStarting = 0;
            let coursesEnding = 0;

            // Cabe√ßalhos apenas de segunda a sexta
            let html = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex']
                .map(day => `<div class="calendar-day-header">${day}</div>`)
                .join('');

            const prevMonth = new Date(year, month, 0);
            const prevMonthDays = prevMonth.getDate();
            let daysFromPrevMonth = 0;
            
            if (startDay === 0) {
                daysFromPrevMonth = 5;
            } else if (startDay === 6) {
                daysFromPrevMonth = 1;
            } else if (startDay > 1) {
                daysFromPrevMonth = startDay - 1;
            }

            for (let i = daysFromPrevMonth - 1; i >= 0; i--) {
                const day = prevMonthDays - i;
                html += `<div class="calendar-day other-month"><div class="calendar-date">${day}</div></div>`;
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayOfWeek = date.getDay();
                
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    continue;
                }

                const isToday = date.getTime() === today.getTime();
                const dateStr = date.toISOString().split('T')[0];
                
                // Verificar feriado
                const holiday = holidays[dateStr];
                const isHoliday = !!holiday;

                // Cursos do dia - apenas in√≠cio e fim (n√£o mostrar em andamento)
                const events = cursos.filter(c => {
                    if (!c.inicio && !c.fim) return false;
                    return c.inicio === dateStr || c.fim === dateStr;
                });
                
                // Eventos personalizados do dia
                const customEvents = calendarEvents.filter(e => e.date === dateStr);
                
                // Contagem para estat√≠sticas
                events.forEach(c => {
                    if (c.inicio === dateStr) {
                        coursesStarting++;
                        coursesInMonth++;
                    }
                    if (c.fim === dateStr) coursesEnding++;
                });

                // HTML dos eventos de curso com preview
                let eventsHtml = events.slice(0, 3).map(c => {
                    const statusClass = 'status-' + getStatusClass(c.status);
                    const isStart = c.inicio === dateStr;
                    const isEnd = c.fim === dateStr;
                    const eventClass = isStart ? 'start' : 'end';
                    const label = isStart ? '‚ñ∂ In√≠cio' : '‚ñ† Fim';
                    return `<div class="calendar-event ${eventClass} ${statusClass}" 
                                data-course-id="${c.id}"
                                onmouseenter="showCoursePreview(event, '${c.id}')"
                                onmouseleave="hideCoursePreview()"
                                onclick="openCourseModal('${c.id}')"
                                title="${label}: ${c.curso}">
                                <span class="event-label">${label}</span> ${c.curso || c.lote}
                            </div>`;
                }).join('');
                
                // Eventos personalizados
                eventsHtml += customEvents.slice(0, 1).map(e => {
                    return `<div class="calendar-event custom-event" style="background: ${e.color};" 
                                onclick="showEventDetails('${e.id}')"
                                title="${e.title}">${e.title}</div>`;
                }).join('');

                const totalEvents = events.length + customEvents.length;
                if (totalEvents > 3) {
                    eventsHtml += `<div class="calendar-event more-events">+${totalEvents - 3} mais</div>`;
                }
                
                // Indicador de quantidade
                const countBadge = totalEvents > 0 ? `<div class="day-course-count">${totalEvents}</div>` : '';
                
                // Nome do feriado
                const holidayHtml = isHoliday ? `<div class="holiday-name" title="${holiday}">${holiday}</div>` : '';

                html += `
                    <div class="calendar-day${isToday ? ' today' : ''}${isHoliday ? ' holiday' : ''}" 
                         data-date="${dateStr}"
                         ondblclick="openAddEventModal('${dateStr}')">
                        <div class="calendar-date">${day}</div>
                        ${holidayHtml}
                        ${countBadge}
                        ${eventsHtml}
                        <button class="add-event-btn" onclick="openAddEventModal('${dateStr}')" title="Adicionar evento">
                            <span class="material-icons">add</span>
                        </button>
                    </div>
                `;
            }

            const lastDayOfMonth = new Date(year, month, daysInMonth);
            const lastDayOfWeek = lastDayOfMonth.getDay();
            
            let daysFromNextMonth = 0;
            if (lastDayOfWeek === 0 || lastDayOfWeek === 6) {
                daysFromNextMonth = 0;
            } else if (lastDayOfWeek < 5) {
                daysFromNextMonth = 5 - lastDayOfWeek;
            }

            for (let i = 1; i <= daysFromNextMonth; i++) {
                html += `<div class="calendar-day other-month"><div class="calendar-date">${i}</div></div>`;
            }

            grid.innerHTML = html;
            
            // Atualizar estat√≠sticas
            const totalCoursesEl = document.getElementById('totalCoursesMonth');
            const startingEl = document.getElementById('coursesStartingMonth');
            const endingEl = document.getElementById('coursesEndingMonth');
            
            if (totalCoursesEl) totalCoursesEl.textContent = coursesInMonth;
            if (startingEl) startingEl.textContent = coursesStarting;
            if (endingEl) endingEl.textContent = coursesEnding;
        }
        
        // Preview do curso ao passar o mouse
        function showCoursePreview(event, courseId) {
            const course = cursos.find(c => c.id === courseId);
            if (!course) return;
            
            const tooltip = document.getElementById('coursePreviewTooltip');
            if (!tooltip) return;
            
            const statusClass = getStatusClass(course.status);
            
            tooltip.querySelector('.preview-status').className = 'preview-status ' + statusClass;
            tooltip.querySelector('.preview-title').textContent = course.curso || course.lote || 'Sem nome';
            tooltip.querySelector('.preview-instructor').textContent = course.instrutor || 'N√£o definido';
            tooltip.querySelector('.preview-location').textContent = course.local || course.cidade || 'N√£o definido';
            tooltip.querySelector('.preview-dates').textContent = `${formatDateBR(course.inicio)} - ${formatDateBR(course.fim)}`;
            tooltip.querySelector('.preview-students').textContent = `${course.alunos || 0} alunos`;
            
            // Posicionar tooltip
            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = rect.right + 10 + 'px';
            tooltip.style.top = rect.top + 'px';
            tooltip.style.display = 'block';
            
            // Ajustar se sair da tela
            const tooltipRect = tooltip.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
                tooltip.style.left = rect.left - tooltipRect.width - 10 + 'px';
            }
            if (tooltipRect.bottom > window.innerHeight) {
                tooltip.style.top = window.innerHeight - tooltipRect.height - 10 + 'px';
            }
        }
        
        function hideCoursePreview() {
            const tooltip = document.getElementById('coursePreviewTooltip');
            if (tooltip) tooltip.style.display = 'none';
        }
        
        function formatDateBR(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }
        
        // Modal para adicionar evento
        function openAddEventModal(dateStr) {
            const modal = document.getElementById('addEventModal');
            if (!modal) {
                createAddEventModal();
            }
            
            document.getElementById('eventDate').value = dateStr;
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventColor').value = '#6366f1';
            document.getElementById('addEventModal').classList.add('active');
        }
        
        function createAddEventModal() {
            const modalHtml = `
                <div class="modal-overlay" id="addEventModal">
                    <div class="modal" style="max-width: 450px;">
                        <div class="modal-header">
                            <h3>Adicionar Evento</h3>
                            <button class="modal-close" onclick="closeModal('addEventModal')">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addEventForm" onsubmit="handleAddEvent(event)">
                                <div class="form-group">
                                    <label class="form-label">Data</label>
                                    <input type="date" id="eventDate" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√≠tulo do Evento *</label>
                                    <input type="text" id="eventTitle" class="form-input" required placeholder="Ex: Reuni√£o, Prazo, Lembrete...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Descri√ß√£o</label>
                                    <textarea id="eventDescription" class="form-input" rows="3" placeholder="Detalhes do evento..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cor</label>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <input type="color" id="eventColor" value="#6366f1" style="width: 50px; height: 40px; border: none; cursor: pointer;">
                                        <button type="button" class="color-preset" style="background: #6366f1;" onclick="document.getElementById('eventColor').value='#6366f1'"></button>
                                        <button type="button" class="color-preset" style="background: #22c55e;" onclick="document.getElementById('eventColor').value='#22c55e'"></button>
                                        <button type="button" class="color-preset" style="background: #f59e0b;" onclick="document.getElementById('eventColor').value='#f59e0b'"></button>
                                        <button type="button" class="color-preset" style="background: #ef4444;" onclick="document.getElementById('eventColor').value='#ef4444'"></button>
                                        <button type="button" class="color-preset" style="background: #8b5cf6;" onclick="document.getElementById('eventColor').value='#8b5cf6'"></button>
                                        <button type="button" class="color-preset" style="background: #ec4899;" onclick="document.getElementById('eventColor').value='#ec4899'"></button>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="closeModal('addEventModal')">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons">add</span>
                                        Adicionar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function handleAddEvent(e) {
            e.preventDefault();
            const date = document.getElementById('eventDate').value;
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const color = document.getElementById('eventColor').value;
            
            if (!title) {
                showToast('Informe o t√≠tulo do evento', 'error');
                return;
            }
            
            addCalendarEvent(date, title, description, color);
            closeModal('addEventModal');
            showToast('Evento adicionado!', 'success');
        }
        
        function showEventDetails(eventId) {
            const event = calendarEvents.find(e => e.id === eventId);
            if (!event) return;
            
            if (confirm(`Evento: ${event.title}\n\n${event.description || 'Sem descri√ß√£o'}\n\nDeseja excluir este evento?`)) {
                deleteCalendarEvent(eventId);
                showToast('Evento removido', 'info');
            }
        }

        function changeMonth(delta) {
            switch (currentCalendarView) {
                case 'week':
                    currentMonth.setDate(currentMonth.getDate() + (delta * 7));
                    break;
                case 'day':
                    currentMonth.setDate(currentMonth.getDate() + delta);
                    break;
                default:
                    currentMonth.setMonth(currentMonth.getMonth() + delta);
            }
            renderCalendar();
        }

        function goToToday() {
            currentMonth = new Date();
            renderCalendar();
        }
        
        // Navega√ß√£o por teclado
        function setupCalendarKeyboardNav() {
            document.addEventListener('keydown', (e) => {
                const calendarPage = document.getElementById('calendarPage');
                if (!calendarPage?.classList.contains('active')) return;
                
                if (e.key === 'ArrowLeft') {
                    changeMonth(-1);
                } else if (e.key === 'ArrowRight') {
                    changeMonth(1);
                }
            });
        }
        
        // Date picker para ir para data espec√≠fica
        function setupCalendarDatePicker() {
            const picker = document.getElementById('calendarDatePicker');
            if (picker) {
                picker.addEventListener('change', (e) => {
                    if (e.target.value) {
                        const date = new Date(e.target.value + 'T00:00:00');
                        currentMonth = date;
                        renderCalendar();
                    }
                });
            }
            
            // Bot√µes de visualiza√ß√£o
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCalendarView = btn.dataset.view;
                    renderCalendar();
                });
            });
        }
        
        // Renderizar visualiza√ß√£o semanal
        function renderWeekView() {
            const grid = document.getElementById('calendarGrid');
            if (!grid) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // In√≠cio da semana (segunda-feira)
            const startOfWeek = new Date(currentMonth);
            const dayOfWeek = startOfWeek.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            startOfWeek.setDate(startOfWeek.getDate() + diff);
            
            const holidays = getHolidays(currentMonth.getFullYear());
            
            // Atualizar t√≠tulo
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(endOfWeek.getDate() + 4);
            const calendarTitle = document.getElementById('calendarTitle');
            if (calendarTitle) {
                calendarTitle.textContent = `${startOfWeek.getDate()}/${startOfWeek.getMonth() + 1} - ${endOfWeek.getDate()}/${endOfWeek.getMonth() + 1}/${endOfWeek.getFullYear()}`;
            }
            
            // Cabe√ßalhos
            let html = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex']
                .map(day => `<div class="calendar-day-header">${day}</div>`)
                .join('');
            
            // Dias da semana (segunda a sexta)
            for (let i = 0; i < 5; i++) {
                const date = new Date(startOfWeek);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const isToday = date.getTime() === today.getTime();
                const holiday = holidays[dateStr];
                
                // Eventos do dia
                const events = cursos.filter(c => c.inicio === dateStr || c.fim === dateStr);
                const customEvents = calendarEvents.filter(e => e.date === dateStr);
                
                let eventsHtml = events.map(c => {
                    const isStart = c.inicio === dateStr;
                    const eventClass = isStart ? 'start' : 'end';
                    const label = isStart ? '‚ñ∂ In√≠cio' : '‚ñ† Fim';
                    return `<div class="calendar-event ${eventClass}" 
                                onclick="openCourseModal('${c.id}')"
                                onmouseenter="showCoursePreview(event, '${c.id}')"
                                onmouseleave="hideCoursePreview()">
                                <span class="event-label">${label}</span> ${c.curso || c.lote}
                            </div>`;
                }).join('');
                
                eventsHtml += customEvents.map(e => 
                    `<div class="calendar-event custom-event" style="background: ${e.color};" onclick="showEventDetails('${e.id}')">${e.title}</div>`
                ).join('');
                
                const totalEvents = events.length + customEvents.length;
                const countBadge = totalEvents > 0 ? `<div class="day-course-count">${totalEvents}</div>` : '';
                const holidayHtml = holiday ? `<div class="holiday-name">${holiday}</div>` : '';
                
                html += `
                    <div class="calendar-day week-view-day${isToday ? ' today' : ''}${holiday ? ' holiday' : ''}" 
                         data-date="${dateStr}" ondblclick="openAddEventModal('${dateStr}')">
                        <div class="calendar-date">${date.getDate()}</div>
                        ${holidayHtml}
                        ${countBadge}
                        ${eventsHtml}
                        <button class="add-event-btn" onclick="openAddEventModal('${dateStr}')">
                            <span class="material-icons">add</span>
                        </button>
                    </div>
                `;
            }
            
            grid.innerHTML = html;
            grid.className = 'calendar-grid week-view';
            updateCalendarStats();
        }
        
        // Renderizar visualiza√ß√£o di√°ria
        function renderDayView() {
            const grid = document.getElementById('calendarGrid');
            if (!grid) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dateStr = currentMonth.toISOString().split('T')[0];
            const isToday = currentMonth.toDateString() === today.toDateString();
            const holidays = getHolidays(currentMonth.getFullYear());
            const holiday = holidays[dateStr];
            
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const weekDays = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            
            const calendarTitle = document.getElementById('calendarTitle');
            if (calendarTitle) {
                calendarTitle.textContent = `${weekDays[currentMonth.getDay()]}, ${currentMonth.getDate()} de ${months[currentMonth.getMonth()]}`;
            }
            
            // Eventos do dia
            const events = cursos.filter(c => c.inicio === dateStr || c.fim === dateStr);
            const customEvents = calendarEvents.filter(e => e.date === dateStr);
            
            let eventsHtml = '';
            
            if (events.length === 0 && customEvents.length === 0) {
                eventsHtml = `
                    <div class="day-view-empty">
                        <span class="material-icons">event_available</span>
                        <p>Nenhum evento para este dia</p>
                        <button class="btn btn-primary" onclick="openAddEventModal('${dateStr}')">
                            <span class="material-icons">add</span> Adicionar Evento
                        </button>
                    </div>
                `;
            } else {
                eventsHtml = `<div class="day-view-events">`;
                
                events.forEach(c => {
                    const isStart = c.inicio === dateStr;
                    const label = isStart ? '‚ñ∂ In√≠cio do Curso' : '‚ñ† Fim do Curso';
                    const statusClass = 'status-' + getStatusClass(c.status);
                    eventsHtml += `
                        <div class="day-view-event ${statusClass}" onclick="openCourseModal('${c.id}')">
                            <div class="day-event-header">
                                <span class="day-event-type ${isStart ? 'start' : 'end'}">${label}</span>
                                <span class="day-event-status">${normalizeStatus(c.status)}</span>
                            </div>
                            <div class="day-event-title">${c.curso || c.lote}</div>
                            <div class="day-event-info">
                                <span><span class="material-icons">person</span> ${c.instrutor || 'Sem instrutor'}</span>
                                <span><span class="material-icons">location_on</span> ${c.local || c.cidade || 'Sem local'}</span>
                                <span><span class="material-icons">groups</span> ${c.alunos || 0} alunos</span>
                            </div>
                        </div>
                    `;
                });
                
                customEvents.forEach(e => {
                    eventsHtml += `
                        <div class="day-view-event custom" style="border-left-color: ${e.color};" onclick="showEventDetails('${e.id}')">
                            <div class="day-event-header">
                                <span class="day-event-type" style="background: ${e.color};">üìå Evento</span>
                            </div>
                            <div class="day-event-title">${e.title}</div>
                            ${e.description ? `<div class="day-event-description">${e.description}</div>` : ''}
                        </div>
                    `;
                });
                
                eventsHtml += `</div>`;
            }
            
            grid.innerHTML = `
                <div class="day-view-container${isToday ? ' today' : ''}${holiday ? ' holiday' : ''}">
                    ${holiday ? `<div class="day-view-holiday"><span class="material-icons">celebration</span> ${holiday}</div>` : ''}
                    ${eventsHtml}
                    <button class="btn btn-secondary add-event-day-btn" onclick="openAddEventModal('${dateStr}')">
                        <span class="material-icons">add</span> Adicionar Evento
                    </button>
                </div>
            `;
            
            grid.className = 'calendar-grid day-view';
            updateCalendarStats();
        }
        
        // Atualizar estat√≠sticas do calend√°rio
        function updateCalendarStats() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            let coursesStarting = 0;
            let coursesEnding = 0;
            let coursesInMonth = 0;
            
            cursos.forEach(c => {
                if (c.inicio) {
                    const startDate = new Date(c.inicio + 'T00:00:00');
                    if (startDate.getFullYear() === year && startDate.getMonth() === month) {
                        coursesStarting++;
                        coursesInMonth++;
                    }
                }
                if (c.fim) {
                    const endDate = new Date(c.fim + 'T00:00:00');
                    if (endDate.getFullYear() === year && endDate.getMonth() === month) {
                        coursesEnding++;
                    }
                }
            });
            
            const totalCoursesEl = document.getElementById('totalCoursesMonth');
            const startingEl = document.getElementById('coursesStartingMonth');
            const endingEl = document.getElementById('coursesEndingMonth');
            
            if (totalCoursesEl) totalCoursesEl.textContent = coursesInMonth;
            if (startingEl) startingEl.textContent = coursesStarting;
            if (endingEl) endingEl.textContent = coursesEnding;
        }
        
        // Modificar changeMonth para suportar diferentes views
        function changeCalendarPeriod(delta) {
            switch (currentCalendarView) {
                case 'week':
                    currentMonth.setDate(currentMonth.getDate() + (delta * 7));
                    break;
                case 'day':
                    currentMonth.setDate(currentMonth.getDate() + delta);
                    break;
                default:
                    currentMonth.setMonth(currentMonth.getMonth() + delta);
            }
            renderCalendar();
        }

        // Modal Functions
        function openCourseModal(courseId = null) {
            editingCourseId = courseId;
            const modal = document.getElementById('courseModal');
            const title = document.getElementById('courseModalTitle');
            const form = document.getElementById('courseForm');

            form.reset();
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));

            if (courseId) {
                const course = cursos.find(c => c.id === courseId);
                if (course) {
                    title.textContent = 'Editar Curso';
                    document.getElementById('courseName').value = course.curso || '';
                    document.getElementById('courseIdLote').value = course.idLote || '';
                    document.getElementById('courseLote').value = course.lote || course.loteResponsavel || '';
                    document.getElementById('courseCargaHoraria').value = course.cargaHoraria || '';
                    document.getElementById('courseCity').value = course.cidade || '';
                    document.getElementById('courseStart').value = course.inicio || '';
                    document.getElementById('courseEnd').value = course.fim || '';
                    document.getElementById('courseStatus').value = course.status || 'Pendente';
                    document.getElementById('courseStudents').value = course.alunos || 0;
                    document.getElementById('courseInstructor').value = course.instrutor || '';
                    document.getElementById('courseDriveLink').value = course.driveLink || '';
                    document.getElementById('courseNote').value = course.nota || '';
                }
            } else {
                title.textContent = 'Novo Curso';
            }

            modal.classList.add('active');
        }

        function openInstructorModal(instructorId = null) {
            editingInstructorId = instructorId;
            const modal = document.getElementById('instructorModal');
            if (!modal) {
                console.error('Modal de instrutor n√£o encontrado!');
                return;
            }
            const title = document.getElementById('instructorModalTitle');
            const form = document.getElementById('instructorForm');
            if (!form) {
                console.error('Formul√°rio de instrutor n√£o encontrado!');
                return;
            }

            form.reset();
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));

            if (instructorId) {
                const instructor = instrutores.find(i => i.id === instructorId);
                if (instructor) {
                    title.textContent = 'Editar Instrutor';
                    document.getElementById('instructorName').value = instructor.nome || '';
                    document.getElementById('instructorSpecialty').value = instructor.especialidade || '';
                    document.getElementById('instructorPhone').value = instructor.telefone || '';
                    document.getElementById('instructorEmail').value = instructor.email || '';
                }
            } else {
                title.textContent = 'Novo Instrutor';
            }

            modal.classList.add('active');
        }

        function openQuickInstructorModal() {
            document.getElementById('quickInstructorForm').reset();
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
            document.getElementById('quickInstructorModal').classList.add('active');
        }

        function openUserModal(userId = null) {
            editingUserId = userId;
            const modal = document.getElementById('userModal');
            const title = document.getElementById('userModalTitle');
            const form = document.getElementById('userForm');

            form.reset();
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));

            if (userId) {
                const user = usuarios.find(u => u.id === userId);
                if (user) {
                    title.textContent = 'Editar Usu√°rio';
                    document.getElementById('newUserName').value = user.name || '';
                    document.getElementById('newUserUsername').value = user.username || '';
                    document.getElementById('newUserEmail').value = user.email || '';
                    document.getElementById('newUserPassword').value = '';
                    document.getElementById('newUserRole').value = user.role || 'viewer';
                }
            } else {
                title.textContent = 'Novo Usu√°rio';
            }

            modal.classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            const form = document.getElementById(`${modalId.replace('Modal', 'Form')}`);
            if (form) {
                form.reset();
            }
            document.querySelectorAll(`#${modalId} .form-error`).forEach(el => el.classList.remove('show'));
        }
        
        // Fechar modal ao clicar fora dele
        function setupModalCloseOnOutsideClick() {
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    // Fechar apenas se clicou diretamente no overlay (n√£o no modal interno)
                    if (e.target === overlay) {
                        const modalId = overlay.id;
                        closeModal(modalId);
                    }
                });
            });
        }

        async function handleCourseSubmit(e) {
            e.preventDefault();
            
            // Valida√ß√µes
            const idLote = document.getElementById('courseIdLote').value.trim();
            const lote = document.getElementById('courseLote').value.trim();
            const inicio = document.getElementById('courseStart').value;
            const fim = document.getElementById('courseEnd').value;
            
            // Limpar erros anteriores
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
            
            let hasError = false;
            
            // Validar ID do LOTE (opcional, mas se preenchido deve ser v√°lido)
            if (idLote && (isNaN(parseInt(idLote)) || parseInt(idLote) <= 0)) {
                document.getElementById('courseIdLote').classList.add('error');
                showToast('ID do LOTE deve ser um n√∫mero positivo', 'error');
                hasError = true;
            }
            
            // Validar LOTE (opcional, mas se preenchido deve ter pelo menos 2 caracteres)
            if (lote && lote.length < 2) {
                document.getElementById('courseLote').classList.add('error');
                showToast('LOTE deve ter pelo menos 2 caracteres', 'error');
                hasError = true;
            }
            
            // Validar datas
            if (inicio && fim) {
                const startDate = new Date(inicio);
                const endDate = new Date(fim);
                if (endDate < startDate) {
                    document.getElementById('courseEnd').classList.add('error');
                    showToast('Data de fim n√£o pode ser anterior √† data de in√≠cio', 'error');
                    hasError = true;
                }
            }
            
            // Validar URL do Drive se fornecida
            const driveLink = document.getElementById('courseDriveLink').value.trim();
            if (driveLink && !isValidUrl(driveLink)) {
                document.getElementById('courseDriveLink').classList.add('error');
                showToast('URL do Google Drive inv√°lida', 'error');
                hasError = true;
            }
            
            if (hasError) return;
            
            // Remover classes de erro dos campos v√°lidos
            document.querySelectorAll('.form-input, .form-select').forEach(el => {
                if (!el.classList.contains('error')) {
                    el.classList.remove('error');
                }
            });
            
            const courseData = {
                curso: document.getElementById('courseName').value.trim(),
                idLote: idLote ? parseInt(idLote) : 0,
                lote: lote || '',
                loteResponsavel: lote || '',
                cargaHoraria: document.getElementById('courseCargaHoraria').value,
                cidade: document.getElementById('courseCity').value.trim(),
                inicio: inicio,
                fim: fim,
                status: normalizeStatus(document.getElementById('courseStatus').value || 'Pendente'),
                alunos: parseInt(document.getElementById('courseStudents').value) || 0,
                local: document.getElementById('courseLocation').value.trim(),
                instrutor: document.getElementById('courseInstructor').value,
                driveLink: driveLink,
                nota: document.getElementById('courseNote').value.trim()
            };
            
            // Validar n√∫mero de alunos
            if (courseData.alunos < 0) {
                showToast('N√∫mero de concludentes n√£o pode ser negativo', 'error');
                return;
            }

            // Mostrar loading
            setLoadingState(true);

            try {
                let changes = {};
                let oldCourse = null;
                
                if (editingCourseId) {
                    oldCourse = cursos.find(c => c.id === editingCourseId);
                    if (oldCourse) {
                        Object.keys(courseData).forEach(key => {
                            const oldValue = oldCourse[key];
                            const newValue = courseData[key];
                            // Comparar valores normalizados
                            if (key === 'status') {
                                if (normalizeStatus(oldValue) !== normalizeStatus(newValue)) {
                                    changes[key] = { old: oldValue, new: newValue };
                                }
                            } else if (oldValue !== newValue) {
                                changes[key] = { old: oldValue !== null && oldValue !== undefined ? oldValue : '', new: newValue !== null && newValue !== undefined ? newValue : '' };
                            }
                        });
                    }
                }
                
                if (firebaseAvailable) {
                    if (editingCourseId) {
                        const docRef = await db.collection('cursos').doc(editingCourseId);
                        await docRef.update(courseData);
                        
                        if (Object.keys(changes).length > 0) {
                            addCourseHistoryEntry(editingCourseId, 'updated', changes, oldCourse);
                        }
                    } else {
                        const docRef = await db.collection('cursos').doc();
                        courseData.id = docRef.id;
                        await docRef.set(courseData);
                        addCourseHistoryEntry(courseData.id, 'created', { curso: { old: '', new: courseData.curso } });
                    }
                } else {
                    const existingCourses = JSON.parse(localStorage.getItem('cursos') || '[]');
                    if (editingCourseId) {
                        const index = existingCourses.findIndex(c => c.id === editingCourseId);
                        if (index !== -1) {
                            existingCourses[index] = { ...existingCourses[index], ...courseData };
                            if (Object.keys(changes).length > 0) {
                                addCourseHistoryEntry(editingCourseId, 'updated', changes, oldCourse);
                            }
                        }
                    } else {
                        courseData.id = 'course_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        existingCourses.push(courseData);
                        addCourseHistoryEntry(courseData.id, 'created', { curso: { old: '', new: courseData.curso } });
                    }
                    localStorage.setItem('cursos', JSON.stringify(existingCourses));
                    loadFromLocalStorage();
                }
                
                if (editingCourseId) {
                    showToast('Curso atualizado com sucesso!', 'success');
                    logActivity('Edi√ß√£o de Curso', `Editou o curso "${courseData.curso || 'Sem nome'}"`, 'edit');
                } else {
                    showToast('Curso criado com sucesso!', 'success');
                    logActivity('Novo Curso', `Adicionou o curso "${courseData.curso || 'Sem nome'}"`, 'add');
                }
                closeModal('courseModal');
                
                // Atualizar renderiza√ß√£o de forma otimizada
                requestAnimationFrame(() => {
                    renderCalendar();
                    renderDashboardReport();
                    if (document.getElementById('coursesPage')?.classList.contains('active')) {
                        renderCoursesByLote();
                    }
                });
            } catch (error) {
                console.error('Error saving course:', error);
                showToast('Erro ao salvar curso: ' + (error.message || 'Erro desconhecido'), 'error');
            } finally {
                setLoadingState(false);
            }
        }
        
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }
        
        function setLoadingState(loading) {
            isLoading = loading;
            const overlay = document.getElementById('loadingOverlay');
            const buttons = document.querySelectorAll('button[type="submit"]');
            
            if (overlay) {
                if (loading) {
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            }
            
            buttons.forEach(btn => {
                if (loading) {
                    btn.disabled = true;
                    btn.style.opacity = '0.6';
                    btn.style.cursor = 'not-allowed';
                } else {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                }
            });
        }

        async function handleInstructorSubmit(e) {
            e.preventDefault();
            
            // Valida√ß√µes
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
            
            const nome = document.getElementById('instructorName').value.trim();
            const email = document.getElementById('instructorEmail').value.trim();
            const telefone = document.getElementById('instructorPhone').value.trim();
            
            let hasError = false;
            
            // Validar email se fornecido
            if (email && !isValidEmail(email)) {
                document.getElementById('instructorEmail').classList.add('error');
                showToast('Email inv√°lido', 'error');
                hasError = true;
            }
            
            // Validar telefone se fornecido
            if (telefone && !isValidPhone(telefone)) {
                document.getElementById('instructorPhone').classList.add('error');
                showToast('Telefone inv√°lido. Use o formato (00) 00000-0000', 'error');
                hasError = true;
            }
            
            if (hasError) return;
            
            const instructorData = {
                nome: nome || 'Instrutor sem nome',
                especialidade: document.getElementById('instructorSpecialty').value.trim(),
                telefone: telefone,
                email: email
            };
            
            // Remover classes de erro
            document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));

            setLoadingState(true);

            try {
                if (firebaseAvailable) {
                    if (editingInstructorId) {
                        await db.collection('instrutores').doc(editingInstructorId).update(instructorData);
                    } else {
                        await db.collection('instrutores').add(instructorData);
                    }
                } else {
                    const existingInstructors = JSON.parse(localStorage.getItem('instrutores') || '[]');
                    if (editingInstructorId) {
                        const index = existingInstructors.findIndex(i => i.id === editingInstructorId);
                        if (index !== -1) {
                            existingInstructors[index] = { ...existingInstructors[index], ...instructorData };
                        }
                    } else {
                        instructorData.id = 'instructor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        existingInstructors.push(instructorData);
                    }
                    localStorage.setItem('instrutores', JSON.stringify(existingInstructors));
                    loadFromLocalStorage();
                }
                
                if (editingInstructorId) {
                    showToast('Instrutor atualizado com sucesso!', 'success');
                    logActivity('Edi√ß√£o de Instrutor', `Editou o instrutor "${instructorData.nome || 'Sem nome'}"`, 'edit');
                } else {
                    showToast('Instrutor criado com sucesso!', 'success');
                    logActivity('Novo Instrutor', `Adicionou o instrutor "${instructorData.nome || 'Sem nome'}"`, 'add');
                }
                closeModal('instructorModal');
            } catch (error) {
                console.error('Error saving instructor:', error);
                showToast('Erro ao salvar instrutor: ' + (error.message || 'Erro desconhecido'), 'error');
            } finally {
                setLoadingState(false);
            }
        }
        
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function isValidPhone(phone) {
            // Aceita formatos: (00) 00000-0000, (00) 0000-0000, 00000000000, etc.
            const cleaned = phone.replace(/\D/g, '');
            return cleaned.length >= 10 && cleaned.length <= 11;
        }

        async function handleQuickInstructorSubmit(e) {
            e.preventDefault();
            
            const nome = document.getElementById('quickInstructorName').value.trim();

            try {
                if (firebaseAvailable) {
                    await db.collection('instrutores').add({ nome: nome || 'Novo Instrutor' });
                } else {
                    const existingInstructors = JSON.parse(localStorage.getItem('instrutores') || '[]');
                    existingInstructors.push({
                        id: 'instructor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        nome: nome || 'Novo Instrutor'
                    });
                    localStorage.setItem('instrutores', JSON.stringify(existingInstructors));
                    loadFromLocalStorage();
                }
                showToast('Instrutor adicionado!', 'success');
                logActivity('Novo Instrutor', `Adicionou o instrutor "${nome || 'Novo Instrutor'}" (r√°pido)`, 'add');
                closeModal('quickInstructorModal');
            } catch (error) {
                console.error('Error adding instructor:', error);
                showToast('Erro ao adicionar instrutor', 'error');
            }
        }

        async function handleUserSubmit(e) {
            e.preventDefault();
            
            // Valida√ß√µes
            document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
            
            const name = document.getElementById('newUserName').value.trim();
            const username = document.getElementById('newUserUsername').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value || 'viewer';
            
            let hasError = false;
            
            // Validar username (obrigat√≥rio e √∫nico)
            if (!username || username.length < 3) {
                document.getElementById('newUserUsername').classList.add('error');
                showToast('Username √© obrigat√≥rio e deve ter pelo menos 3 caracteres', 'error');
                hasError = true;
            } else {
                // Verificar se username j√° existe
                const existingUser = usuarios.find(u => u.username === username && u.id !== editingUserId);
                if (existingUser) {
                    document.getElementById('newUserUsername').classList.add('error');
                    showToast('Username j√° est√° em uso', 'error');
                    hasError = true;
                }
            }
            
            // Validar email se fornecido
            if (email && !isValidEmail(email)) {
                document.getElementById('newUserEmail').classList.add('error');
                showToast('Email inv√°lido', 'error');
                hasError = true;
            }
            
            // Validar senha (obrigat√≥ria para novos usu√°rios)
            if (!editingUserId && (!password || password.length < 4)) {
                document.getElementById('newUserPassword').classList.add('error');
                showToast('Senha √© obrigat√≥ria e deve ter pelo menos 4 caracteres', 'error');
                hasError = true;
            }
            
            // Validar senha se fornecida na edi√ß√£o
            if (editingUserId && password && password.length < 4) {
                document.getElementById('newUserPassword').classList.add('error');
                showToast('Senha deve ter pelo menos 4 caracteres', 'error');
                hasError = true;
            }
            
            if (hasError) return;
            
            const userData = {
                name: name || 'Novo Usu√°rio',
                username: username,
                email: email,
                password: password || (editingUserId ? usuarios.find(u => u.id === editingUserId)?.password : '123456'),
                role: role
            };
            
            // Remover classes de erro
            document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));

            setLoadingState(true);

            try {
                if (firebaseAvailable) {
                    if (editingUserId) {
                        await db.collection('usuarios').doc(editingUserId).update(userData);
                    } else {
                        await db.collection('usuarios').add(userData);
                    }
                } else {
                    const existingUsers = JSON.parse(localStorage.getItem('usuarios') || '[]');
                    if (editingUserId) {
                        const index = existingUsers.findIndex(u => u.id === editingUserId);
                        if (index !== -1) {
                            existingUsers[index] = { ...existingUsers[index], ...userData };
                        }
                    } else {
                        userData.id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        existingUsers.push(userData);
                    }
                    localStorage.setItem('usuarios', JSON.stringify(existingUsers));
                    loadFromLocalStorage();
                }
                
                if (editingUserId) {
                    showToast('Usu√°rio atualizado com sucesso!', 'success');
                    logActivity('Edi√ß√£o de Usu√°rio', `Editou o usu√°rio "${userData.name}"`, 'edit');
                } else {
                    showToast('Usu√°rio criado com sucesso!', 'success');
                    logActivity('Novo Usu√°rio', `Adicionou o usu√°rio "${userData.name}"`, 'add');
                }
                closeModal('userModal');
            } catch (error) {
                console.error('Error saving user:', error);
                showToast('Erro ao salvar usu√°rio: ' + (error.message || 'Erro desconhecido'), 'error');
            } finally {
                setLoadingState(false);
            }
        }

        async function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Preencha todos os campos', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showToast('As senhas n√£o coincidem', 'error');
                return;
            }

            if (newPassword.length < 4) {
                showToast('A nova senha deve ter pelo menos 4 caracteres', 'error');
                return;
            }

            // Verificar senha atual
            if (currentUser.password !== currentPassword) {
                showToast('Senha atual incorreta', 'error');
                return;
            }

            try {
                if (firebaseAvailable) {
                    await db.collection('usuarios').doc(currentUser.id).update({ password: newPassword });
                } else {
                    const existingUsers = JSON.parse(localStorage.getItem('usuarios') || '[]');
                    const index = existingUsers.findIndex(u => u.id === currentUser.id);
                    if (index !== -1) {
                        existingUsers[index].password = newPassword;
                        localStorage.setItem('usuarios', JSON.stringify(existingUsers));
                    }
                }

                // Atualizar o usu√°rio atual
                currentUser.password = newPassword;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showToast('Senha alterada com sucesso!', 'success');
                logActivity('Altera√ß√£o de Senha', `${currentUser.name} alterou sua senha`, 'edit');
                
                // Limpar formul√°rio
                document.getElementById('changePasswordForm').reset();
            } catch (error) {
                console.error('Error changing password:', error);
                showToast('Erro ao alterar senha', 'error');
            }
        }

        async function handleChangeName(e) {
            e.preventDefault();
            
            const newName = document.getElementById('newAdminName').value.trim();
            const currentNameDisplay = document.getElementById('currentNameDisplay');

            if (!newName) {
                showToast('Digite um novo nome', 'error');
                return;
            }

            if (newName.length < 2) {
                showToast('O nome deve ter pelo menos 2 caracteres', 'error');
                return;
            }

            const oldName = currentUser.name;

            try {
                if (firebaseAvailable) {
                    await db.collection('usuarios').doc(currentUser.id).update({ name: newName });
                } else {
                    const existingUsers = JSON.parse(localStorage.getItem('usuarios') || '[]');
                    const index = existingUsers.findIndex(u => u.id === currentUser.id);
                    if (index !== -1) {
                        existingUsers[index].name = newName;
                        localStorage.setItem('usuarios', JSON.stringify(existingUsers));
                    }
                }

                // Atualizar o usu√°rio atual
                currentUser.name = newName;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // Atualizar a sidebar
                document.getElementById('userName').textContent = newName;
                document.getElementById('userAvatar').textContent = newName.charAt(0).toUpperCase();
                
                // Atualizar o campo de nome atual
                currentNameDisplay.value = newName;

                showToast('Nome alterado com sucesso!', 'success');
                logActivity('Altera√ß√£o de Nome', `${oldName} alterou seu nome para "${newName}"`, 'edit');
                
                // Limpar formul√°rio
                document.getElementById('newAdminName').value = '';
            } catch (error) {
                console.error('Error changing name:', error);
                showToast('Erro ao alterar nome', 'error');
            }
        }


        async function deleteCourse(id) {
            if (!confirm('Tem certeza que deseja excluir este curso?')) return;

            try {
                const course = cursos.find(c => c.id === id);
                
                // Registrar no hist√≥rico antes de deletar
                if (course) {
                    addCourseHistoryEntry(id, 'deleted', { curso: { old: course.curso || 'Sem nome', new: '' } }, course);
                }
                
                if (firebaseAvailable) {
                    await db.collection('cursos').doc(id).delete();
                } else {
                    const existingCourses = JSON.parse(localStorage.getItem('cursos') || '[]');
                    const filteredCourses = existingCourses.filter(c => c.id !== id);
                    localStorage.setItem('cursos', JSON.stringify(filteredCourses));
                    loadFromLocalStorage();
                }
                
                showToast('Curso exclu√≠do!', 'success');
                logActivity('Exclus√£o de Curso', `Excluiu o curso "${course?.curso}"`, 'delete');
                
                    // Atualizar renderiza√ß√£o
                    renderCalendar();
                    renderDashboardReport();
                    if (document.getElementById('coursesPage')?.classList.contains('active')) {
                        renderCoursesByLote();
                    }
            } catch (error) {
                console.error('Error deleting course:', error);
                showToast('Erro ao excluir curso', 'error');
            }
        }

        async function deleteInstructor(id) {
            if (!confirm('Tem certeza que deseja excluir este instrutor?')) return;

            try {
                const instructor = instrutores.find(i => i.id === id);
                
                if (firebaseAvailable) {
                    await db.collection('instrutores').doc(id).delete();
                } else {
                    const existingInstructors = JSON.parse(localStorage.getItem('instrutores') || '[]');
                    const filteredInstructors = existingInstructors.filter(i => i.id !== id);
                    localStorage.setItem('instrutores', JSON.stringify(filteredInstructors));
                    loadFromLocalStorage();
                }
                
                showToast('Instrutor exclu√≠do!', 'success');
                logActivity('Exclus√£o de Instrutor', `Excluiu o instrutor "${instructor?.nome}"`, 'delete');
            } catch (error) {
                console.error('Error deleting instructor:', error);
                showToast('Erro ao excluir instrutor', 'error');
            }
        }

        async function deleteUser(id) {
            if (!confirm('Tem certeza que deseja excluir este usu√°rio?')) return;

            try {
                const user = usuarios.find(u => u.id === id);
                
                if (firebaseAvailable) {
                    await db.collection('usuarios').doc(id).delete();
                } else {
                    const existingUsers = JSON.parse(localStorage.getItem('usuarios') || '[]');
                    const filteredUsers = existingUsers.filter(u => u.id !== id);
                    localStorage.setItem('usuarios', JSON.stringify(filteredUsers));
                    loadFromLocalStorage();
                }
                
                showToast('Usu√°rio exclu√≠do!', 'success');
                logActivity('Exclus√£o de Usu√°rio', `Excluiu o usu√°rio "${user?.name}"`, 'delete');
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast('Erro ao excluir usu√°rio', 'error');
            }
        }

        // Import/Export Functions
        async function handleExcelUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Validar tipo de arquivo
            const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                               'application/vnd.ms-excel',
                               'application/excel'];
            const validExtensions = ['.xlsx', '.xls'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
                showToast('Por favor, selecione um arquivo Excel (.xlsx ou .xls)', 'error');
                return;
            }
            
            // Validar tamanho (m√°ximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('Arquivo muito grande. Tamanho m√°ximo: 10MB', 'error');
                return;
            }

            document.getElementById('selectedFileName').textContent = file.name;
            document.getElementById('fileInfoBox').classList.add('show');
            
            // Mostrar loading
            setLoadingState(true);
            showToast('Processando arquivo...', 'info');

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    // Usar cellDates: true para converter datas automaticamente
                    const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    // raw: false converte valores, mas mant√©m datas como objetos Date quando poss√≠vel
                    const json = XLSX.utils.sheet_to_json(worksheet, { raw: false, defval: '' });

                    let imported = 0;
                    let errors = [];
                    
                    // Processar em lotes para melhor performance
                    const batchSize = 10;
                    for (let i = 0; i < json.length; i += batchSize) {
                        const batch = json.slice(i, i + batchSize);
                        
                        for (const row of batch) {
                            try {
                        const loteValue = row['LOTE'] || row['lote'] || row['Lote'] || '';
                        
                        // Fun√ß√£o auxiliar para buscar valor de coluna com m√∫ltiplas varia√ß√µes (case-insensitive e flex√≠vel)
                        function getColumnValue(row, variations) {
                            // Normalizar string para compara√ß√£o (remover acentos, espa√ßos extras, etc)
                            function normalizeForComparison(str) {
                                return str.toLowerCase()
                                    .trim()
                                    .replace(/\s+/g, ' ')
                                    .replace(/[√ß√á]/g, 'c')
                                    .replace(/[√°√†√¢√£√§]/g, 'a')
                                    .replace(/[√©√®√™√´]/g, 'e')
                                    .replace(/[√≠√¨√Æ√Ø]/g, 'i')
                                    .replace(/[√≥√≤√¥√µ√∂]/g, 'o')
                                    .replace(/[√∫√π√ª√º]/g, 'u')
                                    .replace(/[√±]/g, 'n');
                            }
                            
                            // Primeiro, tentar varia√ß√µes exatas
                            for (const variation of variations) {
                                if (row[variation] !== undefined && row[variation] !== null && row[variation] !== '') {
                                    const value = row[variation];
                                    // Se for Date, retornar diretamente
                                    if (value instanceof Date) return value;
                                    // Caso contr√°rio, converter para string
                                    const strValue = String(value).trim();
                                    if (strValue) return strValue;
                                }
                            }
                            
                            // Se n√£o encontrou, tentar busca case-insensitive e flex√≠vel
                            const rowKeys = Object.keys(row);
                            for (const variation of variations) {
                                const variationNormalized = normalizeForComparison(variation);
                                for (const key of rowKeys) {
                                    const keyNormalized = normalizeForComparison(key);
                                    if (keyNormalized === variationNormalized) {
                                        const value = row[key];
                                        // Se for Date, retornar diretamente
                                        if (value instanceof Date) {
                                            if (i === 0 && imported === 0) {
                                                console.log(`‚úì Encontrado "${variation}" como "${key}" com valor Date:`, value);
                                            }
                                            return value;
                                        }
                                        // Caso contr√°rio, converter para string
                                        const strValue = String(value).trim();
                                        if (strValue) {
                                            if (i === 0 && imported === 0) {
                                                console.log(`‚úì Encontrado "${variation}" como "${key}" com valor:`, strValue);
                                            }
                                            return strValue;
                                        }
                                    }
                                }
                            }
                            
                            // √öltima tentativa: busca parcial (cont√©m)
                            for (const variation of variations) {
                                const variationNormalized = normalizeForComparison(variation);
                                // Buscar palavras-chave importantes
                                const keywords = variationNormalized.split(' ').filter(w => w.length > 3);
                                for (const key of rowKeys) {
                                    const keyNormalized = normalizeForComparison(key);
                                    // Verificar se todas as palavras-chave est√£o presentes
                                    if (keywords.length > 0 && keywords.every(kw => keyNormalized.includes(kw))) {
                                        const value = row[key];
                                        // Se for Date, retornar diretamente
                                        if (value instanceof Date) {
                                            if (i === 0 && imported === 0) {
                                                console.log(`‚úì Encontrado "${variation}" parcialmente como "${key}" com valor Date:`, value);
                                            }
                                            return value;
                                        }
                                        // Caso contr√°rio, converter para string
                                        const strValue = String(value).trim();
                                        if (strValue) {
                                            if (i === 0 && imported === 0) {
                                                console.log(`‚úì Encontrado "${variation}" parcialmente como "${key}" com valor:`, strValue);
                                            }
                                            return strValue;
                                        }
                                    }
                                }
                            }
                            
                            return '';
                        }
                        
                        // Buscar endere√ßo com todas as varia√ß√µes poss√≠veis
                        const endereco = getColumnValue(row, [
                            'ENDERE√áO', 'endere√ßo', 'Endere√ßo', 'ENDERECO', 'endereco', 'Endereco',
                            'LOCAL DO CURSO', 'local do curso', 'Local do Curso', 'Local Do Curso',
                            'LOCAL', 'local', 'Local',
                            'LOCAL_DO_CURSO', 'local_do_curso', 'Local_Do_Curso'
                        ]);
                        
                        // Debug do endere√ßo encontrado (apenas primeira linha)
                        if (i === 0 && imported === 0 && !endereco) {
                            console.warn('‚ö† Endere√ßo N√ÉO encontrado. Colunas dispon√≠veis:', Object.keys(row));
                        }
                        
                        const courseData = {
                            curso: getColumnValue(row, ['CURSO', 'curso', 'Curso']) || '',
                            idLote: parseInt(getColumnValue(row, ['ID', 'id', 'Id']) || '0') || 0,
                            lote: loteValue,
                            loteResponsavel: loteValue,
                            cidade: getColumnValue(row, ['CIDADE', 'cidade', 'Cidade', 'CIDADE ', 'cidade ']) || '',
                            inicio: (() => {
                                const dateValue = getColumnValue(row, [
                                    'DATA IN√çCIO', 'DATA INICIO', 'data in√≠cio', 'data inicio', 
                                    'IN√çCIO', 'inicio', 'INICIO', 'Data In√≠cio', 'Data Inicio',
                                    'DATA INICIO', 'Data Inicio', 'Data inicio'
                                ]);
                                // Se for um objeto Date, converter diretamente
                                if (dateValue instanceof Date) {
                                    const year = dateValue.getFullYear();
                                    const month = String(dateValue.getMonth() + 1).padStart(2, '0');
                                    const day = String(dateValue.getDate()).padStart(2, '0');
                                    const formatted = `${year}-${month}-${day}`;
                                    if (i === 0 && imported === 0) {
                                        console.log('Data in√≠cio (Date object):', dateValue, '‚Üí Formatada:', formatted);
                                    }
                                    return formatted;
                                }
                                
                                const formatted = formatExcelDate(dateValue);
                                if (i === 0 && imported === 0 && dateValue) {
                                    console.log('Data in√≠cio original:', dateValue, typeof dateValue, '‚Üí Formatada:', formatted);
                                }
                                return formatted;
                            })(),
                            fim: (() => {
                                const dateValue = getColumnValue(row, [
                                    'DATA FIM', 'data fim', 'FIM', 'fim', 'Data Fim',
                                    'DATA FIM ', 'Data Fim', 'Data fim'
                                ]);
                                
                                // Se for um objeto Date, converter diretamente
                                if (dateValue instanceof Date) {
                                    const year = dateValue.getFullYear();
                                    const month = String(dateValue.getMonth() + 1).padStart(2, '0');
                                    const day = String(dateValue.getDate()).padStart(2, '0');
                                    const formatted = `${year}-${month}-${day}`;
                                    if (i === 0 && imported === 0) {
                                        console.log('Data fim (Date object):', dateValue, '‚Üí Formatada:', formatted);
                                    }
                                    return formatted;
                                }
                                
                                const formatted = formatExcelDate(dateValue);
                                if (i === 0 && imported === 0 && dateValue) {
                                    console.log('Data fim original:', dateValue, typeof dateValue, '‚Üí Formatada:', formatted);
                                }
                                return formatted;
                            })(),
                            local: endereco,
                            status: normalizeStatus(getColumnValue(row, ['STATUS', 'status', 'Status']) || 'Pendente'),
                            alunos: parseInt(getColumnValue(row, ['CONCLUDENTES', 'concludentes', 'Concludentes']) || '0') || 0,
                            cargaHoraria: getColumnValue(row, [
                                'CARGA HOR√ÅRIA', 'carga hor√°ria', 'CARGA HORARIA', 'carga horaria',
                                'Carga Hor√°ria', 'Carga Horaria', 'CARGA_HOR√ÅRIA', 'carga_hor√°ria'
                            ]) || '',
                            instrutor: getColumnValue(row, ['INSTRUTOR', 'instrutor', 'Instrutor']) || '',
                            telefone: getColumnValue(row, ['TELEFONE', 'telefone', 'Telefone']) || '',
                            driveLink: '',
                            nota: ''
                        };

                        const newId = 'course_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9) + '_' + imported;
                        const courseWithId = {...courseData, id: newId};
                        
                        if (firebaseAvailable) {
                            try {
                                const docRef = await db.collection('cursos').add(courseData);
                                const courseWithFirebaseId = {...courseData, id: docRef.id};
                                cursos.push(courseWithFirebaseId);
                                        imported++;
                            } catch (err) {
                                console.error('Erro ao adicionar curso no Firebase:', err);
                                        errors.push(`Linha ${i + 1}: ${err.message || 'Erro desconhecido'}`);
                            }
                        } else {
                            const existingCourses = JSON.parse(localStorage.getItem('cursos') || '[]');
                            existingCourses.push(courseWithId);
                            cursos.push(courseWithId);
                            localStorage.setItem('cursos', JSON.stringify(existingCourses));
                        imported++;
                                }
                            } catch (err) {
                                console.error('Erro ao processar linha:', err);
                                errors.push(`Linha ${i + 1}: ${err.message || 'Erro ao processar'}`);
                            }
                        }
                        
                        // Pequeno delay entre lotes para n√£o sobrecarregar
                        if (i + batchSize < json.length) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                    }

                    // Sempre remover loading primeiro
                    setLoadingState(false);

                    if (imported > 0) {
                        let message = `${imported} curso${imported !== 1 ? 's' : ''} importado${imported !== 1 ? 's' : ''} com sucesso!`;
                        if (errors.length > 0) {
                            message += ` (${errors.length} erro${errors.length !== 1 ? 's' : ''})`;
                        }
                        showToast(message, errors.length > 0 ? 'warning' : 'success');
                        logActivity('Importa√ß√£o', `Importou ${imported} curso${imported !== 1 ? 's' : ''} de planilha`, 'add');
                        
                        // Atualizar KPIs e renderiza√ß√µes de forma otimizada
                        requestAnimationFrame(() => {
                        updateKPIs();
                        renderCalendar();
                        renderDashboardReport();
                        if (document.getElementById('coursesPage')?.classList.contains('active')) {
                            renderCoursesByLote();
                        }
                        });
                        
                        // Se Firebase, aguardar atualiza√ß√£o completa do banco
                        if (firebaseAvailable) {
                            setTimeout(() => {
                                loadData();
                            }, 1000);
                    } else {
                            // Atualizar dados locais
                            loadFromLocalStorage();
                    }
                    } else {
                        if (json.length === 0) {
                            showToast('Planilha vazia ou formato inv√°lido. Verifique o arquivo.', 'error');
                    } else {
                        showToast('Nenhum curso foi importado. Verifique o formato da planilha.', 'warning');
                        }
                    }
                    
                    // Limpar o input de arquivo
                    const excelFileInput = document.getElementById('excelFileInput');
                    if (excelFileInput) {
                        excelFileInput.value = '';
                    }
                    const fileInfoBox = document.getElementById('fileInfoBox');
                    if (fileInfoBox) {
                        fileInfoBox.classList.remove('show');
                    }
                } catch (error) {
                    console.error('Error importing:', error);
                    setLoadingState(false); // Garantir que o loading seja removido mesmo em caso de erro
                    showToast('Erro ao importar arquivo: ' + (error.message || 'Erro desconhecido'), 'error');
                    
                    // Limpar o input de arquivo mesmo em caso de erro
                    const excelFileInput = document.getElementById('excelFileInput');
                    if (excelFileInput) {
                        excelFileInput.value = '';
                    }
                    const fileInfoBox = document.getElementById('fileInfoBox');
                    if (fileInfoBox) {
                        fileInfoBox.classList.remove('show');
                    }
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function formatExcelDate(value) {
            if (!value && value !== 0) return '';
            
            // Se for n√∫mero (serial date do Excel)
            if (typeof value === 'number') {
                try {
                    // Excel serial date: n√∫mero de dias desde 1/1/1900
                    // Excel usa 1/1/1900 como dia 1, mas JavaScript usa 1/1/1970 como epoch
                    // Ajuste: Excel epoch √© 25569 dias antes do Unix epoch
                    const excelEpoch = new Date(1899, 11, 30); // 30/12/1899 (dia 0 do Excel)
                    const millisecondsPerDay = 86400 * 1000;
                    
                    // Validar se o n√∫mero √© razo√°vel (entre 1 e 100000, que cobre de 1900 a ~2173)
                    if (value < 1 || value > 100000) {
                        console.warn('Valor de data Excel fora do range esperado:', value);
                        return '';
                    }
                    
                    const date = new Date(excelEpoch.getTime() + (value - 1) * millisecondsPerDay);
                    
                    // Verificar se a data √© v√°lida
                    if (!isNaN(date.getTime()) && date.getFullYear() >= 1900 && date.getFullYear() <= 2100) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    } else {
                        console.warn('Data inv√°lida gerada:', date, 'do valor:', value);
                    }
                } catch (e) {
                    console.warn('Erro ao converter data num√©rica:', value, e);
                }
            }
            
            // Se for string, tentar v√°rios formatos
            if (typeof value === 'string') {
                const trimmed = value.trim();
                if (!trimmed) return '';
                
                // Remover caracteres estranhos que podem aparecer
                const cleaned = trimmed.replace(/[^\d\/\-\.]/g, '');
                
                // Formato brasileiro: DD/MM/YYYY ou DD-MM-YYYY
                const brFormat = cleaned.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/);
                if (brFormat) {
                    let day = brFormat[1].padStart(2, '0');
                    let month = brFormat[2].padStart(2, '0');
                    let year = brFormat[3];
                    if (year.length === 2) {
                        year = '20' + year; // Assume s√©culo 21
                    }
                    // Validar valores
                    const dayNum = parseInt(day);
                    const monthNum = parseInt(month);
                    const yearNum = parseInt(year);
                    if (dayNum >= 1 && dayNum <= 31 && monthNum >= 1 && monthNum <= 12 && yearNum >= 1900 && yearNum <= 2100) {
                        const date = new Date(`${year}-${month}-${day}`);
                        if (!isNaN(date.getTime())) {
                    return date.toISOString().split('T')[0];
                }
                    }
                }
                
                // Formato ISO: YYYY-MM-DD
                const isoFormat = cleaned.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);
                if (isoFormat) {
                    const year = isoFormat[1];
                    const month = isoFormat[2].padStart(2, '0');
                    const day = isoFormat[3].padStart(2, '0');
                    const date = new Date(`${year}-${month}-${day}`);
                    if (!isNaN(date.getTime())) {
                        return date.toISOString().split('T')[0];
                    }
                }
                
                // Tentar parse direto (pode ser uma data j√° formatada)
                try {
                    const date = new Date(trimmed);
                    if (!isNaN(date.getTime()) && date.getFullYear() >= 1900 && date.getFullYear() <= 2100) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    }
                } catch (e) {
                    console.warn('Erro ao fazer parse da data:', trimmed, e);
                }
            }
            
            // Se chegou aqui, n√£o conseguiu converter
            console.warn('N√£o foi poss√≠vel converter a data:', value, typeof value);
            return '';
        }
        
        // Fun√ß√£o para importar instrutores
        async function handleInstructorsUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Validar tipo de arquivo
            const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                               'application/vnd.ms-excel',
                               'application/excel'];
            const validExtensions = ['.xlsx', '.xls'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
                showToast('Por favor, selecione um arquivo Excel (.xlsx ou .xls)', 'error');
                return;
            }
            
            // Validar tamanho (m√°ximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('Arquivo muito grande. Tamanho m√°ximo: 10MB', 'error');
                return;
            }
            
            // Mostrar loading
            setLoadingState(true);
            showToast('Processando arquivo de instrutores...', 'info');
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    // Usar cellDates: true para converter datas automaticamente
                    const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    // raw: false converte valores, mas mant√©m datas como objetos Date quando poss√≠vel
                    const json = XLSX.utils.sheet_to_json(worksheet, { raw: false, defval: '' });
                    
                    let imported = 0;
                    let errors = [];
                    
                    for (let i = 0; i < json.length; i++) {
                        const row = json[i];
                        try {
                            const nome = (row['NOME'] || row['nome'] || '').trim();
                            const telefone = (row['TELEFONE'] || row['telefone'] || '').trim();
                            
                            // Validar que pelo menos o nome foi fornecido
                            if (!nome) {
                                errors.push(`Linha ${i + 2}: Nome n√£o fornecido`);
                                continue;
                            }
                            
                            const instructorData = {
                                nome: nome,
                                telefone: telefone,
                                especialidade: '',
                                email: ''
                            };
                            
                            if (firebaseAvailable) {
                                try {
                                    await db.collection('instrutores').add(instructorData);
                                    imported++;
                                } catch (err) {
                                    console.error('Erro ao adicionar instrutor no Firebase:', err);
                                    errors.push(`Linha ${i + 2}: ${err.message || 'Erro desconhecido'}`);
                                }
                            } else {
                                const existingInstructors = JSON.parse(localStorage.getItem('instrutores') || '[]');
                                instructorData.id = 'instructor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9) + '_' + imported;
                                existingInstructors.push(instructorData);
                                instrutores.push(instructorData);
                                localStorage.setItem('instrutores', JSON.stringify(existingInstructors));
                                imported++;
                            }
                        } catch (err) {
                            console.error('Erro ao processar linha:', err);
                            errors.push(`Linha ${i + 2}: ${err.message || 'Erro ao processar'}`);
                        }
                    }
                    
                    // Sempre remover loading primeiro
                    setLoadingState(false);
                    
                    if (imported > 0) {
                        let message = `${imported} instrutor${imported !== 1 ? 'es' : ''} importado${imported !== 1 ? 's' : ''} com sucesso!`;
                        if (errors.length > 0) {
                            message += ` (${errors.length} erro${errors.length !== 1 ? 's' : ''})`;
                        }
                        showToast(message, errors.length > 0 ? 'warning' : 'success');
                        logActivity('Importa√ß√£o de Instrutores', `Importou ${imported} instrutor${imported !== 1 ? 'es' : ''} de planilha`, 'add');
                        
                        // Atualizar renderiza√ß√£o
                        requestAnimationFrame(() => {
                            renderInstructors();
                            updateInstructorSelect();
                        });
                        
                        // Se Firebase, aguardar atualiza√ß√£o completa do banco
                        if (firebaseAvailable) {
                            setTimeout(() => {
                                loadData();
                            }, 1000);
                        } else {
                            loadFromLocalStorage();
                        }
                    } else {
                        if (json.length === 0) {
                            showToast('Planilha vazia ou formato inv√°lido. Verifique o arquivo.', 'error');
                        } else {
                            showToast('Nenhum instrutor foi importado. Verifique o formato da planilha (colunas: NOME, TELEFONE).', 'warning');
                        }
                    }
                    
                    // Limpar o input de arquivo
                    const instructorsFileInput = document.getElementById('instructorsFileInput');
                    if (instructorsFileInput) {
                        instructorsFileInput.value = '';
                    }
                } catch (error) {
                    console.error('Error importing instructors:', error);
                    setLoadingState(false);
                    showToast('Erro ao importar arquivo: ' + (error.message || 'Erro desconhecido'), 'error');
                    
                    // Limpar o input de arquivo mesmo em caso de erro
                    const instructorsFileInput = document.getElementById('instructorsFileInput');
                    if (instructorsFileInput) {
                        instructorsFileInput.value = '';
                    }
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function exportCoursesToCsv() {
            const activeCourses = cursos;
            
            const headers = ['CURSO', 'ID', 'LOTE-RESPONS√ÅVEL', 'CARGA HOR√ÅRIA', 'CIDADE/MUNIC√çPIO', 'IN√çCIO', 'FIM', 'CONCLUDENTES', 'LOCAL DO CURSO', 'INSTRUTOR', 'STATUS', 'GOOGLE DRIVE', 'OBSERVA√á√ÉO'];
            const rows = activeCourses.map(c => [
                c.curso || '',
                c.idLote || '',
                c.loteResponsavel || '',
                c.cargaHoraria || '',
                c.cidade || '',
                c.inicio || '',
                c.fim || '',
                c.alunos || 0,
                c.local || '',
                c.instrutor || '',
                c.status || '',
                c.driveLink || '',
                c.nota || ''
            ]);

            downloadCsv([headers, ...rows], 'cursos.csv');
            showToast(`${activeCourses.length} curso(s) exportado(s)!`, 'success');
        }
        
        // Exporta√ß√£o avan√ßada para Excel
        function exportCoursesToExcel() {
            const activeCourses = cursos;
            
            const data = activeCourses.map(c => ({
                'CURSO': c.curso || '',
                'ID': c.idLote || '',
                'LOTE-RESPONS√ÅVEL': c.loteResponsavel || '',
                'CARGA HOR√ÅRIA': c.cargaHoraria || '',
                'CIDADE/MUNIC√çPIO': c.cidade || '',
                'IN√çCIO': c.inicio || '',
                'FIM': c.fim || '',
                'CONCLUDENTES': c.alunos || 0,
                'LOCAL DO CURSO': c.local || '',
                'INSTRUTOR': c.instrutor || '',
                'STATUS': c.status || '',
                'GOOGLE DRIVE': c.driveLink || '',
                'OBSERVA√á√ÉO': c.nota || ''
            }));
            
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Cursos');
            
            // Ajustar largura das colunas
            const colWidths = [
                { wch: 30 }, // CURSO
                { wch: 10 }, // ID
                { wch: 20 }, // LOTE
                { wch: 12 }, // CARGA HOR√ÅRIA
                { wch: 20 }, // CIDADE
                { wch: 12 }, // IN√çCIO
                { wch: 12 }, // FIM
                { wch: 12 }, // CONCLUDENTES
                { wch: 30 }, // LOCAL
                { wch: 25 }, // INSTRUTOR
                { wch: 15 }, // STATUS
                { wch: 40 }, // GOOGLE DRIVE
                { wch: 40 }  // OBSERVA√á√ÉO
            ];
            worksheet['!cols'] = colWidths;
            
            XLSX.writeFile(workbook, `cursos_${new Date().toISOString().split('T')[0]}.xlsx`);
            showToast(`${activeCourses.length} curso(s) exportado(s) para Excel!`, 'success');
        }
        
        // Exporta√ß√£o para PDF
        async function exportCoursesToPDF() {
            const activeCourses = cursos;
            
            if (!window.html2canvas) {
                showToast('Biblioteca html2canvas n√£o carregada. Recarregue a p√°gina.', 'error');
                return;
            }
            
            showToast('Gerando PDF...', 'info');
            
            try {
                // Criar elemento tempor√°rio com os dados
                const tempDiv = document.createElement('div');
                tempDiv.style.cssText = 'position: absolute; left: -9999px; width: 210mm; padding: 20mm; background: white; color: black; font-family: Arial, sans-serif;';
                
                tempDiv.innerHTML = `
                    <h1 style="text-align: center; margin-bottom: 2rem;">Relat√≥rio de Cursos</h1>
                    <p style="margin-bottom: 1rem;"><strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>
                    <p style="margin-bottom: 2rem;"><strong>Total de Cursos:</strong> ${activeCourses.length}</p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                        <thead>
                            <tr style="background: #f0f0f0;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Curso</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">ID</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Cidade</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Status</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Concludentes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeCourses.map(c => `
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${c.curso || ''}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${c.idLote || ''}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${c.cidade || ''}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${c.status || ''}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${c.alunos || 0}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                document.body.appendChild(tempDiv);
                
                const canvas = await html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                document.body.removeChild(tempDiv);
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = window.jsPDF || null;
                
                if (!pdf) {
                    // Se jsPDF n√£o estiver dispon√≠vel, baixar como PNG
                    const link = document.createElement('a');
                    link.href = imgData;
                    link.download = `cursos_${new Date().toISOString().split('T')[0]}.png`;
                    link.click();
                    showToast('Imagem gerada! (Instale jsPDF para gerar PDF)', 'info');
                } else {
                    const pdfDoc = new pdf('p', 'mm', 'a4');
                    const imgWidth = 210;
                    const pageHeight = 297;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdfDoc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdfDoc.addPage();
                        pdfDoc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdfDoc.save(`cursos_${new Date().toISOString().split('T')[0]}.pdf`);
                    showToast('PDF gerado com sucesso!', 'success');
                }
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showToast('Erro ao gerar PDF: ' + (error.message || 'Erro desconhecido'), 'error');
            }
        }

        function exportInstructorsToCsv() {
            const headers = ['NOME', 'ESPECIALIDADE', 'TELEFONE', 'EMAIL'];
            const rows = instrutores.map(i => [
                i.nome || '',
                i.especialidade || '',
                i.telefone || '',
                i.email || ''
            ]);

            downloadCsv([headers, ...rows], 'instrutores.csv');
            showToast('Instrutores exportados!', 'success');
        }

        function downloadCsv(data, filename) {
            const csv = data.map(row => 
                row.map(cell => {
                    const escapedCell = String(cell).replace(/"/g, '""');
                    return `"${escapedCell}"`;
                }).join(',')
            ).join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        async function clearAllData() {
            if (!confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° excluir TODOS os cursos e instrutores. Deseja continuar?')) return;
            if (!confirm('Tem certeza absoluta? Esta a√ß√£o n√£o pode ser desfeita!')) return;

            try {
                if (firebaseAvailable) {
                    const coursesSnapshot = await db.collection('cursos').get();
                    const instructorsSnapshot = await db.collection('instrutores').get();

                    const batch = db.batch();
                    coursesSnapshot.docs.forEach(doc => batch.delete(doc.ref));
                    instructorsSnapshot.docs.forEach(doc => batch.delete(doc.ref));
                    await batch.commit();
                } else {
                    localStorage.setItem('cursos', JSON.stringify([]));
                    localStorage.setItem('instrutores', JSON.stringify([]));
                }

                showToast('Todos os dados foram exclu√≠dos!', 'success');
                logActivity('Limpeza de Dados', 'Excluiu todos os cursos e instrutores', 'delete');
                loadData();
            } catch (error) {
                console.error('Error clearing data:', error);
                showToast('Erro ao limpar dados', 'error');
            }
        }

        function openReportModal() {
            generateReport();
            document.getElementById('reportModal').classList.add('active');
        }

        function generateReport() {
            // Mostrar todos os cursos (sem filtro de per√≠odo)
            let coursesToReport = [...cursos];
            
            const total = coursesToReport.length;
            const concluidos = coursesToReport.filter(c => normalizeStatus(c.status) === 'Conclu√≠do').length;
            const andamento = coursesToReport.filter(c => normalizeStatus(c.status) === 'Em Andamento').length;
            const pendentes = coursesToReport.filter(c => normalizeStatus(c.status) === 'Pendente').length;
            const cancelados = coursesToReport.filter(c => normalizeStatus(c.status) === 'Cancelado').length;
            const totalAlunos = coursesToReport.reduce((sum, c) => sum + (parseInt(c.alunos) || 0), 0);

            const today = new Date();
            const reportDate = today.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Cursos por cidade
            const cursosporCidade = {};
            coursesToReport.forEach(c => {
                const cidade = c.cidade || 'N√£o definido';
                cursosporCidade[cidade] = (cursosporCidade[cidade] || 0) + 1;
            });

            document.getElementById('reportContent').innerHTML = `
                <div class="report-header">
                    <h2>
                        <span class="material-icons" style="color: var(--primary);">assessment</span>
                        CSF Manager - Relat√≥rio de Cursos
                    </h2>
                    <p>${reportDate}</p>
                </div>

                <div class="report-kpi-grid">
                    <div class="report-kpi-card purple">
                        <div class="report-kpi-value">${total}</div>
                        <div class="report-kpi-label">Total de Cursos</div>
                    </div>
                    <div class="report-kpi-card green">
                        <div class="report-kpi-value">${concluidos}</div>
                        <div class="report-kpi-label">Conclu√≠dos</div>
                    </div>
                    <div class="report-kpi-card blue">
                        <div class="report-kpi-value">${andamento}</div>
                        <div class="report-kpi-label">Em Andamento</div>
                    </div>
                    <div class="report-kpi-card yellow">
                        <div class="report-kpi-value">${pendentes}</div>
                        <div class="report-kpi-label">Pendentes</div>
                    </div>
                    <div class="report-kpi-card red">
                        <div class="report-kpi-value">${cancelados}</div>
                        <div class="report-kpi-label">Cancelados</div>
                    </div>
                    <div class="report-kpi-card">
                        <div class="report-kpi-value">${totalAlunos}</div>
                        <div class="report-kpi-label">Concludentes</div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>
                        <span class="material-icons">pie_chart</span>
                        Distribui√ß√£o por Status
                    </h3>
                    <div class="report-chart">
                        <canvas id="statusChart" width="280" height="280"></canvas>
                    </div>
                </div>

                <div class="report-section">
                    <h3>
                        <span class="material-icons">location_city</span>
                        Cursos por Cidade
                    </h3>
                    <div class="report-city-grid">
                        ${Object.entries(cursosporCidade).map(([cidade, qtd]) => `
                            <div class="report-city-item">
                                <span class="report-city-name">${cidade}</span>
                                <span class="report-city-count">${qtd}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="report-section">
                    <h3>
                        <span class="material-icons">list</span>
                        Lista de Cursos ${coursesToReport.length > 15 ? '(Primeiros 15)' : ''}
                    </h3>
                    <table class="report-table">
                        <tr>
                            <th>Curso</th>
                            <th>Cidade</th>
                            <th>Per√≠odo</th>
                            <th>Status</th>
                        </tr>
                        ${coursesToReport.slice(0, 15).map(c => `
                            <tr>
                                <td>${c.curso || 'N/A'}</td>
                                <td>${c.cidade || 'N/A'}</td>
                                <td>${formatDate(c.inicio)} - ${formatDate(c.fim)}</td>
                                <td>${c.status || 'Pendente'}</td>
                            </tr>
                        `).join('')}
                        ${cursos.length > 15 ? `<tr><td colspan="4" style="text-align: center; opacity: 0.7;">... e mais ${cursos.length - 15} cursos</td></tr>` : ''}
                    </table>
                </div>
            `;

            setTimeout(() => {
                const ctx = document.getElementById('statusChart')?.getContext('2d');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Conclu√≠dos', 'Em Andamento', 'Pendentes', 'Cancelados'],
                            datasets: [{
                                data: [concluidos, andamento, pendentes, cancelados],
                                backgroundColor: ['#34d399', '#60a5fa', '#fbbf24', '#f87171'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: false,
                            maintainAspectRatio: false,
                            cutout: '60%',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#ffffff',
                                        padding: 15,
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        }

        async function downloadReportAsImage() {
            // Tentar encontrar o relat√≥rio no dashboard primeiro
            let element = document.getElementById('dashboardReport');
            
            // Se n√£o encontrar ou estiver vazio, tentar no modal
            if (!element || !element.innerHTML.trim()) {
                element = document.getElementById('reportContent');
            }
            
            if (!element || !element.innerHTML.trim()) {
                showToast('Relat√≥rio n√£o encontrado. Gere o relat√≥rio primeiro.', 'warning');
                return;
            }
            
            try {
                setLoadingState(true);
                showToast('Gerando relat√≥rio...', 'info');
                
                // Aguardar um pouco para garantir que o conte√∫do est√° renderizado
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Verificar se html2canvas est√° dispon√≠vel
                if (typeof html2canvas === 'undefined') {
                    showToast('Biblioteca html2canvas n√£o carregada. Recarregue a p√°gina.', 'error');
                    setLoadingState(false);
                    return;
                }
                
                const isLightMode = document.documentElement.classList.contains('light-mode');
                const canvas = await html2canvas(element, {
                    backgroundColor: isLightMode ? '#f8fafc' : '#0f172a',
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    windowWidth: element.scrollWidth,
                    windowHeight: element.scrollHeight
                });
                
                const link = document.createElement('a');
                const date = new Date().toISOString().split('T')[0];
                link.download = `relatorio-cursos-${date}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('Relat√≥rio baixado com sucesso!', 'success');
            } catch (error) {
                console.error('Error generating image:', error);
                showToast('Erro ao gerar imagem: ' + (error.message || 'Erro desconhecido'), 'error');
            } finally {
                setLoadingState(false);
            }
        }

        // Utility Functions
        function formatDate(dateStr) {
            if (!dateStr) return 'N√£o informado';
            
            // Se j√° estiver no formato brasileiro, retornar como est√°
            if (typeof dateStr === 'string' && /^\d{2}\/\d{2}\/\d{4}$/.test(dateStr)) {
                return dateStr;
            }
            
            try {
                // Tentar formato ISO (YYYY-MM-DD)
                if (typeof dateStr === 'string' && dateStr.includes('-')) {
                    const parts = dateStr.split('-');
                    if (parts.length === 3) {
                        const [year, month, day] = parts;
                        // Validar se s√£o n√∫meros v√°lidos
                        const yearNum = parseInt(year);
                        const monthNum = parseInt(month);
                        const dayNum = parseInt(day);
                        
                        if (!isNaN(yearNum) && !isNaN(monthNum) && !isNaN(dayNum) &&
                            yearNum >= 1900 && yearNum <= 2100 &&
                            monthNum >= 1 && monthNum <= 12 &&
                            dayNum >= 1 && dayNum <= 31) {
                return `${day.padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;
                        }
                    }
                }
                
                // Tentar parse como Date
                const date = new Date(dateStr);
                if (!isNaN(date.getTime()) && date.getFullYear() >= 1900 && date.getFullYear() <= 2100) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${day}/${month}/${year}`;
                }
            } catch (e) {
                console.warn('Erro ao formatar data:', dateStr, e);
            }
            
            // Se n√£o conseguiu formatar, retornar "N√£o informado" em vez do valor original
            return 'N√£o informado';
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleString('pt-BR');
        }

        function normalizeStatus(status) {
            if (!status) return 'Pendente';
            // Normalizar: remover espa√ßos extras, converter para primeira letra mai√∫scula
            const normalized = status.toString().trim();
            
            // Mapear varia√ß√µes comuns
            const statusMap = {
                'concluido': 'Conclu√≠do',
                'conclu√≠do': 'Conclu√≠do',
                'concluida': 'Conclu√≠do',
                'conclu√≠da': 'Conclu√≠do',
                'concluidos': 'Conclu√≠do',
                'conclu√≠dos': 'Conclu√≠do',
                'concluido ': 'Conclu√≠do',
                'conclu√≠do ': 'Conclu√≠do',
                'em andamento': 'Em Andamento',
                'em andamento ': 'Em Andamento',
                'andamento': 'Em Andamento',
                'pendente': 'Pendente',
                'pendente ': 'Pendente',
                'cancelado': 'Cancelado',
                'cancelada': 'Cancelado',
                'cancelados': 'Cancelado',
                'canceladas': 'Cancelado',
                'cancelado ': 'Cancelado'
            };
            
            const lower = normalized.toLowerCase();
            if (statusMap[lower]) {
                return statusMap[lower];
            }
            
            // Se j√° est√° no formato correto, retornar como est√°
            if (['Conclu√≠do', 'Em Andamento', 'Pendente', 'Cancelado'].includes(normalized)) {
                return normalized;
            }
            
            // Tentar capitalizar primeira letra de cada palavra
            return normalized.split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
        }

        function getStatusClass(status) {
            const normalized = normalizeStatus(status);
            const classes = {
                'Conclu√≠do': 'concluido',
                'Em Andamento': 'andamento',
                'Pendente': 'pendente',
                'Cancelado': 'cancelado'
            };
            return classes[normalized] || 'pendente';
        }

        /**
         * Sistema de Notifica√ß√µes Avan√ßado
         * @param {string} message - Mensagem principal
         * @param {string} type - Tipo: 'success', 'error', 'warning', 'info'
         * @param {Object} options - Op√ß√µes adicionais
         * @param {string} options.title - T√≠tulo da notifica√ß√£o
         * @param {number} options.duration - Dura√ß√£o em ms (0 = persistente)
         * @param {boolean} options.showProgress - Mostrar barra de progresso
         * @param {boolean} options.playSound - Tocar som
         * @param {Array} options.actions - Bot√µes de a√ß√£o [{label, onClick, style}]
         * @param {Function} options.onClose - Callback ao fechar
         * @param {boolean} options.dismissible - Pode ser fechado (default: true)
         */
        function showToast(message, type = 'success', options = {}) {
            const container = document.getElementById('toastContainer');
            if (!container) return null;
            
            const {
                title = '',
                duration = 5000,
                showProgress = true,
                playSound = false,
                actions = [],
                onClose = null,
                dismissible = true
            } = options;
            
            // Limitar n√∫mero de toasts vis√≠veis (m√°ximo 5)
            const existingToasts = container.querySelectorAll('.toast');
            if (existingToasts.length >= 5) {
                existingToasts[0].remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };
            
            const titles = {
                success: 'Sucesso',
                error: 'Erro',
                warning: 'Aten√ß√£o',
                info: 'Informa√ß√£o'
            };
            
            const toastId = 'toast-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
            toast.id = toastId;
            
            // Construir HTML do toast
            let actionsHTML = '';
            if (actions.length > 0) {
                actionsHTML = `<div class="toast-actions" style="display: flex; gap: 8px; margin-top: 10px;">
                    ${actions.map((action, i) => `
                        <button class="toast-action-btn" data-action-index="${i}" style="
                            padding: 6px 12px;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 0.8rem;
                            font-weight: 500;
                            background: ${action.style === 'primary' ? 'var(--primary)' : 'var(--surface-hover)'};
                            color: ${action.style === 'primary' ? 'white' : 'var(--text-primary)'};
                            transition: all 0.2s;
                        ">${action.label}</button>
                    `).join('')}
                </div>`;
            }
            
            const displayTitle = title || titles[type] || '';
            
            toast.innerHTML = `
                <span class="material-icons">${icons[type] || icons.success}</span>
                <div class="toast-content" style="flex: 1; min-width: 0;">
                    ${displayTitle ? `<div class="toast-title" style="font-weight: 600; margin-bottom: 4px; color: var(--text-primary);">${displayTitle}</div>` : ''}
                    <div class="toast-message" style="word-wrap: break-word; line-height: 1.4;">${message}</div>
                    ${actionsHTML}
                </div>
                ${dismissible ? `
                    <button class="toast-close" title="Fechar">
                        <span class="material-icons" style="font-size: 18px;">close</span>
                    </button>
                ` : ''}
                ${showProgress && duration > 0 ? `
                    <div class="toast-progress" style="
                        position: absolute;
                        bottom: 0;
                        left: 0;
                        height: 3px;
                        background: currentColor;
                        opacity: 0.5;
                        width: 100%;
                        transform-origin: left;
                        animation: toastProgress ${duration}ms linear forwards;
                    "></div>
                ` : ''}
            `;
            
            container.appendChild(toast);
            
            // Adicionar keyframe para barra de progresso (se n√£o existir)
            if (!document.getElementById('toast-progress-style')) {
                const style = document.createElement('style');
                style.id = 'toast-progress-style';
                style.textContent = `
                    @keyframes toastProgress {
                        from { transform: scaleX(1); }
                        to { transform: scaleX(0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Som de notifica√ß√£o
            if (playSound) {
                try {
                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    oscillator.frequency.value = type === 'error' ? 300 : type === 'warning' ? 400 : 600;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                } catch (e) { /* Ignorar erros de √°udio */ }
            }
            
            // Animar entrada
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            });
            
            // Fun√ß√£o para fechar o toast
            const closeToast = () => {
                if (toast.parentNode) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(120%)';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                            if (onClose) onClose();
                        }
                    }, 400);
                }
            };
            
            // Configurar timeout (se duration > 0)
            let timeoutId = null;
            if (duration > 0) {
                timeoutId = setTimeout(closeToast, duration);
            }
            
            // Pausar ao passar o mouse
            toast.addEventListener('mouseenter', () => {
                if (timeoutId) clearTimeout(timeoutId);
                const progress = toast.querySelector('.toast-progress');
                if (progress) progress.style.animationPlayState = 'paused';
            });
            
            toast.addEventListener('mouseleave', () => {
                if (duration > 0) {
                    timeoutId = setTimeout(closeToast, 2000);
                    const progress = toast.querySelector('.toast-progress');
                    if (progress) {
                        progress.style.animation = `toastProgress 2000ms linear forwards`;
                        progress.style.animationPlayState = 'running';
                    }
                }
            });
            
            // Bot√£o fechar
            if (dismissible) {
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    if (timeoutId) clearTimeout(timeoutId);
                    closeToast();
                });
            }
            
            // Event listeners para bot√µes de a√ß√£o
            actions.forEach((action, index) => {
                const btn = toast.querySelector(`[data-action-index="${index}"]`);
                if (btn && action.onClick) {
                    btn.addEventListener('click', () => {
                        action.onClick();
                        if (action.closeOnClick !== false) {
                            if (timeoutId) clearTimeout(timeoutId);
                            closeToast();
                        }
                    });
                }
            });
            
            // Retornar objeto com m√©todos de controle
            return {
                id: toastId,
                close: closeToast,
                element: toast
            };
        }
        
        // Atalhos √∫teis para notifica√ß√µes
        const notify = {
            success: (msg, opts) => showToast(msg, 'success', opts),
            error: (msg, opts) => showToast(msg, 'error', opts),
            warning: (msg, opts) => showToast(msg, 'warning', opts),
            info: (msg, opts) => showToast(msg, 'info', opts),
            
            // Notifica√ß√£o de confirma√ß√£o com a√ß√µes
            confirm: (message, onConfirm, onCancel) => showToast(message, 'warning', {
                title: 'Confirma√ß√£o',
                duration: 0,
                dismissible: false,
                actions: [
                    { label: 'Confirmar', onClick: onConfirm, style: 'primary' },
                    { label: 'Cancelar', onClick: onCancel || (() => {}) }
                ]
            }),
            
            // Notifica√ß√£o de loading (persistente)
            loading: (message) => showToast(message, 'info', {
                title: 'Processando...',
                duration: 0,
                showProgress: false,
                dismissible: false
            })
        };
        
        // ========== SISTEMA DE HIST√ìRICO DE NOTIFICA√á√ïES ==========
        let notificationHistory = [];
        const MAX_NOTIFICATIONS = 50;
        
        // Salvar notifica√ß√£o no hist√≥rico
        function saveNotificationToHistory(message, type, title = '', courseId = null) {
            const notification = {
                id: 'notif-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5),
                message,
                type,
                title: title || { success: 'Sucesso', error: 'Erro', warning: 'Aten√ß√£o', info: 'Informa√ß√£o' }[type] || 'Notifica√ß√£o',
                timestamp: new Date(),
                read: false,
                courseId: courseId
            };
            
            notificationHistory.unshift(notification);
            
            // Limitar hist√≥rico
            if (notificationHistory.length > MAX_NOTIFICATIONS) {
                notificationHistory = notificationHistory.slice(0, MAX_NOTIFICATIONS);
            }
            
            // Salvar no localStorage
            localStorage.setItem('notificationHistory', JSON.stringify(notificationHistory));
            
            updateNotificationBadge();
            return notification;
        }
        
        // Carregar hist√≥rico do localStorage
        function loadNotificationHistory() {
            try {
                const saved = localStorage.getItem('notificationHistory');
                if (saved) {
                    notificationHistory = JSON.parse(saved);
                    // Converter timestamps de string para Date
                    notificationHistory = notificationHistory.map(n => ({
                        ...n,
                        timestamp: new Date(n.timestamp)
                    }));
                }
            } catch (e) {
                notificationHistory = [];
            }
            updateNotificationBadge();
        }
        
        // Atualizar badge de notifica√ß√µes
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (!badge) return;
            
            const unreadCount = notificationHistory.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Excluir notifica√ß√£o
        function deleteNotification(id) {
            notificationHistory = notificationHistory.filter(n => n.id !== id);
            localStorage.setItem('notificationHistory', JSON.stringify(notificationHistory));
            updateNotificationBadge();
            renderNotificationsPanel();
        }
        
        // A√ß√£o r√°pida: excluir notifica√ß√£o (bot√£o X)
        function quickDeleteNotification(notifId) {
            deleteNotification(notifId);
            showToast('Notifica√ß√£o removida', 'info', { duration: 2000 });
        }
        
        // A√ß√£o r√°pida: marcar curso como conclu√≠do
        async function quickMarkAsCompleted(notifId, courseId) {
            try {
                const curso = cursos.find(c => c.id === courseId);
                if (!curso) {
                    showToast('Curso n√£o encontrado', 'error');
                    return;
                }
                
                // Atualizar status para Conclu√≠do
                if (firebaseAvailable) {
                    await db.collection('cursos').doc(courseId).update({ status: 'Conclu√≠do' });
                } else {
                    const existingCourses = JSON.parse(localStorage.getItem('cursos') || '[]');
                    const index = existingCourses.findIndex(c => c.id === courseId);
                    if (index !== -1) {
                        existingCourses[index].status = 'Conclu√≠do';
                        localStorage.setItem('cursos', JSON.stringify(existingCourses));
                        loadFromLocalStorage();
                    }
                }
                
                // Excluir notifica√ß√£o
                deleteNotification(notifId);
                
                showToast(`Curso "${curso.curso || curso.lote}" marcado como conclu√≠do!`, 'success');
                logActivity('Curso Conclu√≠do', `Marcou "${curso.curso || curso.lote}" como conclu√≠do via notifica√ß√£o`, 'complete');
                
                // Atualizar visualiza√ß√£o
                renderCoursesByLote();
                renderDashboardReport();
                
            } catch (error) {
                console.error('Erro ao marcar curso como conclu√≠do:', error);
                showToast('Erro ao atualizar curso', 'error');
            }
        }
        
        // Clique na notifica√ß√£o - exclui e abre curso se houver
        function handleNotificationClick(notifId, courseId) {
            // Excluir a notifica√ß√£o
            deleteNotification(notifId);
            
            if (courseId) {
                // Fechar painel de notifica√ß√µes
                document.getElementById('notificationsPanel')?.classList.remove('active');
                
                // Navegar para p√°gina de cursos
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                document.querySelector('[data-page="courses"]')?.classList.add('active');
                document.querySelectorAll('.page-section').forEach(page => page.classList.remove('active'));
                document.getElementById('coursesPage')?.classList.add('active');
                
                // Aguardar renderiza√ß√£o e abrir modal do curso
                setTimeout(() => {
                    openCourseModal(courseId);
                }, 300);
            }
        }
        
        // Marcar todas como lidas
        function markAllNotificationsAsRead() {
            notificationHistory.forEach(n => n.read = true);
            localStorage.setItem('notificationHistory', JSON.stringify(notificationHistory));
            updateNotificationBadge();
            renderNotificationsPanel();
        }
        
        // Limpar hist√≥rico
        function clearNotificationHistory() {
            notificationHistory = [];
            localStorage.setItem('notificationHistory', JSON.stringify(notificationHistory));
            updateNotificationBadge();
            renderNotificationsPanel();
        }
        
        // Renderizar painel de notifica√ß√µes
        function renderNotificationsPanel() {
            const list = document.getElementById('notificationsList');
            if (!list) return;
            
            if (notificationHistory.length === 0) {
                list.innerHTML = `
                    <div class="empty-notifications" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                        <span class="material-icons" style="font-size: 48px; margin-bottom: 1rem; opacity: 0.5;">notifications_off</span>
                        <p>Nenhuma notifica√ß√£o</p>
                    </div>
                `;
                return;
            }
            
            const icons = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };
            
            list.innerHTML = notificationHistory.map(n => {
                const timeAgo = getTimeAgo(n.timestamp);
                const hasCourse = n.courseId ? 'has-course' : '';
                const courseAttr = n.courseId ? `data-course-id="${n.courseId}"` : '';
                
                // A√ß√µes r√°pidas baseadas no tipo de notifica√ß√£o
                let quickActions = '';
                if (n.courseId) {
                    quickActions = `
                        <div class="notification-actions" onclick="event.stopPropagation()">
                            <button class="notif-action-btn primary" onclick="handleNotificationClick('${n.id}', '${n.courseId}')" title="Abrir curso">
                                <span class="material-icons">edit</span> Editar
                            </button>
                            <button class="notif-action-btn success" onclick="quickMarkAsCompleted('${n.id}', '${n.courseId}')" title="Marcar como conclu√≠do">
                                <span class="material-icons">check_circle</span> Concluir
                            </button>
                            <button class="notif-action-btn danger" onclick="quickDeleteNotification('${n.id}')" title="Ignorar">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                    `;
                }
                
                return `
                    <div class="notification-item ${n.type} ${n.read ? '' : 'unread'} ${hasCourse}" data-id="${n.id}" ${courseAttr}>
                        <div class="notification-icon">
                            <span class="material-icons">${icons[n.type] || 'notifications'}</span>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${n.title}</div>
                            <div class="notification-message">${n.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                            ${quickActions}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Formatar tempo relativo
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Agora mesmo';
            if (minutes < 60) return `${minutes} min atr√°s`;
            if (hours < 24) return `${hours}h atr√°s`;
            if (days < 7) return `${days} dias atr√°s`;
            return date.toLocaleDateString('pt-BR');
        }
        
        // Toggle painel de notifica√ß√µes
        function toggleNotificationsPanel() {
            const panel = document.getElementById('notificationsPanel');
            if (panel) {
                panel.classList.toggle('active');
                if (panel.classList.contains('active')) {
                    renderNotificationsPanel();
                }
            }
        }
        
        // Inicializar sistema de notifica√ß√µes
        function initNotificationSystem() {
            loadNotificationHistory();
            
            // Bot√£o de notifica√ß√µes na sidebar
            const bellBtn = document.getElementById('notificationBellBtn');
            if (bellBtn) {
                bellBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleNotificationsPanel();
                });
            }
            
            // Fechar painel de notifica√ß√µes
            const closeBtn = document.getElementById('closeNotificationsBtn');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    document.getElementById('notificationsPanel')?.classList.remove('active');
                });
            }
            
            // Fechar ao clicar fora
            document.addEventListener('click', (e) => {
                const panel = document.getElementById('notificationsPanel');
                const bellBtn = document.getElementById('notificationBellBtn');
                if (panel?.classList.contains('active') && !panel.contains(e.target) && !bellBtn?.contains(e.target)) {
                    panel.classList.remove('active');
                }
            });
            
            // Bot√£o marcar todas como lidas
            const markAllBtn = document.getElementById('markAllReadBtn');
            if (markAllBtn) {
                markAllBtn.addEventListener('click', markAllNotificationsAsRead);
            }
            
            // Bot√£o limpar hist√≥rico
            const clearBtn = document.getElementById('clearNotificationsBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', clearNotificationHistory);
            }
            
            // Verificar alertas autom√°ticos ao iniciar (com delay para carregar dados)
            setTimeout(checkAutomaticAlerts, 3000);
            
            // Verificar alertas a cada 30 minutos
            setInterval(checkAutomaticAlerts, 30 * 60 * 1000);
        }
        
        // ========== ALERTAS AUTOM√ÅTICOS ==========
        let lastAlertCheck = null;
        
        function checkAutomaticAlerts(forceCheck = false) {
            if (!cursos || cursos.length === 0) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Evitar notifica√ß√µes duplicadas no mesmo dia (exceto se for√ßado)
            const todayStr = today.toDateString();
            const lastCheck = localStorage.getItem('lastAlertCheck');
            if (lastCheck === todayStr && !forceCheck) return;
            
            localStorage.setItem('lastAlertCheck', todayStr);
            
            let alertas = {
                iniciandoHoje: [],
                iniciando3Dias: [],
                iniciando7Dias: [],
                vencendoHoje: [],
                vencendo3Dias: [],
                vencendo7Dias: [],
                atrasados: [],
                dadosIncompletos: [],
                emAndamentoSemFim: []
            };
            
            cursos.forEach(curso => {
                const status = normalizeStatus(curso.status);
                
                // Ignorar cursos j√° conclu√≠dos ou cancelados
                if (status === 'Conclu√≠do' || status === 'Cancelado') return;
                
                const inicioDate = curso.inicio ? new Date(curso.inicio) : null;
                const fimDate = curso.fim ? new Date(curso.fim) : null;
                
                // Verificar datas de in√≠cio (apenas para cursos Pendentes)
                if (inicioDate && status === 'Pendente') {
                    inicioDate.setHours(0, 0, 0, 0);
                    const diffDaysInicio = Math.ceil((inicioDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (diffDaysInicio === 0) {
                        alertas.iniciandoHoje.push(curso);
                    } else if (diffDaysInicio > 0 && diffDaysInicio <= 3) {
                        alertas.iniciando3Dias.push(curso);
                    } else if (diffDaysInicio > 3 && diffDaysInicio <= 7) {
                        alertas.iniciando7Dias.push(curso);
                    }
                }
                
                // Verificar datas de fim
                if (fimDate) {
                    fimDate.setHours(0, 0, 0, 0);
                    const diffDays = Math.ceil((fimDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        alertas.atrasados.push(curso);
                    } else if (diffDays === 0) {
                        alertas.vencendoHoje.push(curso);
                    } else if (diffDays <= 3) {
                        alertas.vencendo3Dias.push(curso);
                    } else if (diffDays <= 7) {
                        alertas.vencendo7Dias.push(curso);
                    }
                }
                
                // Verificar dados incompletos em cursos Em Andamento ou Conclu√≠dos
                if (status === 'Em Andamento' || status === 'Conclu√≠do') {
                    const camposFaltando = [];
                    
                    if (!curso.instrutor || curso.instrutor.trim() === '' || curso.instrutor === 'Sem instrutor') {
                        camposFaltando.push('Instrutor');
                    }
                    if (!curso.local || curso.local.trim() === '') {
                        camposFaltando.push('Endere√ßo');
                    }
                    if (!curso.cargaHoraria || curso.cargaHoraria.trim() === '') {
                        camposFaltando.push('Carga Hor√°ria');
                    }
                    
                    if (camposFaltando.length > 0) {
                        alertas.dadosIncompletos.push({
                            ...curso,
                            camposFaltando
                        });
                    }
                }
                
                // Cursos em andamento sem data de fim
                if (status === 'Em Andamento' && !curso.fim) {
                    alertas.emAndamentoSemFim.push(curso);
                }
            });
            
            // Fun√ß√£o auxiliar para formatar data
            const formatDate = (date) => {
                if (!date) return '';
                const d = new Date(date);
                return d.toLocaleDateString('pt-BR');
            };
            
            // Gerar notifica√ß√µes individuais com link para o curso
            
            // Cursos iniciando
            alertas.iniciandoHoje.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" inicia HOJE (${formatDate(curso.inicio)})`,
                    'info',
                    'üü¢ Inicia Hoje',
                    curso.id
                );
            });
            
            alertas.iniciando3Dias.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" inicia em ${formatDate(curso.inicio)}`,
                    'info',
                    'üìÖ In√≠cio Pr√≥ximo',
                    curso.id
                );
            });
            
            alertas.iniciando7Dias.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" inicia em ${formatDate(curso.inicio)}`,
                    'info',
                    'üìÖ In√≠cio em Breve',
                    curso.id
                );
            });
            
            // Cursos terminando
            alertas.atrasados.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" est√° com prazo vencido! (${formatDate(curso.fim)})`,
                    'error',
                    '‚ö†Ô∏è Curso Atrasado',
                    curso.id
                );
            });
            
            alertas.vencendoHoje.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" termina HOJE (${formatDate(curso.fim)})`,
                    'warning',
                    'üî¥ Termina Hoje',
                    curso.id
                );
            });
            
            alertas.vencendo3Dias.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" termina em ${formatDate(curso.fim)}`,
                    'warning',
                    'üü† T√©rmino Pr√≥ximo',
                    curso.id
                );
            });
            
            alertas.vencendo7Dias.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" termina em ${formatDate(curso.fim)}`,
                    'info',
                    'üìÖ T√©rmino em Breve',
                    curso.id
                );
            });
            
            // Dados incompletos
            alertas.dadosIncompletos.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" est√° faltando: ${curso.camposFaltando.join(', ')}`,
                    'warning',
                    'üìã Dados Incompletos',
                    curso.id
                );
            });
            
            alertas.emAndamentoSemFim.forEach(curso => {
                saveNotificationToHistory(
                    `Curso "${curso.curso || curso.lote}" em andamento sem data de t√©rmino`,
                    'warning',
                    'üìÖ Sem Data de T√©rmino',
                    curso.id
                );
            });
            
            // Verificar eventos do calend√°rio
            checkCalendarEventAlerts(today);
            
            // Verificar tarefas
            checkTaskAlerts(today);
            
            // Toast resumido
            const totalAlertas = alertas.atrasados.length + alertas.vencendoHoje.length + 
                                 alertas.vencendo3Dias.length + alertas.dadosIncompletos.length +
                                 alertas.iniciandoHoje.length + alertas.iniciando3Dias.length;
            
            if (totalAlertas > 0) {
                showToast(
                    `${totalAlertas} alerta(s) encontrado(s). Clique no sino para ver detalhes.`,
                    alertas.atrasados.length > 0 ? 'error' : 'warning',
                    { title: 'üîî Novos Alertas', duration: 8000, playSound: alertas.atrasados.length > 0 }
                );
            }
            
            console.log('Verifica√ß√£o de alertas autom√°ticos conclu√≠da:', alertas);
        }
        
        // Fun√ß√£o para for√ßar verifica√ß√£o manual
        function forceCheckAlerts() {
            localStorage.removeItem('lastAlertCheck');
            checkAutomaticAlerts(true);
        }
        
        // Adicionar bot√£o de atualizar notifica√ß√µes no painel
        function refreshNotifications() {
            forceCheckAlerts();
            showToast('Notifica√ß√µes atualizadas!', 'info', { duration: 2000 });
        }
        
        // Verificar alertas de eventos do calend√°rio
        function checkCalendarEventAlerts(today) {
            if (!calendarEvents || calendarEvents.length === 0) return;
            
            const todayStr = today.toISOString().split('T')[0];
            
            calendarEvents.forEach(evento => {
                const eventDate = new Date(evento.date + 'T00:00:00');
                eventDate.setHours(0, 0, 0, 0);
                
                const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    // Evento √© hoje
                    saveNotificationToHistory(
                        `Evento "${evento.title}" √© HOJE!${evento.description ? ' - ' + evento.description : ''}`,
                        'warning',
                        'üìå Evento Hoje',
                        null
                    );
                } else if (diffDays === 1) {
                    // Evento √© amanh√£
                    saveNotificationToHistory(
                        `Evento "${evento.title}" √© amanh√£ (${formatDateBR(evento.date)})`,
                        'info',
                        'üìÖ Evento Amanh√£',
                        null
                    );
                } else if (diffDays > 1 && diffDays <= 3) {
                    // Evento nos pr√≥ximos 3 dias
                    saveNotificationToHistory(
                        `Evento "${evento.title}" em ${formatDateBR(evento.date)}`,
                        'info',
                        'üìÖ Evento Pr√≥ximo',
                        null
                    );
                }
            });
        }
        
        // ==================== SISTEMA DE TAREFAS ====================
        let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        let currentTaskFilter = 'all';
        let editingTaskId = null;
        
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateTaskBadge();
            updateTaskStats();
        }
        
        function generateTaskId() {
            return 'task-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }
        
        // Criar nova tarefa
        function createTask(taskData) {
            const task = {
                id: generateTaskId(),
                title: taskData.title,
                description: taskData.description || '',
                dueDate: taskData.dueDate,
                dueTime: taskData.dueTime || '',
                priority: taskData.priority || 'medium',
                category: taskData.category || 'geral',
                subtasks: taskData.subtasks || [],
                completed: false,
                completedAt: null,
                createdAt: new Date().toISOString(),
                reminders: taskData.reminders || []
            };
            
            tasks.push(task);
            saveTasks();
            renderTasks();
            return task;
        }
        
        // Atualizar tarefa
        function updateTask(taskId, updates) {
            const index = tasks.findIndex(t => t.id === taskId);
            if (index !== -1) {
                tasks[index] = { ...tasks[index], ...updates };
                saveTasks();
                renderTasks();
            }
        }
        
        // Excluir tarefa
        function deleteTask(taskId) {
            if (!confirm('Deseja excluir esta tarefa?')) return;
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            showToast('Tarefa exclu√≠da', 'info');
        }
        
        // Marcar tarefa como conclu√≠da
        function toggleTaskComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.completed = !task.completed;
            task.completedAt = task.completed ? new Date().toISOString() : null;
            
            if (task.completed) {
                // Anima√ß√£o de confete/celebra√ß√£o
                showTaskCompletedAnimation(task);
                showToast(`‚úì Tarefa "${task.title}" conclu√≠da!`, 'success');
                logActivity('Tarefa Conclu√≠da', `Concluiu a tarefa "${task.title}"`, 'complete');
            }
            
            saveTasks();
            renderTasks();
        }
        
        // Toggle subtarefa
        function toggleSubtask(taskId, subtaskIndex) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.subtasks[subtaskIndex]) return;
            
            task.subtasks[subtaskIndex].completed = !task.subtasks[subtaskIndex].completed;
            
            // Verificar se todas subtarefas est√£o conclu√≠das
            const allCompleted = task.subtasks.every(st => st.completed);
            if (allCompleted && task.subtasks.length > 0 && !task.completed) {
                if (confirm('Todas as subtarefas foram conclu√≠das! Marcar a tarefa principal como conclu√≠da?')) {
                    task.completed = true;
                    task.completedAt = new Date().toISOString();
                    showTaskCompletedAnimation(task);
                    showToast(`‚úì Tarefa "${task.title}" conclu√≠da!`, 'success');
                }
            }
            
            saveTasks();
            renderTasks();
        }
        
        // Anima√ß√£o de tarefa conclu√≠da
        function showTaskCompletedAnimation(task) {
            const overlay = document.createElement('div');
            overlay.className = 'task-completed-overlay';
            overlay.innerHTML = `
                <div class="task-completed-content">
                    <div class="task-completed-icon">
                        <span class="material-icons">celebration</span>
                    </div>
                    <h3>Tarefa Conclu√≠da!</h3>
                    <p>${task.title}</p>
                </div>
            `;
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                overlay.classList.remove('show');
                setTimeout(() => overlay.remove(), 300);
            }, 1500);
        }
        
        // Atualizar badge de tarefas pendentes
        function updateTaskBadge() {
            const badge = document.getElementById('taskPendingBadge');
            if (!badge) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const pendingToday = tasks.filter(t => {
                if (t.completed) return false;
                const dueDate = new Date(t.dueDate + 'T00:00:00');
                return dueDate <= today;
            }).length;
            
            if (pendingToday > 0) {
                badge.textContent = pendingToday > 99 ? '99+' : pendingToday;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Atualizar estat√≠sticas
        function updateTaskStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = today.toISOString().split('T')[0];
            
            const weekEnd = new Date(today);
            weekEnd.setDate(weekEnd.getDate() + 7);
            
            const stats = {
                pending: tasks.filter(t => !t.completed).length,
                today: tasks.filter(t => !t.completed && t.dueDate === todayStr).length,
                overdue: tasks.filter(t => !t.completed && t.dueDate < todayStr).length,
                completed: tasks.filter(t => t.completed).length
            };
            
            document.getElementById('tasksPendingCount')?.textContent && (document.getElementById('tasksPendingCount').textContent = stats.pending);
            document.getElementById('tasksTodayCount')?.textContent && (document.getElementById('tasksTodayCount').textContent = stats.today);
            document.getElementById('tasksOverdueCount')?.textContent && (document.getElementById('tasksOverdueCount').textContent = stats.overdue);
            document.getElementById('tasksCompletedCount')?.textContent && (document.getElementById('tasksCompletedCount').textContent = stats.completed);
        }
        
        // Renderizar tarefas
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            if (!container) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = today.toISOString().split('T')[0];
            
            const weekEnd = new Date(today);
            weekEnd.setDate(weekEnd.getDate() + 7);
            const weekEndStr = weekEnd.toISOString().split('T')[0];
            
            // Filtrar tarefas
            let filteredTasks = [...tasks];
            
            switch (currentTaskFilter) {
                case 'today':
                    filteredTasks = tasks.filter(t => t.dueDate === todayStr && !t.completed);
                    break;
                case 'week':
                    filteredTasks = tasks.filter(t => t.dueDate >= todayStr && t.dueDate <= weekEndStr && !t.completed);
                    break;
                case 'overdue':
                    filteredTasks = tasks.filter(t => t.dueDate < todayStr && !t.completed);
                    break;
                case 'completed':
                    filteredTasks = tasks.filter(t => t.completed);
                    break;
                default:
                    filteredTasks = tasks.filter(t => !t.completed);
            }
            
            // Ordenar por data e prioridade
            filteredTasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                if (a.dueDate !== b.dueDate) return a.dueDate.localeCompare(b.dueDate);
                const priorityOrder = { high: 0, medium: 1, low: 2 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="tasks-empty">
                        <span class="material-icons">task_alt</span>
                        <h3>${currentTaskFilter === 'completed' ? 'Nenhuma tarefa conclu√≠da' : 'Nenhuma tarefa encontrada'}</h3>
                        <p>${currentTaskFilter === 'all' ? 'Clique em "Nova Tarefa" para come√ßar' : 'Tente outro filtro'}</p>
                    </div>
                `;
                updateTaskStats();
                return;
            }
            
            container.innerHTML = filteredTasks.map(task => {
                const isOverdue = !task.completed && task.dueDate < todayStr;
                const isToday = task.dueDate === todayStr;
                const priorityLabels = { high: 'Alta', medium: 'M√©dia', low: 'Baixa' };
                
                let statusClass = '';
                if (task.completed) statusClass = 'completed';
                else if (isOverdue) statusClass = 'overdue';
                else if (isToday) statusClass = 'today';
                
                const subtasksHtml = task.subtasks && task.subtasks.length > 0 ? `
                    <div class="subtasks">
                        ${task.subtasks.map((st, i) => `
                            <div class="subtask-item ${st.completed ? 'completed' : ''}">
                                <div class="subtask-checkbox ${st.completed ? 'checked' : ''}" onclick="toggleSubtask('${task.id}', ${i})">
                                    ${st.completed ? '<span class="material-icons">check</span>' : ''}
                                </div>
                                <span>${st.title}</span>
                            </div>
                        `).join('')}
                    </div>
                ` : '';
                
                const completedSubtasks = task.subtasks ? task.subtasks.filter(st => st.completed).length : 0;
                const totalSubtasks = task.subtasks ? task.subtasks.length : 0;
                
                return `
                    <div class="task-item ${statusClass}" data-task-id="${task.id}">
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTaskComplete('${task.id}')">
                            ${task.completed ? '<span class="material-icons">check</span>' : ''}
                        </div>
                        <div class="task-content">
                            <div class="task-header">
                                <span class="task-title">${task.title}</span>
                                <span class="task-priority ${task.priority}">${priorityLabels[task.priority]}</span>
                            </div>
                            ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                            <div class="task-meta">
                                <div class="task-meta-item ${isOverdue ? 'overdue' : ''}">
                                    <span class="material-icons">${isOverdue ? 'warning' : 'event'}</span>
                                    ${formatDateBR(task.dueDate)}${task.dueTime ? ' √†s ' + task.dueTime : ''}
                                </div>
                                ${totalSubtasks > 0 ? `
                                    <div class="task-meta-item">
                                        <span class="material-icons">checklist</span>
                                        ${completedSubtasks}/${totalSubtasks}
                                    </div>
                                ` : ''}
                                ${task.category !== 'geral' ? `
                                    <div class="task-meta-item">
                                        <span class="material-icons">label</span>
                                        ${task.category}
                                    </div>
                                ` : ''}
                            </div>
                            ${subtasksHtml}
                        </div>
                        <div class="task-actions">
                            <button class="task-action-btn" onclick="openTaskModal('${task.id}')" title="Editar">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="task-action-btn delete" onclick="deleteTask('${task.id}')" title="Excluir">
                                <span class="material-icons">delete</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateTaskStats();
        }
        
        // Modal de tarefa
        function openTaskModal(taskId = null) {
            editingTaskId = taskId;
            
            let modal = document.getElementById('taskModal');
            if (!modal) {
                createTaskModal();
                modal = document.getElementById('taskModal');
            }
            
            const form = document.getElementById('taskForm');
            form.reset();
            document.getElementById('subtasksList').innerHTML = '';
            
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    document.getElementById('taskModalTitle').textContent = 'Editar Tarefa';
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description || '';
                    document.getElementById('taskDueDate').value = task.dueDate;
                    document.getElementById('taskDueTime').value = task.dueTime || '';
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskCategory').value = task.category || 'geral';
                    
                    // Carregar subtarefas
                    if (task.subtasks) {
                        task.subtasks.forEach(st => addSubtaskToList(st.title));
                    }
                }
            } else {
                document.getElementById('taskModalTitle').textContent = 'Nova Tarefa';
                document.getElementById('taskDueDate').value = new Date().toISOString().split('T')[0];
            }
            
            modal.classList.add('active');
        }
        
        function createTaskModal() {
            const modalHtml = `
                <div class="modal-overlay" id="taskModal">
                    <div class="modal" style="max-width: 550px;">
                        <div class="modal-header">
                            <h3 id="taskModalTitle">Nova Tarefa</h3>
                            <button class="modal-close" onclick="closeModal('taskModal')">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="taskForm" onsubmit="handleTaskSubmit(event)">
                                <div class="form-group">
                                    <label class="form-label">T√≠tulo *</label>
                                    <input type="text" id="taskTitle" class="form-input" required placeholder="Ex: Revisar documenta√ß√£o do curso">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Descri√ß√£o</label>
                                    <textarea id="taskDescription" class="form-input" rows="3" placeholder="Detalhes da tarefa..."></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Data *</label>
                                        <input type="date" id="taskDueDate" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Hor√°rio</label>
                                        <input type="time" id="taskDueTime" class="form-input">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Prioridade</label>
                                        <select id="taskPriority" class="form-select">
                                            <option value="low">Baixa</option>
                                            <option value="medium" selected>M√©dia</option>
                                            <option value="high">Alta</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Categoria</label>
                                        <select id="taskCategory" class="form-select">
                                            <option value="geral">Geral</option>
                                            <option value="curso">Curso</option>
                                            <option value="reuniao">Reuni√£o</option>
                                            <option value="documento">Documento</option>
                                            <option value="prazo">Prazo</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Subtarefas</label>
                                    <div class="subtask-input-group">
                                        <input type="text" id="subtaskInput" class="form-input" placeholder="Adicionar subtarefa...">
                                        <button type="button" class="btn btn-secondary" onclick="addSubtaskFromInput()">
                                            <span class="material-icons">add</span>
                                        </button>
                                    </div>
                                    <div class="subtask-list" id="subtasksList"></div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons">save</span>
                                        Salvar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Enter para adicionar subtarefa
            document.getElementById('subtaskInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addSubtaskFromInput();
                }
            });
        }
        
        function addSubtaskFromInput() {
            const input = document.getElementById('subtaskInput');
            const value = input.value.trim();
            if (value) {
                addSubtaskToList(value);
                input.value = '';
                input.focus();
            }
        }
        
        function addSubtaskToList(title) {
            const list = document.getElementById('subtasksList');
            const item = document.createElement('div');
            item.className = 'subtask-list-item';
            item.innerHTML = `
                <span class="material-icons" style="color: var(--text-muted); font-size: 18px;">subdirectory_arrow_right</span>
                <span>${title}</span>
                <button type="button" class="subtask-remove-btn" onclick="this.parentElement.remove()">
                    <span class="material-icons" style="font-size: 18px;">close</span>
                </button>
            `;
            list.appendChild(item);
        }
        
        function handleTaskSubmit(e) {
            e.preventDefault();
            
            const subtaskElements = document.querySelectorAll('#subtasksList .subtask-list-item span:nth-child(2)');
            const subtasks = Array.from(subtaskElements).map(el => ({
                title: el.textContent,
                completed: false
            }));
            
            const taskData = {
                title: document.getElementById('taskTitle').value.trim(),
                description: document.getElementById('taskDescription').value.trim(),
                dueDate: document.getElementById('taskDueDate').value,
                dueTime: document.getElementById('taskDueTime').value,
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                subtasks: subtasks
            };
            
            if (editingTaskId) {
                updateTask(editingTaskId, taskData);
                showToast('Tarefa atualizada!', 'success');
            } else {
                createTask(taskData);
                showToast('Tarefa criada!', 'success');
                logActivity('Nova Tarefa', `Criou a tarefa "${taskData.title}"`, 'add');
            }
            
            closeModal('taskModal');
        }
        
        // Verificar alertas de tarefas
        function checkTaskAlerts(today) {
            if (!tasks || tasks.length === 0) return;
            
            const todayStr = today.toISOString().split('T')[0];
            
            tasks.forEach(task => {
                if (task.completed) return;
                
                const dueDate = new Date(task.dueDate + 'T00:00:00');
                dueDate.setHours(0, 0, 0, 0);
                
                const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) {
                    // Tarefa atrasada
                    saveNotificationToHistory(
                        `Tarefa "${task.title}" est√° ATRASADA! (${formatDateBR(task.dueDate)})`,
                        'error',
                        '‚ö†Ô∏è Tarefa Atrasada',
                        null
                    );
                } else if (diffDays === 0) {
                    // Tarefa para hoje
                    saveNotificationToHistory(
                        `Tarefa "${task.title}" √© para HOJE!${task.dueTime ? ' √†s ' + task.dueTime : ''}`,
                        'warning',
                        'üìå Tarefa Hoje',
                        null
                    );
                } else if (diffDays === 1) {
                    // Tarefa para amanh√£
                    saveNotificationToHistory(
                        `Tarefa "${task.title}" √© para amanh√£`,
                        'info',
                        'üìÖ Tarefa Amanh√£',
                        null
                    );
                }
            });
        }
        
        // Inicializar sistema de tarefas
        function initTaskSystem() {
            updateTaskBadge();
            updateTaskStats();
            
            // Bot√£o nova tarefa
            document.getElementById('newTaskBtn')?.addEventListener('click', () => openTaskModal());
            
            // Filtros
            document.querySelectorAll('.task-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.task-filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTaskFilter = btn.dataset.filter;
                    renderTasks();
                });
            });
            
            renderTasks();
        }
        
        // Sobrescrever showToast para salvar no hist√≥rico (apenas alertas autom√°ticos)
        const originalShowToast = showToast;
        showToast = function(message, type = 'success', options = {}) {
            // Lista de mensagens que N√ÉO devem ser salvas no hist√≥rico
            const ignoredPatterns = [
                /curso (criado|atualizado|salvo)/i,
                /curso exclu[i√≠]do/i,
                /erro ao (salvar|excluir) curso/i,
                /instrutor (criado|atualizado|salvo)/i,
                /instrutor exclu[i√≠]do/i,
                /erro ao (salvar|excluir) instrutor/i,
                /usu[a√°]rio exclu[i√≠]do/i,
                /erro ao excluir usu[a√°]rio/i,
                /email inv√°lido/i,
                /telefone inv√°lido/i,
                /importa(√ß√£o|dos|r)/i,
                /id do lote/i,
                /data de fim n√£o pode/i,
                /url .* inv√°lid/i,
                /n√∫mero de concludentes/i,
                /lote deve ter/i,
                /backup/i,
                /restaur/i,
                /export/i,
                /modo (normal|compacto) ativ/i,
                /notifica√ß√£o removida/i,
                /marcado como conclu[i√≠]do/i,
                /alerta\(s\) encontrado/i,
                /dados foram exclu[i√≠]dos/i,
                /sucesso/i,
                /evento (adicionado|removido|criado|exclu[i√≠]do)/i,
                /tarefa (criada|atualizada|exclu[i√≠]da)/i,
                /tarefa .* conclu[i√≠]da/i
            ];
            
            // Verificar se deve ignorar
            const shouldIgnore = ignoredPatterns.some(pattern => pattern.test(message));
            
            // Salvar no hist√≥rico apenas se N√ÉO estiver na lista de ignorados
            if (!shouldIgnore) {
                saveNotificationToHistory(message, type, options.title);
            }
            
            // Chamar fun√ß√£o original (sempre mostra o toast)
            return originalShowToast(message, type, options);
        };

        async function logActivity(action, description, type = 'add') {
            const logEntry = {
                action,
                description,
                type,
                user: currentUser?.name || 'Sistema',
                timestamp: firebaseAvailable ? firebase.firestore.FieldValue.serverTimestamp() : new Date()
            };

            try {
                if (firebaseAvailable) {
                    await db.collection('activities').add(logEntry);
                } else {
                    const currentLogs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
                    currentLogs.unshift({...logEntry, timestamp: new Date()});
                    localStorage.setItem('activityLogs', JSON.stringify(currentLogs.slice(0, 100)));
                    renderActivityLogs();
                }
            } catch (error) {
                console.error('Error logging activity:', error);
            }
        }
        
        // ========== SISTEMA DE HIST√ìRICO DE ALTERA√á√ïES COMPLETO ==========
        
        // Armazenar hist√≥rico de altera√ß√µes por curso
        let courseHistory = {};
        
        function loadCourseHistory() {
            const saved = localStorage.getItem('courseHistory');
            if (saved) {
                courseHistory = JSON.parse(saved);
            }
        }
        
        function saveCourseHistory() {
            localStorage.setItem('courseHistory', JSON.stringify(courseHistory));
        }
        
        function addCourseHistoryEntry(courseId, action, changes, oldData = null) {
            if (!courseHistory[courseId]) {
                courseHistory[courseId] = [];
            }
            
            const entry = {
                id: Date.now() + Math.random(),
                action, // 'created', 'updated', 'deleted'
                changes, // { field: { old: value, new: value } }
                user: currentUser?.name || 'Sistema',
                userId: currentUser?.id || null,
                timestamp: new Date().toISOString(),
                oldData: oldData ? JSON.parse(JSON.stringify(oldData)) : null
            };
            
            courseHistory[courseId].unshift(entry);
            
            // Manter apenas √∫ltimas 50 altera√ß√µes por curso
            if (courseHistory[courseId].length > 50) {
                courseHistory[courseId] = courseHistory[courseId].slice(0, 50);
            }
            
            saveCourseHistory();
            
            // Salvar no Firebase se dispon√≠vel
            if (firebaseAvailable) {
                db.collection('courseHistory').add({
                    courseId,
                    ...entry
                }).catch(err => console.error('Erro ao salvar hist√≥rico no Firebase:', err));
            }
        }
        
        function getCourseHistory(courseId) {
            return courseHistory[courseId] || [];
        }
        
        function renderCourseHistory(courseId) {
            const history = getCourseHistory(courseId);
            if (history.length === 0) {
                return '<div style="padding: 1rem; text-align: center; color: var(--text-muted);">Nenhuma altera√ß√£o registrada</div>';
            }
            
            const fieldLabels = {
                curso: 'Nome do Curso',
                status: 'Status',
                alunos: 'Concludentes',
                cidade: 'Cidade',
                inicio: 'Data de In√≠cio',
                fim: 'Data de Fim',
                instrutor: 'Instrutor',
                cargaHoraria: 'Carga Hor√°ria',
                local: 'Local',
                driveLink: 'Link do Drive',
                nota: 'Observa√ß√£o'
            };
            
            return '<div class="course-history-timeline">' +
                history.map(entry => {
                    const changesHtml = Object.keys(entry.changes || {}).map(field => {
                        const change = entry.changes[field];
                        const oldValue = change.old !== null && change.old !== undefined && change.old !== '' ? 
                            '<span class="history-change-old-value">' + (change.old || '(vazio)') + '</span><span class="history-change-arrow">‚Üí</span>' : '';
                        return '<div class="history-change">' +
                            '<span class="history-change-field">' + (fieldLabels[field] || field) + ':</span>' +
                            oldValue +
                            '<span class="history-change-new-value">' + (change.new || '(vazio)') + '</span>' +
                            '</div>';
                    }).join('');
                    
                    const actionText = entry.action === 'created' ? 'Criou o curso' : 
                                      entry.action === 'updated' ? 'Atualizou o curso' :
                                      entry.action === 'deleted' ? 'Excluiu o curso' : 'Alterou o curso';
                    
                    const changesSection = Object.keys(entry.changes || {}).length > 0 ? 
                        '<div class="history-entry-changes">' + changesHtml + '</div>' : '';
                    
                    return '<div class="history-entry">' +
                        '<div class="history-entry-header">' +
                            '<div class="history-entry-user">' +
                                '<span class="material-icons" style="font-size: 16px; vertical-align: middle;">person</span>' +
                                entry.user +
                            '</div>' +
                            '<div class="history-entry-time">' + formatTimestamp(new Date(entry.timestamp)) + '</div>' +
                        '</div>' +
                        '<div class="history-entry-action">' + actionText + '</div>' +
                        changesSection +
                        '</div>';
                }).join('') +
                '</div>';
        }
        
        // Carregar hist√≥rico ao inicializar
        loadCourseHistory();
        
        // Tornar fun√ß√µes globais
        window.getCourseHistory = getCourseHistory;
        window.renderCourseHistory = renderCourseHistory;

        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');
            const excelFileInput = document.getElementById('excelFileInput');

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('drag-over');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('drag-over');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    excelFileInput.files = files;
                    handleExcelUpload({ target: excelFileInput });
                }
            });

            // Prevent default drag behaviors for the whole document
            document.addEventListener('dragover', (e) => e.preventDefault());
            document.addEventListener('drop', (e) => e.preventDefault());
        }

        // Fun√ß√£o para filtrar cursos por LOTE

        // Fun√ß√£o para renderizar cursos organizados por LOTE
        // Fun√ß√£o para verificar alertas nos cards
        function getCourseAlerts(course) {
            const alerts = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const normalizedStatus = normalizeStatus(course.status);
            
            // Alerta 1: Data de fim chegou mas status ainda √© "Em Andamento"
            if (course.fim && normalizedStatus === 'Em Andamento') {
                const endDate = new Date(course.fim);
                endDate.setHours(0, 0, 0, 0);
                
                if (endDate <= today) {
                    alerts.push({
                        type: 'end-date-passed',
                        severity: 'error',
                        title: '‚ö†Ô∏è Curso Finalizado - A√ß√£o Necess√°ria',
                        message: `A data de fim (${formatDate(course.fim)}) j√° passou. Por favor, altere o status para "Conclu√≠do" e informe o n√∫mero de concludentes.`,
                        concludentes: course.alunos || 0,
                        actionText: 'Atualizar Status',
                        action: () => {
                            openCourseModal(course.id);
                            // Focar no campo de status ap√≥s abrir o modal
                            setTimeout(() => {
                                const statusSelect = document.getElementById('courseStatus');
                                if (statusSelect) {
                                    statusSelect.focus();
                                    statusSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                            }, 300);
                        }
                    });
                }
            }
            
            // Alerta 2: Data de in√≠cio chegou mas status ainda √© "Pendente"
            if (course.inicio && normalizedStatus === 'Pendente') {
                const startDate = new Date(course.inicio);
                startDate.setHours(0, 0, 0, 0);
                
                if (startDate <= today) {
                    alerts.push({
                        type: 'start-date-passed',
                        severity: 'warning',
                        title: '‚è∞ Curso Deveria Ter Iniciado',
                        message: `A data de in√≠cio (${formatDate(course.inicio)}) j√° chegou. Por favor, altere o status para "Em Andamento".`,
                        actionText: 'Atualizar para Em Andamento',
                        action: () => {
                            openCourseModal(course.id);
                            // Focar no campo de status ap√≥s abrir o modal
                            setTimeout(() => {
                                const statusSelect = document.getElementById('courseStatus');
                                if (statusSelect) {
                                    statusSelect.value = 'Em Andamento';
                                    statusSelect.focus();
                                    statusSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                            }, 300);
                        }
                    });
                }
            }
            
            return alerts;
        }
        
        // Fun√ß√£o para renderizar alertas
        function renderCourseAlerts(alerts, courseId) {
            // N√£o mostrar alertas para visualizadores
            if (currentUser?.role === 'viewer') return '';
            if (!alerts || alerts.length === 0) return '';
            
            return alerts.map((alert, index) => {
                const alertId = `alert-${courseId}-${index}`;
                return `
                <div class="course-alert ${alert.severity === 'warning' ? 'warning' : ''}" onclick="event.stopPropagation()">
                    <div class="course-alert-icon">
                        <span class="material-icons">${alert.severity === 'warning' ? 'schedule' : 'error'}</span>
                    </div>
                    <div class="course-alert-content">
                        <div class="course-alert-title">${alert.title}</div>
                        <div class="course-alert-message">${alert.message}</div>
                        ${alert.concludentes !== undefined ? `
                            <div style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                                <strong>Concludentes atuais:</strong> ${alert.concludentes}
                            </div>
                        ` : ''}
                        <button class="course-alert-action" onclick="handleAlertAction('${courseId}', '${alert.type}'); event.stopPropagation();">
                            <span class="material-icons" style="font-size: 18px;">edit</span>
                            ${alert.actionText}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        // Fun√ß√£o para lidar com a√ß√µes dos alertas
        function handleAlertAction(courseId, alertType) {
            try {
                // Garantir que courseId seja string para compara√ß√£o
                const course = cursos.find(c => String(c.id) === String(courseId));
                if (!course) {
                    console.error('Curso n√£o encontrado:', courseId);
                    showToast('Erro: Curso n√£o encontrado', 'error');
                    return;
                }
                
                // Abrir modal de edi√ß√£o
                if (typeof openCourseModal === 'function') {
                    openCourseModal(courseId);
                } else {
                    console.error('openCourseModal n√£o est√° definida');
                    showToast('Erro ao abrir modal de edi√ß√£o', 'error');
                    return;
                }
                
                // Aguardar o modal abrir e ent√£o atualizar o campo de status
                setTimeout(() => {
                    const statusSelect = document.getElementById('courseStatus');
                    if (statusSelect) {
                        if (alertType === 'end-date-passed') {
                            // Focar no status para mudar para Conclu√≠do
                            statusSelect.value = 'Conclu√≠do';
                            statusSelect.focus();
                            // Disparar evento change para garantir que seja salvo
                            statusSelect.dispatchEvent(new Event('change', { bubbles: true }));
                        } else if (alertType === 'start-date-passed') {
                            // Mudar para Em Andamento
                            statusSelect.value = 'Em Andamento';
                            statusSelect.focus();
                            // Disparar evento change para garantir que seja salvo
                            statusSelect.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                        statusSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        showToast('Status atualizado. Clique em "Salvar" para confirmar.', 'info');
                    } else {
                        console.error('Campo de status n√£o encontrado');
                        // Tentar novamente ap√≥s mais tempo
                        setTimeout(() => {
                            const retrySelect = document.getElementById('courseStatus');
                            if (retrySelect) {
                                if (alertType === 'end-date-passed') {
                                    retrySelect.value = 'Conclu√≠do';
                                } else if (alertType === 'start-date-passed') {
                                    retrySelect.value = 'Em Andamento';
                                }
                                retrySelect.focus();
                                retrySelect.dispatchEvent(new Event('change', { bubbles: true }));
                            }
                        }, 500);
                    }
                }, 500);
            } catch (error) {
                console.error('Erro em handleAlertAction:', error);
                showToast('Erro ao processar a√ß√£o do alerta', 'error');
            }
        }
        
        // Tornar fun√ß√£o acess√≠vel globalmente
        window.handleAlertAction = handleAlertAction;

        function renderCoursesByLote() {
            const container = document.getElementById('coursesByLoteContainer');
            if (!container) return;

            let filtered = cursos;
            
            // Aplicar filtros avan√ßados
            filtered = filterCourses(filtered);
            
            // Aplicar ordena√ß√£o
            filtered = sortCourses(filtered);
            
            // Aplicar pagina√ß√£o
            const totalItems = filtered.length;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedCourses = filtered.slice(startIndex, endIndex);
            
            // Renderizar pagina√ß√£o
            renderPagination(totalItems);
            
            // Renderizar todos os cursos sem organiza√ß√£o por LOTE
            if (paginatedCourses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <span class="material-icons">school</span>
                        <h3>Nenhum curso encontrado</h3>
                        <p>${filtered.length === 0 ? 'Adicione seu primeiro curso' : 'Nenhum curso corresponde aos filtros aplicados'}</p>
                    </div>
                `;
                return;
            }

            // Renderizar baseado no modo de visualiza√ß√£o
            let coursesHTML = '';
            const statusClass = (course) => getStatusClass(course.status);
            const canEdit = currentUser?.role !== 'viewer';

            if (currentViewMode === 'list') {
                // Modo Lista
                coursesHTML = `
                    <div class="courses-list" style="display: flex; flex-direction: column; gap: 1rem;">
                        ${paginatedCourses.map(course => {
                            const alerts = getCourseAlerts(course);
                            const hasAlert = alerts.length > 0 && currentUser?.role !== 'viewer';
                            const alertClass = hasAlert ? (alerts[0].severity === 'warning' ? 'warning-alert' : '') : '';
                            
                            return `
                            <div class="course-card ${hasAlert ? 'has-alert ' + alertClass : ''}" style="display: flex; flex-direction: column; gap: 1rem; padding: 1.5rem;" onclick="openViewCourseModal('${course.id}')">
                                <div style="display: flex; align-items: center; gap: 1.5rem;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                            <h3 style="margin: 0; font-size: 1.1rem;">${course.curso || 'Sem nome'}</h3>
                                            <span class="status-badge ${statusClass(course)}">${normalizeStatus(course.status)}</span>
                                        </div>
                                        <div style="display: flex; gap: 2rem; flex-wrap: wrap; color: var(--text-secondary); font-size: 0.875rem;">
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">location_on</span> ${course.cidade || 'N/A'}</span>
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">event</span> ${course.inicio && course.fim ? formatDate(course.inicio) + ' - ' + formatDate(course.fim) : 'N/A'}</span>
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">person</span> ${course.instrutor || 'N/A'}</span>
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">groups</span> ${course.alunos || 0} concludentes</span>
                                        </div>
                                    </div>
                                    ${canEdit ? `
                                        <div class="course-actions" onclick="event.stopPropagation()">
                                            <button onclick="openCourseModal('${course.id}')" title="Editar">
                                                <span class="material-icons">edit</span>
                                            </button>
                                            <button class="delete" onclick="deleteCourse('${course.id}')" title="Excluir">
                                                <span class="material-icons">delete</span>
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                                ${renderCourseAlerts(alerts, course.id)}
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
            } else if (currentViewMode === 'timeline') {
                // Modo Timeline
                const sortedByDate = [...paginatedCourses].sort((a, b) => {
                    const dateA = a.inicio ? new Date(a.inicio) : new Date(0);
                    const dateB = b.inicio ? new Date(b.inicio) : new Date(0);
                    return dateA - dateB;
                });
                
                coursesHTML = `
                    <div class="courses-timeline" style="position: relative; padding-left: 2rem;">
                        ${sortedByDate.map((course, index) => {
                            const date = course.inicio ? new Date(course.inicio) : null;
                                return `
                                <div class="timeline-item" style="position: relative; margin-bottom: 2rem; padding-left: 2rem;">
                                    <div style="position: absolute; left: -8px; top: 0; width: 16px; height: 16px; background: var(--primary); border-radius: 50%; border: 3px solid var(--background);"></div>
                                    ${index < sortedByDate.length - 1 ? '<div style="position: absolute; left: -1px; top: 16px; width: 2px; height: calc(100% + 1rem); background: var(--border);"></div>' : ''}
                                    <div class="course-card" onclick="openViewCourseModal('${course.id}')">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                            <div>
                                                <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 0.5rem;">
                                                    ${date ? date.toLocaleDateString('pt-BR') : 'Data n√£o informada'}
                                                </div>
                                                <h3 style="margin: 0; font-size: 1.1rem;">${course.curso || 'Sem nome'}</h3>
                                            </div>
                                            <span class="status-badge ${statusClass(course)}">${normalizeStatus(course.status)}</span>
                                        </div>
                                        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; color: var(--text-secondary); font-size: 0.875rem;">
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">location_on</span> ${course.cidade || 'N/A'}</span>
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">person</span> ${course.instrutor || 'N/A'}</span>
                                            <span><span class="material-icons" style="font-size: 16px; vertical-align: middle;">groups</span> ${course.alunos || 0} concludentes</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else {
                // Modo Grid (padr√£o)
                coursesHTML = `
                    <div class="courses-grid">
                        ${paginatedCourses.map(course => {
                            const alerts = getCourseAlerts(course);
                            const hasAlert = alerts.length > 0 && currentUser?.role !== 'viewer';
                            const alertClass = hasAlert ? (alerts[0].severity === 'warning' ? 'warning-alert' : '') : '';
                            
                            return `
                                    <div class="course-card ${hasAlert ? 'has-alert ' + alertClass : ''}" onclick="openViewCourseModal('${course.id}')">
                                        <div class="course-header">
                                            <div>
                                                <div class="course-title">${course.curso || 'Sem nome'}</div>
                                        <div class="course-id">ID: ${course.idLote || 'N/A'}${course.lote || course.loteResponsavel ? ' | LOTE: ' + (course.lote || course.loteResponsavel) : ''}</div>
                                            </div>
                                            ${canEdit ? `
                                                <div class="course-actions" onclick="event.stopPropagation()">
                                                    ${course.driveLink ? `
                                                        <button class="drive" onclick="openDriveLink('${course.driveLink}')" title="Abrir Google Drive">
                                                            <span class="material-icons">folder</span>
                                                        </button>
                                                    ` : ''}
                                                    <button onclick="openCourseModal('${course.id}')" title="Editar">
                                                        <span class="material-icons">edit</span>
                                                    </button>
                                                    <button class="delete" onclick="deleteCourse('${course.id}')" title="Excluir">
                                                        <span class="material-icons">delete</span>
                                                    </button>
                                                </div>
                                            ` : ''}
                                        </div>
                                        <div class="course-info">
                                            <div class="course-info-item">
                                                <span class="material-icons">location_on</span>
                                                ${course.cidade || 'Local n√£o definido'}${course.local ? ' - ' + course.local : ''}
                                            </div>
                                            <div class="course-info-item">
                                                <span class="material-icons">event</span>
                                        <span>Per√≠odo: ${course.inicio && course.fim ? formatDate(course.inicio) + ' - ' + formatDate(course.fim) : course.inicio ? formatDate(course.inicio) : course.fim ? formatDate(course.fim) : 'N√£o informado'}</span>
                                            </div>
                                            <div class="course-info-item">
                                                <span class="material-icons">person</span>
                                                ${course.instrutor || 'Instrutor n√£o definido'}
                                            </div>
                                            <div class="course-info-item">
                                                <span class="material-icons">groups</span>
                                                ${course.alunos || 0} concludentes
                                            </div>
                                            <div>
                                        <span class="status-badge ${statusClass(course)}">${normalizeStatus(course.status)}</span>
                                            </div>
                                        </div>
                                        ${course.nota ? `
                                            <div class="course-note">
                                                <span class="material-icons">sticky_note_2</span>
                                                <span class="course-note-text">${course.nota}</span>
                                            </div>
                                        ` : ''}
                                        ${renderCourseAlerts(alerts, course.id)}
                                    </div>
                        `;
                        }).join('')}
                    </div>
                `;
            }

            container.innerHTML = coursesHTML;
        }

        function getDisplayLoteName(lote) {
            return loteNames[lote] || lote;
        }

        function editLoteName(lote) {
            const titleElement = document.getElementById(`lote-title-${lote.replace(/\s+/g, '-')}`);
            if (!titleElement) return;

            const currentName = getDisplayLoteName(lote);
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'lote-edit-input';
            input.value = currentName;
            
            const saveBtn = document.createElement('button');
            saveBtn.className = 'btn btn-success btn-icon';
            saveBtn.innerHTML = '<span class="material-icons">save</span>';
            saveBtn.onclick = () => saveLoteName(lote, input.value);

            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn btn-secondary btn-icon';
            cancelBtn.innerHTML = '<span class="material-icons">close</span>';
            cancelBtn.onclick = () => {
                titleElement.parentElement.innerHTML = `<span id="lote-title-${lote.replace(/\s+/g, '-')}">${getDisplayLoteName(lote)}</span><span class="lote-count">${cursos.filter(c => (c.lote || c.loteResponsavel || 'Sem LOTE') === lote).length} curso${cursos.filter(c => (c.lote || c.loteResponsavel || 'Sem LOTE') === lote).length !== 1 ? 's' : ''}</span>`;
            };

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'lote-edit-actions';
            actionsDiv.appendChild(saveBtn);
            actionsDiv.appendChild(cancelBtn);

            titleElement.parentElement.innerHTML = '';
            titleElement.parentElement.appendChild(input);
            titleElement.parentElement.appendChild(actionsDiv);
            input.focus();
        }

        async function saveLoteName(lote, newName) {
            if (!newName.trim()) {
                showToast('Nome do LOTE n√£o pode estar vazio', 'error');
                return;
            }

            if (newName.trim().length < 2) {
                showToast('Nome do LOTE deve ter pelo menos 2 caracteres', 'error');
                return;
            }

            setLoadingState(true);
            
            try {
            loteNames[lote] = newName.trim();
            localStorage.setItem('loteNames', JSON.stringify(loteNames));

                // Salvar no Firebase se dispon√≠vel
                if (firebaseAvailable) {
                    try {
                        await db.collection('loteNames').doc(lote).set({ name: newName.trim() });
                    } catch (error) {
                        console.warn('Erro ao salvar loteName no Firebase:', error);
                    }
                }

                // Atualizar cursos com o novo nome do lote (otimizado)
                const coursesToUpdate = cursos.filter(course => 
                    (course.lote || course.loteResponsavel || 'Sem LOTE') === lote
                );

            if (firebaseAvailable) {
                    // Atualizar em batch no Firebase
                    const batch = db.batch();
                    coursesToUpdate.forEach(course => {
                        const courseRef = db.collection('cursos').doc(course.id);
                        batch.update(courseRef, {
                            lote: newName.trim(),
                            loteResponsavel: newName.trim()
                        });
                        // Atualizar localmente tamb√©m
                        course.lote = newName.trim();
                        course.loteResponsavel = newName.trim();
                });
                    await batch.commit();
            } else {
                    coursesToUpdate.forEach(course => {
                        course.lote = newName.trim();
                        course.loteResponsavel = newName.trim();
                    });
                localStorage.setItem('cursos', JSON.stringify(cursos));
            }

            showToast('Nome do LOTE atualizado!', 'success');
                logActivity('Edi√ß√£o de LOTE', `Renomeou o LOTE "${lote}" para "${newName.trim()}"`, 'edit');
                
                // Renderizar de forma otimizada
                requestAnimationFrame(() => {
                    renderCoursesByLote();
                });
            } catch (error) {
                console.error('Erro ao salvar nome do LOTE:', error);
                showToast('Erro ao atualizar nome do LOTE', 'error');
            } finally {
                setLoadingState(false);
            }
        }

        function renderDashboardReport() {
            const container = document.getElementById('dashboardReport');
            if (!container) return;

            const total = cursos.length;
            const concluidos = cursos.filter(c => normalizeStatus(c.status) === 'Conclu√≠do').length;
            const andamento = cursos.filter(c => normalizeStatus(c.status) === 'Em Andamento').length;
            const pendentes = cursos.filter(c => normalizeStatus(c.status) === 'Pendente').length;
            const cancelados = cursos.filter(c => normalizeStatus(c.status) === 'Cancelado').length;
            const totalAlunos = cursos.reduce((sum, c) => sum + (parseInt(c.alunos) || 0), 0);
            
            // Estat√≠sticas adicionais
            const cursosPorCidade = {};
            const cursosPorInstrutor = {};
            const cursosPorLote = {};
            const cargaHorariaTotal = cursos.reduce((sum, c) => {
                const carga = parseInt(c.cargaHoraria) || 0;
                return sum + carga;
            }, 0);
            
            cursos.forEach(c => {
                const cidade = c.cidade || 'N√£o definido';
                cursosPorCidade[cidade] = (cursosPorCidade[cidade] || 0) + 1;
                
                const instrutor = c.instrutor || 'N√£o definido';
                cursosPorInstrutor[instrutor] = (cursosPorInstrutor[instrutor] || 0) + 1;
                
                const lote = c.lote || c.loteResponsavel || 'Sem LOTE';
                cursosPorLote[lote] = (cursosPorLote[lote] || 0) + 1;
            });
            
            const topCidades = Object.entries(cursosPorCidade)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            const topInstrutores = Object.entries(cursosPorInstrutor)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            const totalLotes = Object.keys(cursosPorLote).length;
            
            // Calcular percentuais
            const percentConcluidos = total > 0 ? ((concluidos / total) * 100).toFixed(1) : 0;
            const percentAndamento = total > 0 ? ((andamento / total) * 100).toFixed(1) : 0;
            const percentPendentes = total > 0 ? ((pendentes / total) * 100).toFixed(1) : 0;
            const percentCancelados = total > 0 ? ((cancelados / total) * 100).toFixed(1) : 0;
            const mediaAlunos = total > 0 ? (totalAlunos / total).toFixed(1) : 0;

            container.innerHTML = `
                <div class="report-kpi-grid">
                    <div class="report-kpi-card purple">
                        <div class="report-kpi-value">${total}</div>
                        <div class="report-kpi-label">Total de Cursos</div>
                    </div>
                    <div class="report-kpi-card green">
                        <div class="report-kpi-value">${concluidos}</div>
                        <div class="report-kpi-label">Conclu√≠dos (${percentConcluidos}%)</div>
                    </div>
                    <div class="report-kpi-card blue">
                        <div class="report-kpi-value">${andamento}</div>
                        <div class="report-kpi-label">Em Andamento (${percentAndamento}%)</div>
                    </div>
                    <div class="report-kpi-card yellow">
                        <div class="report-kpi-value">${pendentes}</div>
                        <div class="report-kpi-label">Pendentes (${percentPendentes}%)</div>
                    </div>
                    ${cancelados > 0 ? `
                    <div class="report-kpi-card red">
                        <div class="report-kpi-value">${cancelados}</div>
                        <div class="report-kpi-label">Cancelados (${percentCancelados}%)</div>
                    </div>
                    ` : ''}
                    <div class="report-kpi-card">
                        <div class="report-kpi-value">${totalAlunos}</div>
                        <div class="report-kpi-label">Total Concludentes</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-top: 2rem;">
                    <!-- Gr√°fico Pizza de Status -->
                    <div class="settings-card">
                        <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons">pie_chart</span>
                            Distribui√ß√£o por Status
                        </h3>
                        <div style="display: flex; justify-content: center; margin: 1.5rem 0;">
                            <canvas id="dashboardStatusChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <!-- Top Cidades -->
                    <div class="settings-card">
                        <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons">location_city</span>
                            Top 5 Cidades
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            ${topCidades.map(([cidade, qtd]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--background); border-radius: 8px; border: 1px solid var(--border);">
                                    <span style="color: var(--text-primary);">${cidade}</span>
                                    <span style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 0.875rem;">${qtd}</span>
                                </div>
                            `).join('')}
                            ${topCidades.length === 0 ? '<p style="color: var(--text-muted); text-align: center;">Nenhuma cidade cadastrada</p>' : ''}
                        </div>
                    </div>
                    
                    <!-- Top Instrutores -->
                    <div class="settings-card">
                        <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons">people</span>
                            Top 5 Instrutores
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            ${topInstrutores.map(([instrutor, qtd]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--background); border-radius: 8px; border: 1px solid var(--border);">
                                    <span style="color: var(--text-primary);">${instrutor}</span>
                                    <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 0.875rem;">${qtd}</span>
                                </div>
                            `).join('')}
                            ${topInstrutores.length === 0 ? '<p style="color: var(--text-muted); text-align: center;">Nenhum instrutor cadastrado</p>' : ''}
                        </div>
                    </div>
                    
                    <!-- Distribui√ß√£o por LOTE -->
                    <div class="settings-card">
                        <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons">folder</span>
                            Distribui√ß√£o por LOTE
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem; max-height: 300px; overflow-y: auto;">
                            ${Object.entries(cursosPorLote).sort((a, b) => b[1] - a[1]).map(([lote, qtd]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--background); border-radius: 8px; border: 1px solid var(--border);">
                                    <span style="color: var(--text-primary);">${getDisplayLoteName(lote)}</span>
                                    <span style="background: var(--info); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 0.875rem;">${qtd}</span>
                                </div>
                            `).join('')}
                            ${Object.keys(cursosPorLote).length === 0 ? '<p style="color: var(--text-muted); text-align: center;">Nenhum LOTE cadastrado</p>' : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Renderizar gr√°fico pizza ap√≥s um pequeno delay para garantir que o canvas esteja no DOM
            setTimeout(() => {
                const ctx = document.getElementById('dashboardStatusChart')?.getContext('2d');
                if (ctx && Chart) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Conclu√≠dos', 'Em Andamento', 'Pendentes', 'Cancelados'],
                            datasets: [{
                                data: [concluidos, andamento, pendentes, cancelados],
                                backgroundColor: ['#34d399', '#60a5fa', '#fbbf24', '#f87171'],
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            cutout: '60%',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#f8fafc',
                                        padding: 15,
                                        font: {
                                            size: 12,
                                            weight: '500'
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    padding: 12,
                                    titleFont: {
                                        size: 14,
                                        weight: '600'
                                    },
                                    bodyFont: {
                                        size: 13
                                    },
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    navigateTo(page);
                });
            });

            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleSidebar);

            // Filtro de LOTE na p√°gina de Cursos

            // Buttons
            const newCourseBtn = document.getElementById('newCourseBtn');
            if (newCourseBtn) {
                newCourseBtn.addEventListener('click', () => openCourseModal());
            }
            const newInstructorBtn = document.getElementById('newInstructorBtn');
            if (newInstructorBtn) {
                newInstructorBtn.addEventListener('click', () => openInstructorModal());
            }
            const importInstructorsBtn = document.getElementById('importInstructorsBtn');
            if (importInstructorsBtn) {
                importInstructorsBtn.addEventListener('click', () => {
                    document.getElementById('instructorsFileInput').click();
                });
            }
            document.getElementById('newUserBtn').addEventListener('click', () => openUserModal());
            
            // Mobile menu
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleSidebar);
            }
            
            // Bot√£o fixo para abrir sidebar no mobile
            const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
            if (mobileSidebarToggle) {
                mobileSidebarToggle.addEventListener('click', toggleSidebar);
            }
            
            // Bot√£o de download do relat√≥rio
            const downloadReportBtn = document.getElementById('downloadReportBtn');
            if (downloadReportBtn) {
                downloadReportBtn.addEventListener('click', () => {
                    downloadReportAsImage();
                });
            }

            // Calendar
            document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
            document.getElementById('todayBtn').addEventListener('click', goToToday);

            // Forms
            document.getElementById('courseForm').addEventListener('submit', handleCourseSubmit);
            document.getElementById('instructorForm').addEventListener('submit', handleInstructorSubmit);
            document.getElementById('quickInstructorForm').addEventListener('submit', handleQuickInstructorSubmit);
            document.getElementById('userForm').addEventListener('submit', handleUserSubmit);
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            document.getElementById('changeNameForm').addEventListener('submit', handleChangeName); 

            // Settings - O preview ser√° tratado em initializeImportPreview
            document.getElementById('instructorsFileInput').addEventListener('change', handleInstructorsUpload);
            document.getElementById('exportCoursesBtn').addEventListener('click', exportCoursesToCsv);
            if (document.getElementById('exportCoursesExcelBtn')) {
                document.getElementById('exportCoursesExcelBtn').addEventListener('click', exportCoursesToExcel);
            }
            if (document.getElementById('exportCoursesPDFBtn')) {
                document.getElementById('exportCoursesPDFBtn').addEventListener('click', exportCoursesToPDF);
            }
            document.getElementById('exportInstructorsBtn').addEventListener('click', exportInstructorsToCsv);
            document.getElementById('clearDataBtn').addEventListener('click', clearAllData);
            
            // Novas funcionalidades
            initializeAdvancedFeatures();
        }

        function handleLogout() {
            // Salvar automaticamente antes de sair
            saveAllChanges();
            currentUser = null;
            localStorage.removeItem('currentUser');
            window.location.reload();
        }
        
        // ========== IMPLEMENTA√á√ÉO DAS NOVAS FUNCIONALIDADES ==========
        
        // Vari√°veis globais para novas funcionalidades
        let currentFilters = {};
        let currentSort = { field: 'name', direction: 'asc' };
        let currentPage = 1;
        let itemsPerPage = 10000; // Mostrar todos os cursos
        let notifications = [];
        let changeHistory = [];
        let unsavedChanges = false;
        let previewData = null;
        let backupInterval = null;
        // Inicializar todas as novas funcionalidades
        function initializeAdvancedFeatures() {
            initializeTheme();
            initializeSearchAndFilters();
            initializePagination();
            initializeSorting();
            initializeKeyboardShortcuts();
            initializeAutoSave();
            initializeBackup();
            initializeTooltips();
            initializeChangeHistory();
            initializeImportPreview();
            initializeCustomTheme();
            initializeProjectName();
            initializeCompactMode();
            initializeBreadcrumbs();
            initializePushNotifications();
            initializePWA();
            initializeSwipeGestures();
            initializeSkeletonLoading();
        }
        
        // ==================== MODO COMPACTO ====================
        function initializeCompactMode() {
            const compactBtn = document.getElementById('compactModeBtn');
            if (!compactBtn) return;
            
            const savedCompact = localStorage.getItem('compactMode') === 'true';
            if (savedCompact) {
                document.body.classList.add('compact-mode');
                compactBtn.classList.add('active');
            }
            
            compactBtn.addEventListener('click', () => {
                document.body.classList.toggle('compact-mode');
                compactBtn.classList.toggle('active');
                const isCompact = document.body.classList.contains('compact-mode');
                localStorage.setItem('compactMode', isCompact);
                showToast(isCompact ? 'Modo compacto ativado' : 'Modo normal ativado', 'success');
            });
        }
        
        // ==================== BREADCRUMBS ====================
        const pageNames = {
            dashboard: 'Dashboard',
            courses: 'Cursos',
            calendar: 'Calend√°rio',
            instructors: 'Instrutores',
            users: 'Usu√°rios',
            settings: 'Configura√ß√µes'
        };
        
        function initializeBreadcrumbs() {
            document.querySelectorAll('.breadcrumb-item[data-page]').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    if (page) navigateTo(page);
                });
            });
        }
        
        function updateBreadcrumbs(page) {
            const currentBreadcrumb = document.getElementById('currentPageBreadcrumb');
            if (currentBreadcrumb) {
                currentBreadcrumb.textContent = pageNames[page] || page;
                currentBreadcrumb.classList.add('animate-fade-in');
                setTimeout(() => currentBreadcrumb.classList.remove('animate-fade-in'), 300);
            }
        }
        
        // ==================== NOTIFICA√á√ïES PUSH ====================
        let pushNotificationQueue = [];
        let pushNotificationTimer = null;
        
        function initializePushNotifications() {
            // Solicitar permiss√£o para notifica√ß√µes do navegador
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    Notification.requestPermission();
                }, 5000);
            }
            
            // Verificar cursos com alertas periodicamente
            setInterval(checkCourseAlerts, 60000); // A cada minuto
            setTimeout(checkCourseAlerts, 3000); // Verificar ap√≥s 3s do carregamento
        }
        
        function checkCourseAlerts() {
            if (!cursos || cursos.length === 0) return;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            cursos.forEach(course => {
                // Alerta: curso inicia em 3 dias
                if (course.inicio) {
                    const startDate = new Date(course.inicio);
                    startDate.setHours(0, 0, 0, 0);
                    const daysUntilStart = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntilStart > 0 && daysUntilStart <= 3 && normalizeStatus(course.status) === 'Pendente') {
                        const notifId = `start-${course.id}-${startDate.toISOString()}`;
                        if (!localStorage.getItem(`notif-dismissed-${notifId}`)) {
                            showPushNotification(
                                'Curso prestes a iniciar',
                                `"${course.curso}" inicia em ${daysUntilStart} dia(s) - ${formatDate(course.inicio)}`,
                                'schedule',
                                [{ text: 'Ver curso', action: () => openViewCourseModal(course.id) }],
                                notifId
                            );
                        }
                    }
                }
                
                // Alerta: curso finaliza em 3 dias
                if (course.fim) {
                    const endDate = new Date(course.fim);
                    endDate.setHours(0, 0, 0, 0);
                    const daysUntilEnd = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysUntilEnd > 0 && daysUntilEnd <= 3 && normalizeStatus(course.status) === 'Em Andamento') {
                        const notifId = `end-${course.id}-${endDate.toISOString()}`;
                        if (!localStorage.getItem(`notif-dismissed-${notifId}`)) {
                            showPushNotification(
                                'Curso prestes a finalizar',
                                `"${course.curso}" termina em ${daysUntilEnd} dia(s) - ${formatDate(course.fim)}`,
                                'event_available',
                                [{ text: 'Ver curso', action: () => openViewCourseModal(course.id) }],
                                notifId
                            );
                        }
                    }
                }
            });
        }
        
        function showPushNotification(title, message, icon = 'notifications', actions = [], notifId = null) {
            // Notifica√ß√£o in-app
            const banner = document.getElementById('pushNotificationBanner');
            const titleEl = document.getElementById('pushNotificationTitle');
            const bodyEl = document.getElementById('pushNotificationBody');
            const actionsEl = document.getElementById('pushNotificationActions');
            
            if (banner && titleEl && bodyEl) {
                titleEl.textContent = title;
                bodyEl.textContent = message;
                
                actionsEl.innerHTML = '';
                actions.forEach(action => {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-primary';
                    btn.textContent = action.text;
                    btn.onclick = () => {
                        action.action();
                        closePushNotification(notifId);
                    };
                    actionsEl.appendChild(btn);
                });
                
                banner.classList.add('show');
                banner.dataset.notifId = notifId || '';
                
                // Auto-hide ap√≥s 10s
                if (pushNotificationTimer) clearTimeout(pushNotificationTimer);
                pushNotificationTimer = setTimeout(() => closePushNotification(), 10000);
            }
            
            // Notifica√ß√£o do navegador (se permitido)
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });
            }
        }
        
        function closePushNotification(notifId = null) {
            const banner = document.getElementById('pushNotificationBanner');
            if (banner) {
                const id = notifId || banner.dataset.notifId;
                if (id) {
                    localStorage.setItem(`notif-dismissed-${id}`, 'true');
                }
                banner.classList.add('hiding');
                setTimeout(() => {
                    banner.classList.remove('show', 'hiding');
                }, 300);
            }
        }
        window.closePushNotification = closePushNotification;
        
        // ==================== PWA ====================
        let deferredPrompt = null;
        
        function initializePWA() {
            // Registrar Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(err => {
                    console.log('Service Worker n√£o registrado:', err);
                });
            }
            
            // Capturar evento de instala√ß√£o
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Mostrar prompt de instala√ß√£o ap√≥s 30s se n√£o foi instalado
                if (!localStorage.getItem('pwa-installed') && !localStorage.getItem('pwa-dismissed')) {
                    setTimeout(() => {
                        const prompt = document.getElementById('pwaInstallPrompt');
                        if (prompt) prompt.classList.add('show');
                    }, 30000);
                }
            });
            
            window.addEventListener('appinstalled', () => {
                localStorage.setItem('pwa-installed', 'true');
                deferredPrompt = null;
                showToast('App instalado com sucesso!', 'success');
            });
        }
        
        function installPWA() {
            const prompt = document.getElementById('pwaInstallPrompt');
            if (prompt) prompt.classList.remove('show');
            
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choice => {
                    if (choice.outcome === 'accepted') {
                        showToast('Instalando app...', 'success');
                    }
                    deferredPrompt = null;
                });
            }
        }
        window.installPWA = installPWA;
        
        function dismissPWAPrompt() {
            const prompt = document.getElementById('pwaInstallPrompt');
            if (prompt) prompt.classList.remove('show');
            localStorage.setItem('pwa-dismissed', 'true');
        }
        window.dismissPWAPrompt = dismissPWAPrompt;
        
        // ==================== SWIPE GESTURES ====================
        function initializeSwipeGestures() {
            // S√≥ ativar em dispositivos touch
            if (!('ontouchstart' in window)) return;
            
            document.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: true });
        }
        
        let touchStartX = 0;
        let touchStartY = 0;
        let currentSwipeCard = null;
        
        function handleTouchStart(e) {
            const card = e.target.closest('.course-card');
            if (!card || currentUser?.role === 'viewer') return;
            
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            currentSwipeCard = card;
        }
        
        function handleTouchMove(e) {
            if (!currentSwipeCard) return;
            
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const diffX = touchStartX - touchX;
            const diffY = Math.abs(touchStartY - e.touches[0].clientY);
            
            // S√≥ swipe horizontal
            if (diffY > 30) {
                currentSwipeCard = null;
                return;
            }
            
            if (diffX > 50) {
                e.preventDefault();
                currentSwipeCard.style.transform = `translateX(-${Math.min(diffX, 120)}px)`;
                currentSwipeCard.classList.add('swiping');
            }
        }
        
        function handleTouchEnd(e) {
            if (!currentSwipeCard) return;
            
            const card = currentSwipeCard;
            const transform = card.style.transform;
            const translateX = transform ? parseInt(transform.match(/-?\d+/)?.[0] || 0) : 0;
            
            card.classList.remove('swiping');
            
            if (Math.abs(translateX) > 80) {
                // Mostrar a√ß√µes
                card.style.transform = 'translateX(-120px)';
                
                // Adicionar bot√µes de a√ß√£o se n√£o existirem
                if (!card.querySelector('.swipe-actions-container')) {
                    const courseId = card.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                    if (courseId) {
                        const actionsHtml = `
                            <div class="swipe-actions-container" style="position: absolute; right: 0; top: 0; height: 100%; display: flex; z-index: 10;">
                                <button onclick="event.stopPropagation(); openCourseModal('${courseId}')" style="background: var(--primary); color: white; border: none; padding: 0 1rem; cursor: pointer;">
                                    <span class="material-icons">edit</span>
                                </button>
                                <button onclick="event.stopPropagation(); deleteCourse('${courseId}')" style="background: var(--danger); color: white; border: none; padding: 0 1rem; cursor: pointer;">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        `;
                        card.style.position = 'relative';
                        card.style.overflow = 'hidden';
                        card.insertAdjacentHTML('beforeend', actionsHtml);
                    }
                }
                
                // Fechar ao clicar fora
                setTimeout(() => {
                    const closeHandler = (ev) => {
                        if (!card.contains(ev.target)) {
                            card.style.transform = '';
                            const actions = card.querySelector('.swipe-actions-container');
                            if (actions) actions.remove();
                            document.removeEventListener('touchstart', closeHandler);
                            document.removeEventListener('click', closeHandler);
                        }
                    };
                    document.addEventListener('touchstart', closeHandler);
                    document.addEventListener('click', closeHandler);
                }, 100);
            } else {
                card.style.transform = '';
            }
            
            currentSwipeCard = null;
        }
        
        // ==================== SKELETON LOADING ====================
        function initializeSkeletonLoading() {
            // Mostrar skeleton ao carregar
            showSkeletonLoading();
        }
        
        function showSkeletonLoading() {
            const container = document.getElementById('coursesByLoteContainer');
            if (!container) return;
            
            const skeletonHtml = `
                <div class="courses-grid">
                    ${Array(6).fill().map(() => `
                        <div class="skeleton skeleton-card"></div>
                    `).join('')}
                </div>
            `;
            container.innerHTML = skeletonHtml;
        }
        
        function hideSkeletonLoading() {
            // O skeleton √© automaticamente substitu√≠do pelo renderCoursesByLote
        }
        
        // 1. Modo Escuro/Claro e Temas
        function initializeTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const savedColorTheme = localStorage.getItem('colorTheme') || 'default';
            
            // Aplicar modo claro/escuro primeiro
            if (savedTheme === 'light') {
                document.documentElement.classList.add('light-mode');
                if (themeIcon) themeIcon.textContent = 'light_mode';
            }
            
            // Toggle claro/escuro
            if (themeToggle && themeIcon) {
                themeToggle.addEventListener('click', () => {
                    document.documentElement.classList.toggle('light-mode');
                    const isLight = document.documentElement.classList.contains('light-mode');
                    themeIcon.textContent = isLight ? 'light_mode' : 'dark_mode';
                    localStorage.setItem('theme', isLight ? 'light' : 'dark');
                });
            }
            
            // Aplicar tema de cor salvo (depois do modo claro/escuro)
            applyColorTheme(savedColorTheme);
            
            // Inicializar sele√ß√£o de temas de cor
            initializeColorThemes();
        }
        
        function initializeColorThemes() {
            const themeOptions = document.querySelectorAll('.theme-option');
            const savedColorTheme = localStorage.getItem('colorTheme') || 'default';
            
            // Marcar tema ativo
            themeOptions.forEach(option => {
                const theme = option.dataset.theme;
                if (theme === savedColorTheme) {
                    option.classList.add('active');
                }
                
                option.addEventListener('click', () => {
                    // Remover active de todos
                    themeOptions.forEach(opt => opt.classList.remove('active'));
                    // Adicionar active ao selecionado
                    option.classList.add('active');
                    // Aplicar tema
                    applyColorTheme(theme);
                    localStorage.setItem('colorTheme', theme);
                    showToast(`Tema "${option.querySelector('h4').textContent}" aplicado!`, 'success');
                });
            });
        }
        
        function applyColorTheme(theme) {
            // Remover todos os temas de cor
            document.documentElement.classList.remove('theme-blue', 'theme-green', 'theme-purple', 'theme-orange', 'theme-pink', 'theme-custom');
            
            // Se for tema customizado, aplicar cores salvas
            if (theme === 'custom') {
                applyCustomTheme();
                document.documentElement.classList.add('theme-custom');
            } else if (theme && theme !== 'default') {
                // Aplicar novo tema (default n√£o precisa de classe)
                document.documentElement.classList.add(`theme-${theme}`);
                // Limpar cores customizadas quando trocar para tema pr√©-definido
                clearCustomTheme();
            } else {
                // Tema padr√£o
                clearCustomTheme();
            }
        }
        
        function applyCustomTheme() {
            const customColors = JSON.parse(localStorage.getItem('customThemeColors') || '{}');
            if (Object.keys(customColors).length > 0) {
                Object.entries(customColors).forEach(([key, value]) => {
                    document.documentElement.style.setProperty(`--${key}`, value);
                });
            }
        }
        
        function clearCustomTheme() {
            // Remover estilos inline de cores customizadas
            const customColorKeys = ['primary', 'primary-hover', 'background', 'sidebar', 'surface', 'surface-hover'];
            customColorKeys.forEach(key => {
                document.documentElement.style.removeProperty(`--${key}`);
            });
        }
        
        function initializeCustomTheme() {
            const applyBtn = document.getElementById('applyCustomThemeBtn');
            const resetBtn = document.getElementById('resetCustomThemeBtn');
            const primaryInput = document.getElementById('customPrimaryColor');
            const backgroundInput = document.getElementById('customBackgroundColor');
            const sidebarInput = document.getElementById('customSidebarColor');
            const surfaceInput = document.getElementById('customSurfaceColor');
            
            // Carregar cores salvas
            const savedColors = JSON.parse(localStorage.getItem('customThemeColors') || '{}');
            if (savedColors.primary) primaryInput.value = savedColors.primary;
            if (savedColors.background) backgroundInput.value = savedColors.background;
            if (savedColors.sidebar) sidebarInput.value = savedColors.sidebar;
            if (savedColors.surface) surfaceInput.value = savedColors.surface;
            
            if (applyBtn) {
                applyBtn.addEventListener('click', () => {
                    const customColors = {
                        primary: primaryInput.value,
                        'primary-hover': adjustColorBrightness(primaryInput.value, -10),
                        background: backgroundInput.value,
                        sidebar: sidebarInput.value,
                        surface: surfaceInput.value,
                        'surface-hover': adjustColorBrightness(surfaceInput.value, 10)
                    };
                    
                    localStorage.setItem('customThemeColors', JSON.stringify(customColors));
                    localStorage.setItem('colorTheme', 'custom');
                    
                    // Aplicar tema customizado
                    applyColorTheme('custom');
                    
                    // Atualizar sele√ß√£o visual
                    document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
                    
                    showToast('Tema personalizado aplicado com sucesso!', 'success');
                });
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    if (confirm('Deseja restaurar as cores padr√£o do tema?')) {
                        localStorage.removeItem('customThemeColors');
                        localStorage.setItem('colorTheme', 'default');
                        
                        // Restaurar valores padr√£o
                        primaryInput.value = '#6366f1';
                        backgroundInput.value = '#0f172a';
                        sidebarInput.value = '#020617';
                        surfaceInput.value = '#1e293b';
                        
                        applyColorTheme('default');
                        
                        // Atualizar sele√ß√£o visual
                        document.querySelectorAll('.theme-option').forEach(opt => {
                            opt.classList.toggle('active', opt.dataset.theme === 'default');
                        });
                        
                        showToast('Cores padr√£o restauradas!', 'success');
                    }
                });
            }
        }
        
        function adjustColorBrightness(hex, percent) {
            // Converter hex para RGB
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            
            // Ajustar brilho
            const newR = Math.max(0, Math.min(255, r + (r * percent / 100)));
            const newG = Math.max(0, Math.min(255, g + (g * percent / 100)));
            const newB = Math.max(0, Math.min(255, b + (b * percent / 100)));
            
            // Converter de volta para hex
            return '#' + [newR, newG, newB].map(x => {
                const hex = Math.round(x).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }
        
        // Gerenciamento de Nome do Projeto
        function initializeProjectName() {
            const projectNameInput = document.getElementById('projectNameInput');
            const saveProjectNameBtn = document.getElementById('saveProjectNameBtn');
            
            // Carregar nome salvo
            const savedName = localStorage.getItem('projectName') || 'CSF Manager';
            if (projectNameInput) {
                projectNameInput.value = savedName;
            }
            
            // Salvar nome do projeto
            if (saveProjectNameBtn) {
                saveProjectNameBtn.addEventListener('click', () => {
                    const projectName = projectNameInput.value.trim();
                    if (!projectName) {
                        showToast('Por favor, digite um nome para o projeto', 'warning');
                        return;
                    }
                    
                    localStorage.setItem('projectName', projectName);
                    updateProjectName(projectName);
                    showToast('Nome do projeto atualizado!', 'success');
                });
            }
            
            // Permitir salvar com Enter
            if (projectNameInput) {
                projectNameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        saveProjectNameBtn.click();
                    }
                });
            }
        }
        
        function loadProjectName() {
            const projectName = localStorage.getItem('projectName') || 'CSF Manager';
            updateProjectName(projectName);
        }
        
        function updateProjectName(name) {
            const loginProjectName = document.getElementById('loginProjectName');
            const sidebarProjectName = document.getElementById('sidebarProjectName');
            
            if (loginProjectName) {
                loginProjectName.textContent = name;
            }
            
            if (sidebarProjectName) {
                sidebarProjectName.textContent = name;
            }
        }
        
        // Aplicar tema ao carregar a p√°gina
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                const savedColorTheme = localStorage.getItem('colorTheme') || 'default';
                applyColorTheme(savedColorTheme);
            });
        } else {
            const savedColorTheme = localStorage.getItem('colorTheme') || 'default';
            applyColorTheme(savedColorTheme);
        }
        
        // Fun√ß√µes de notifica√ß√£o removidas conforme solicitado
        
        // 3. Busca Avan√ßada e Filtros
        function initializeSearchAndFilters() {
            const toggleFiltersBtn = document.getElementById('toggleFiltersBtn');
            const filtersContainer = document.getElementById('filtersContainer');
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            const filterIdInput = document.getElementById('filterId');
            
            if (toggleFiltersBtn && filtersContainer) {
                toggleFiltersBtn.addEventListener('click', () => {
                    filtersContainer.style.display = filtersContainer.style.display === 'none' ? 'grid' : 'none';
                });
            }
            
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', applyFilters);
            }
            
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', () => {
                    currentFilters = {};
                    document.getElementById('filterStatus').value = '';
                    document.getElementById('filterLote').value = '';
                    document.getElementById('filterCurso').value = '';
                    document.getElementById('filterId').value = '';
                    applyFilters();
                });
            }
            
            // Filtro por ID em tempo real (atualiza automaticamente enquanto digita)
            if (filterIdInput) {
                let idFilterTimeout;
                filterIdInput.addEventListener('input', (e) => {
                    clearTimeout(idFilterTimeout);
                    const idValue = e.target.value.trim();
                    
                    // Atualizar filtro imediatamente
                    if (idValue === '') {
                        currentFilters.id = '';
                    } else {
                        currentFilters.id = idValue;
                    }
                    
                    // Aplicar filtro com pequeno delay para melhor performance
                    idFilterTimeout = setTimeout(() => {
                        applyFilters();
                    }, 300);
                });
            }
            
            // Popular selects de filtros
            updateLoteFilter();
            updateCursoFilter();
        }
        
        function applyFilters() {
            // Coletar valores atuais dos filtros
            currentFilters = {
                status: document.getElementById('filterStatus')?.value || '',
                lote: document.getElementById('filterLote')?.value || '',
                curso: document.getElementById('filterCurso')?.value || '',
                id: document.getElementById('filterId')?.value || ''
            };
            
            currentPage = 1;
            if (document.getElementById('coursesPage')?.classList.contains('active')) {
                renderCoursesByLote();
            }
        }
        
        function filterCourses(courses) {
            if (!courses || courses.length === 0) return [];
            
            // Se n√£o houver filtros definidos, retornar todos os cursos
            if (!currentFilters || Object.keys(currentFilters).length === 0) {
                return [...courses];
            }
            
            let filtered = [...courses];
            
            // Filtro por status
            if (currentFilters.status && currentFilters.status !== '') {
                filtered = filtered.filter(c => normalizeStatus(c.status) === currentFilters.status);
            }
            
            // Filtro por LOTE
            if (currentFilters.lote && currentFilters.lote !== '') {
                filtered = filtered.filter(c => {
                    const lote = c.lote || c.loteResponsavel || c.idLote || '';
                    return lote === currentFilters.lote;
                });
            }
            
            // Filtro por Curso
            if (currentFilters.curso && currentFilters.curso !== '') {
                filtered = filtered.filter(c => {
                    const curso = c.curso || c.nome || '';
                    return curso === currentFilters.curso;
                });
            }
            
            // Filtro por ID (busca parcial - cont√©m o n√∫mero digitado)
            if (currentFilters.id && currentFilters.id !== '') {
                const filterId = String(currentFilters.id).trim().toLowerCase();
                filtered = filtered.filter(c => {
                    // Buscar no ID do curso (case-insensitive)
                    const courseId = String(c.id || '').trim().toLowerCase();
                    if (courseId.includes(filterId)) {
                        return true;
                    }
                    
                    // Tamb√©m buscar no idLote se for n√∫mero
                    const idLote = String(c.idLote || '').trim().toLowerCase();
                    if (idLote && idLote.includes(filterId)) {
                        return true;
                    }
                    
                    // Buscar tamb√©m em qualquer parte do ID que contenha o n√∫mero
                    // Por exemplo, se o ID for "course_123_abc" e digitar "123", deve encontrar
                    const fullId = courseId + '_' + idLote;
                    if (fullId.includes(filterId)) {
                        return true;
                    }
                    
                    return false;
                });
            }
            
            return filtered;
        }
        
        function updateLoteFilter() {
            const select = document.getElementById('filterLote');
            if (!select) return;
            
            // Coletar todos os lotes √∫nicos (incluindo dados importados)
            const lotes = [...new Set(cursos.map(c => c.lote || c.loteResponsavel || c.idLote).filter(Boolean))];
            lotes.sort();
            select.innerHTML = '<option value="">Todos</option>' + 
                lotes.map(l => `<option value="${l}">${l}</option>`).join('');
        }
        
        function updateCursoFilter() {
            const select = document.getElementById('filterCurso');
            if (!select) return;
            
            // Coletar todos os cursos √∫nicos (sem repetir nomes, incluindo dados importados)
            const cursosUnicos = [...new Set(cursos.map(c => c.curso || c.nome).filter(Boolean))];
            cursosUnicos.sort();
            select.innerHTML = '<option value="">Todos</option>' + 
                cursosUnicos.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        
        // 4. Pagina√ß√£o
        function initializePagination() {
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            if (prevBtn) prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderCoursesByLote();
                }
            });
            
            if (nextBtn) nextBtn.addEventListener('click', () => {
                currentPage++;
                renderCoursesByLote();
            });
        }
        
        function renderPagination(totalItems) {
            const container = document.getElementById('paginationContainer');
            const pageInfo = document.getElementById('pageInfo');
            
            if (!container) return;
            
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Ocultar pagina√ß√£o se mostrar todos os cursos ou se houver apenas 1 p√°gina
            if (totalPages <= 1 || itemsPerPage >= 10000) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            if (pageInfo) {
                pageInfo.textContent = `P√°gina ${currentPage} de ${totalPages}`;
            }
            
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            if (prevBtn) prevBtn.disabled = currentPage === 1;
            if (nextBtn) nextBtn.disabled = currentPage === totalPages;
        }
        
        // 5. Ordena√ß√£o
        function initializeSorting() {
            const sortSelect = document.getElementById('sortCourses');
            if (sortSelect) {
                sortSelect.addEventListener('change', (e) => {
                    const value = e.target.value;
                    if (value === 'name') currentSort = { field: 'nome', direction: 'asc' };
                    else if (value === 'date') currentSort = { field: 'inicio', direction: 'desc' };
                    else if (value === 'status') currentSort = { field: 'status', direction: 'asc' };
                    else if (value === 'city') currentSort = { field: 'cidade', direction: 'asc' };
                    
                    currentPage = 1;
                    renderCoursesByLote();
                });
            }
        }
        
        function sortCourses(courses) {
            return [...courses].sort((a, b) => {
                // Primeiro: ordenar por data (mais recentes primeiro, sem datas por √∫ltimo)
                const aDate = a.inicio ? new Date(a.inicio).getTime() : null;
                const bDate = b.inicio ? new Date(b.inicio).getTime() : null;
                
                // Cursos sem data v√£o para o final
                if (aDate === null && bDate === null) {
                    // Ambos sem data - usar ordena√ß√£o secund√°ria
                } else if (aDate === null) {
                    return 1; // a (sem data) vai para o final
                } else if (bDate === null) {
                    return -1; // b (sem data) vai para o final
                } else {
                    // Ambos t√™m data - mais recente primeiro (ordem decrescente)
                    if (bDate !== aDate) {
                        return bDate - aDate;
                    }
                }
                
                // Ordena√ß√£o secund√°ria pelo campo selecionado
                let aVal = a[currentSort.field] || '';
                let bVal = b[currentSort.field] || '';
                
                if (currentSort.field === 'inicio' || currentSort.field === 'fim') {
                    aVal = aVal ? new Date(aVal).getTime() : 0;
                    bVal = bVal ? new Date(bVal).getTime() : 0;
                } else {
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();
                }
                
                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }
        
        // 6. Atalhos de Teclado
        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // N√£o processar se estiver digitando em input/textarea (exceto Esc e Ctrl+F)
                if ((e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') && 
                    !(e.key === 'Escape' || (e.ctrlKey && (e.key === 'f' || e.key === 'F')))) {
                    return;
                }
                
                // Ctrl+N: Novo curso
                if (e.ctrlKey && (e.key === 'n' || e.key === 'N')) {
                    e.preventDefault();
                    const btn = document.getElementById('newCourseBtn');
                    if (btn && !btn.disabled) {
                        btn.click();
                    }
                }
                
                
                // Esc: Fechar modais
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.active').forEach(overlay => {
                        overlay.classList.remove('active');
                    });
                    const notificationsPanel = document.getElementById('notificationsPanel');
                    if (notificationsPanel) {
                        notificationsPanel.classList.remove('active');
                    }
                }
            });
        }
        
        // 7. Salvamento autom√°tico de altera√ß√µes
        function initializeAutoSave() {
            // Salvar automaticamente ao detectar mudan√ßas em formul√°rios
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('change', () => {
                    // Salvar automaticamente ap√≥s um pequeno delay
                    setTimeout(() => {
                        autoSaveChanges();
                    }, 500);
                });
            });
            
            // Salvar automaticamente ao sair da p√°gina
            window.addEventListener('beforeunload', () => {
                saveAllChanges();
            });
        }
        
        function autoSaveChanges() {
            // Salvar dados atuais automaticamente
            if (firebaseAvailable) {
                // Firebase salva automaticamente via onSnapshot
                return;
            }
            
            // Salvar no localStorage
            try {
                if (cursos && cursos.length > 0) {
                    localStorage.setItem('cursos', JSON.stringify(cursos));
                }
                if (instrutores && instrutores.length > 0) {
                    localStorage.setItem('instrutores', JSON.stringify(instrutores));
                }
                if (usuarios && usuarios.length > 0) {
                    localStorage.setItem('usuarios', JSON.stringify(usuarios));
                }
            } catch (error) {
                console.error('Erro ao salvar automaticamente:', error);
            }
        }
        
        function saveAllChanges() {
            // Salvar todas as altera√ß√µes pendentes
            autoSaveChanges();
            
            // Se houver formul√°rios abertos, salv√°-los
            const courseForm = document.getElementById('courseForm');
            if (courseForm && courseForm.checkValidity()) {
                // Os formul√°rios j√° s√£o salvos ao submeter, ent√£o apenas garantimos que est√° tudo salvo
            }
        }
        
        // 8. Tooltips
        function initializeTooltips() {
            // Tooltips s√£o adicionados via atributo title ou data-tooltip
            document.querySelectorAll('[data-tooltip]').forEach(el => {
                el.classList.add('tooltip');
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip-content';
                tooltip.textContent = el.dataset.tooltip;
                el.appendChild(tooltip);
            });
        }
        
        // 9. Estat√≠sticas por Per√≠odo
        
        // 10. Backup Autom√°tico
        function initializeBackup() {
            // Backup a cada 5 minutos
            backupInterval = setInterval(() => {
                performBackup();
            }, 5 * 60 * 1000);
            
            // Backup inicial
            performBackup();
        }
        
        function performBackup() {
            try {
                const backup = {
                    timestamp: new Date().toISOString(),
                    cursos: cursos,
                    instrutores: instrutores,
                    usuarios: usuarios,
                    loteNames: loteNames
                };
                
                localStorage.setItem('backup_' + Date.now(), JSON.stringify(backup));
                
                // Manter apenas os 10 backups mais recentes
                const backupKeys = Object.keys(localStorage)
                    .filter(k => k.startsWith('backup_'))
                    .sort()
                    .reverse();
                
                if (backupKeys.length > 10) {
                    backupKeys.slice(10).forEach(k => localStorage.removeItem(k));
                }
                
                console.log('Backup autom√°tico realizado');
            } catch (error) {
                console.error('Erro ao realizar backup:', error);
            }
        }
        
        // 11. Preview antes de importar
        function initializeImportPreview() {
            const excelInput = document.getElementById('excelFileInput');
            if (excelInput) {
                excelInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) {
                        console.log('Nenhum arquivo selecionado');
                        return;
                    }
                    
                    console.log('Arquivo selecionado:', file.name, file.type, file.size);
                    
                    // Validar tipo de arquivo
                    const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                                       'application/vnd.ms-excel',
                                       'application/excel'];
                    const validExtensions = ['.xlsx', '.xls'];
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    
                    if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
                        showToast('Por favor, selecione um arquivo Excel (.xlsx ou .xls)', 'error');
                        excelInput.value = '';
                        return;
                    }
                    
                    // Validar tamanho (m√°ximo 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        showToast('Arquivo muito grande. Tamanho m√°ximo: 10MB', 'error');
                        excelInput.value = '';
                        return;
                    }
                    
                    const fileNameEl = document.getElementById('selectedFileName');
                    const fileInfoBox = document.getElementById('fileInfoBox');
                    if (fileNameEl) fileNameEl.textContent = file.name;
                    if (fileInfoBox) fileInfoBox.classList.add('show');
                    
                    try {
                        console.log('Lendo arquivo Excel...');
                        const data = await readExcelFile(file);
                        console.log('Dados lidos:', data.length, 'linhas');
                        if (data && data.length > 0) {
                            previewData = data;
                            showImportPreview(data);
                        } else {
                            showToast('Arquivo vazio ou sem dados v√°lidos', 'warning');
                            if (fileInfoBox) fileInfoBox.classList.remove('show');
                            excelInput.value = '';
                        }
                    } catch (error) {
                        console.error('Erro ao ler arquivo:', error);
                        showToast('Erro ao ler arquivo Excel: ' + (error.message || 'Erro desconhecido'), 'error');
                        if (fileInfoBox) fileInfoBox.classList.remove('show');
                        excelInput.value = '';
                    }
                });
            } else {
                console.warn('Elemento excelFileInput n√£o encontrado');
            }
            
            // Bot√£o confirmar importa√ß√£o
            const confirmBtn = document.getElementById('confirmImportBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', async () => {
                    if (previewData && previewData.length > 0) {
                        await importPreviewData();
                    } else {
                        showToast('Nenhum dado para importar', 'warning');
                    }
                });
            }
            
            // Bot√£o cancelar
            const cancelBtn = document.getElementById('cancelImportBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    const preview = document.getElementById('importPreview');
                    if (preview) preview.style.display = 'none';
                    previewData = null;
                    const excelInput = document.getElementById('excelFileInput');
                    if (excelInput) excelInput.value = '';
                    const fileInfoBox = document.getElementById('fileInfoBox');
                    if (fileInfoBox) fileInfoBox.classList.remove('show');
                });
            }
        }
        
        async function readExcelFile(file) {
            // Verificar se a biblioteca XLSX est√° dispon√≠vel
            if (typeof XLSX === 'undefined') {
                throw new Error('Biblioteca XLSX n√£o est√° carregada. Por favor, recarregue a p√°gina.');
            }
            
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        if (!e.target || !e.target.result) {
                            reject(new Error('Erro ao ler arquivo: resultado vazio'));
                            return;
                        }
                        
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        if (!workbook.SheetNames || workbook.SheetNames.length === 0) {
                            reject(new Error('Arquivo Excel n√£o cont√©m planilhas'));
                            return;
                        }
                        
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        
                        if (!worksheet) {
                            reject(new Error('Erro ao acessar planilha'));
                            return;
                        }
                        
                        const json = XLSX.utils.sheet_to_json(worksheet, { defval: '', raw: false });
                        
                        if (!json || json.length === 0) {
                            reject(new Error('Planilha vazia ou sem dados'));
                            return;
                        }
                        
                        console.log('Arquivo lido com sucesso:', json.length, 'linhas');
                        resolve(json);
                    } catch (error) {
                        console.error('Erro ao processar arquivo Excel:', error);
                        reject(new Error('Erro ao processar arquivo Excel: ' + (error.message || 'Erro desconhecido')));
                    }
                };
                reader.onerror = (error) => {
                    console.error('Erro ao ler arquivo:', error);
                    reject(new Error('Erro ao ler arquivo: ' + (error.message || 'Erro desconhecido')));
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        function showImportPreview(data) {
            const preview = document.getElementById('importPreview');
            const container = document.getElementById('previewTableContainer');
            
            if (!preview) {
                console.error('Elemento importPreview n√£o encontrado');
                return;
            }
            
            if (!container) {
                console.error('Elemento previewTableContainer n√£o encontrado');
                return;
            }
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="padding: 1rem; color: var(--text-muted);">Nenhum dado encontrado no arquivo</p>';
                preview.style.display = 'block';
                return;
            }
            
            console.log('Exibindo preview de', data.length, 'registros');
            
            // Mostrar primeiras 10 linhas
            const previewData = data.slice(0, 10);
            const headers = Object.keys(previewData[0] || {});
            
            if (headers.length === 0) {
                container.innerHTML = '<p style="padding: 1rem; color: var(--text-muted);">Nenhuma coluna encontrada nos dados</p>';
                preview.style.display = 'block';
                return;
            }
            
            let html = `
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                    Mostrando ${previewData.length} de ${data.length} registros
                </p>
                <div style="overflow-x: auto; max-height: 400px;">
                    <table class="preview-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--surface);">
                                ${headers.map(h => `<th style="padding: 0.5rem; border: 1px solid var(--border); text-align: left;">${h}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${previewData.map(row => `
                                <tr>
                                    ${headers.map(h => `<td style="padding: 0.5rem; border: 1px solid var(--border);">${row[h] !== undefined && row[h] !== null ? String(row[h]) : ''}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            preview.style.display = 'block';
            console.log('Preview exibido com sucesso');
        }
        
        async function importPreviewData() {
            if (!previewData || previewData.length === 0) {
                showToast('Nenhum dado para importar', 'warning');
                return;
            }
            
            const preview = document.getElementById('importPreview');
            if (preview) preview.style.display = 'none';
            
            try {
                await processExcelData(previewData);
                previewData = null;
                
                // Limpar o input de arquivo ap√≥s importa√ß√£o bem-sucedida
                const excelInput = document.getElementById('excelFileInput');
                if (excelInput) excelInput.value = '';
                const fileInfoBox = document.getElementById('fileInfoBox');
                if (fileInfoBox) fileInfoBox.classList.remove('show');
            } catch (error) {
                console.error('Erro ao importar dados:', error);
                showToast('Erro ao importar dados: ' + (error.message || 'Erro desconhecido'), 'error');
            }
        }
        
        async function processExcelData(json) {
            if (!json || json.length === 0) {
                showToast('Nenhum dado para processar', 'warning');
                return;
            }
            
            setLoadingState(true);
            try {
                let imported = 0;
                let errors = [];
                
                console.log('Processando', json.length, 'linhas de dados');
                
                // Reutilizar a l√≥gica de handleExcelUpload
                const batchSize = 10;
                for (let i = 0; i < json.length; i += batchSize) {
                    const batch = json.slice(i, i + batchSize);
                    
                    for (const row of batch) {
                        try {
                            // Reutilizar a mesma l√≥gica de processamento de handleExcelUpload
                            // (copiar a l√≥gica de processamento de linha)
                            const loteValue = row['LOTE'] || row['lote'] || row['Lote'] || row['LOTE-RESPONS√ÅVEL'] || row['lote-responsavel'] || '';
                            
                            // Fun√ß√£o auxiliar para obter valor da coluna
                            function getColumnValue(row, variations) {
                                // Primeiro, tentar varia√ß√µes exatas
                                for (const variation of variations) {
                                    if (row[variation] !== undefined && row[variation] !== null && row[variation] !== '') {
                                        const value = row[variation];
                                        if (value instanceof Date) {
                                            const year = value.getFullYear();
                                            const month = String(value.getMonth() + 1).padStart(2, '0');
                                            const day = String(value.getDate()).padStart(2, '0');
                                            return `${year}-${month}-${day}`;
                                        }
                                        return String(value).trim();
                                    }
                                }
                                
                                // Tentar busca case-insensitive
                                const rowKeys = Object.keys(row);
                                for (const variation of variations) {
                                    const variationLower = variation.toLowerCase().trim();
                                    for (const key of rowKeys) {
                                        if (key.toLowerCase().trim() === variationLower) {
                                            const value = row[key];
                                            if (value !== undefined && value !== null && value !== '') {
                                                if (value instanceof Date) {
                                                    const year = value.getFullYear();
                                                    const month = String(value.getMonth() + 1).padStart(2, '0');
                                                    const day = String(value.getDate()).padStart(2, '0');
                                                    return `${year}-${month}-${day}`;
                                                }
                                                return String(value).trim();
                                            }
                                        }
                                    }
                                }
                                
                                return '';
                            }
                            
                            const endereco = getColumnValue(row, [
                                'ENDERE√áO', 'ENDERECO', 'endere√ßo', 'endereco',
                                'LOCAL DO CURSO', 'local do curso', 'Local do Curso',
                                'LOCAL', 'local', 'Local'
                            ]) || '';
                            
                            const courseData = {
                                curso: getColumnValue(row, ['CURSO', 'curso', 'Curso', 'NOME', 'nome']) || '',
                                idLote: parseInt(getColumnValue(row, ['ID', 'id', 'Id', 'ID POR LOTE', 'id por lote']) || '0') || 0,
                                lote: loteValue,
                                loteResponsavel: loteValue,
                                cidade: getColumnValue(row, ['CIDADE', 'cidade', 'Cidade']) || '',
                                inicio: (() => {
                                    const dateValue = getColumnValue(row, [
                                        'DATA IN√çCIO', 'DATA INICIO', 'data in√≠cio', 'data inicio', 
                                        'IN√çCIO', 'inicio', 'INICIO', 'Data In√≠cio', 'Data Inicio'
                                    ]);
                                    return formatExcelDate(dateValue);
                                })(),
                                fim: (() => {
                                    const dateValue = getColumnValue(row, [
                                        'DATA FIM', 'data fim', 'FIM', 'fim', 'Data Fim'
                                    ]);
                                    return formatExcelDate(dateValue);
                                })(),
                                local: endereco,
                                status: normalizeStatus(getColumnValue(row, ['STATUS', 'status', 'Status']) || 'Pendente'),
                                alunos: parseInt(getColumnValue(row, ['CONCLUDENTES', 'concludentes', 'Concludentes']) || '0') || 0,
                                cargaHoraria: getColumnValue(row, [
                                    'CARGA HOR√ÅRIA', 'carga hor√°ria', 'CARGA HORARIA', 'carga horaria',
                                    'Carga Hor√°ria', 'Carga Horaria'
                                ]) || '',
                                instrutor: getColumnValue(row, ['INSTRUTOR', 'instrutor', 'Instrutor']) || '',
                                telefone: getColumnValue(row, ['TELEFONE', 'telefone', 'Telefone']) || '',
                                driveLink: '',
                                nota: ''
                            };
                            
                            if (firebaseAvailable) {
                                await db.collection('cursos').add(courseData);
                            } else {
                                const newId = 'course_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                                courseData.id = newId;
                                const existingCourses = JSON.parse(localStorage.getItem('cursos') || '[]');
                                existingCourses.push(courseData);
                                localStorage.setItem('cursos', JSON.stringify(existingCourses));
                            }
                            
                            imported++;
                        } catch (error) {
                            errors.push(`Linha ${i + 1}: ${error.message}`);
                        }
                    }
                }
                
                // Atualizar dados
                if (firebaseAvailable) {
                    // Aguardar um pouco para garantir que os dados foram salvos
                    setTimeout(async () => {
                        await loadData();
                        // Atualizar filtros com os novos dados importados
                        updateLoteFilter();
                        updateCursoFilter();
                    }, 500);
                } else {
                    loadFromLocalStorage();
                    // Atualizar filtros com os novos dados importados
                    updateLoteFilter();
                    updateCursoFilter();
                }
                
                // Mostrar mensagem de sucesso
                let message = `${imported} curso${imported !== 1 ? 's' : ''} importado${imported !== 1 ? 's' : ''} com sucesso!`;
                if (errors.length > 0) {
                    message += ` (${errors.length} erro${errors.length !== 1 ? 's' : ''})`;
                }
                showToast(message, errors.length > 0 ? 'warning' : 'success');
                
                // Atualizar renderiza√ß√£o
                requestAnimationFrame(() => {
                    updateKPIs();
                    renderCalendar();
                    renderDashboardReport();
                    if (document.getElementById('coursesPage')?.classList.contains('active')) {
                        renderCoursesByLote();
                    }
                });
            } catch (error) {
                console.error('Erro ao importar dados:', error);
                showToast('Erro ao importar dados: ' + (error.message || 'Erro desconhecido'), 'error');
            } finally {
                setLoadingState(false);
            }
        }
        
        
        // 13. Hist√≥rico de Altera√ß√µes
        function initializeChangeHistory() {
            loadChangeHistory();
        }
        
        function addToChangeHistory(type, entity, changes) {
            const historyItem = {
                id: Date.now(),
                type, // 'create', 'update', 'delete'
                entity, // 'course', 'instructor', 'user'
                changes,
                user: currentUser?.username || 'Sistema',
                timestamp: new Date()
            };
            
            changeHistory.unshift(historyItem);
            if (changeHistory.length > 100) changeHistory.pop();
            
            saveChangeHistory();
        }
        
        function saveChangeHistory() {
            localStorage.setItem('changeHistory', JSON.stringify(changeHistory));
        }
        
        function loadChangeHistory() {
            const saved = localStorage.getItem('changeHistory');
            if (saved) {
                changeHistory = JSON.parse(saved).map(h => ({
                    ...h,
                    timestamp: new Date(h.timestamp)
                }));
            }
        }
        
        function renderChangeHistory() {
            const container = document.getElementById('changeHistoryContainer');
            if (!container) return;
            
            container.innerHTML = `
                <div class="history-timeline">
                    ${changeHistory.slice(0, 50).map(item => `
                        <div class="history-item">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <strong>${item.user}</strong> - ${getHistoryActionText(item.type)} ${item.entity}
                                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">
                                        ${formatTimestamp(item.timestamp)}
                                    </div>
                                </div>
                            </div>
                            ${item.changes && Object.keys(item.changes).length > 0 ? `
                                <div class="history-changes">
                                    ${Object.entries(item.changes).map(([key, value]) => `
                                        <div class="history-change-item">
                                            <span>${key}:</span>
                                            ${value.old ? `<span class="history-change-old">${value.old}</span> ‚Üí ` : ''}
                                            <span class="history-change-new">${value.new || value}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function getHistoryActionText(type) {
            const actions = {
                'create': 'criou',
                'update': 'atualizou',
                'delete': 'excluiu'
            };
            return actions[type] || type;
        }
        
        // Modificar renderCoursesByLote para usar filtros, ordena√ß√£o e pagina√ß√£o
        const originalRenderCoursesByLote = window.renderCoursesByLote;
        window.renderCoursesByLote = function() {
            let coursesToRender = [...cursos];
            
            // Aplicar filtros
            coursesToRender = filterCourses(coursesToRender);
            
            // Aplicar ordena√ß√£o
            coursesToRender = sortCourses(coursesToRender);
            
            // Atualizar contador
            
            // Aplicar pagina√ß√£o
            const totalItems = coursesToRender.length;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            coursesToRender = coursesToRender.slice(startIndex, endIndex);
            
            // Renderizar pagina√ß√£o
            renderPagination(totalItems);
            
            // Chamar fun√ß√£o original com cursos filtrados
            // (precisamos modificar a l√≥gica para aceitar cursos pr√©-filtrados)
            // Por enquanto, vamos manter a l√≥gica original mas aplicar os filtros
            if (originalRenderCoursesByLote) {
                // Salvar cursos filtrados temporariamente
                const originalCursos = cursos;
                cursos = coursesToRender;
                originalRenderCoursesByLote();
                cursos = originalCursos;
            }
        };
        
        // A fun√ß√£o applyFilters j√° coleta os valores dos filtros, ent√£o n√£o precisamos duplicar aqui

        // ========== MELHORIAS SOLICITADAS ==========

        // 1. Anima√ß√µes de loading mais elaboradas
        function showAdvancedLoading(message = 'Carregando...') {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'advancedLoading';
            overlay.innerHTML = `
                <div>
                    <div class="loading-spinner"></div>
                    <div class="loading-content">${message}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function hideAdvancedLoading() {
            const overlay = document.getElementById('advancedLoading');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 300);
            }
        }

        // 2. Feedback visual em a√ß√µes
        function showActionFeedback(message, type = 'success') {
            const feedback = document.createElement('div');
            feedback.className = 'action-feedback';
            feedback.style.background = type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--warning)';
            feedback.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : 'warning'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(feedback);
            setTimeout(() => {
                feedback.style.opacity = '0';
                setTimeout(() => feedback.remove(), 300);
            }, 3000);
        }

        // Fun√ß√µes de notifica√ß√£o removidas conforme solicitado

        // 4. Modo de visualiza√ß√£o - Lista, grid e timeline
        let currentViewMode = 'grid'; // 'grid', 'list', 'timeline'

        function initializeViewModes() {
            const viewModeContainer = document.createElement('div');
            viewModeContainer.className = 'view-mode-selector';
            viewModeContainer.style.cssText = 'display: flex; gap: 8px; margin-bottom: 1rem; align-items: center;';
            viewModeContainer.innerHTML = `
                <span style="margin-right: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">Visualiza√ß√£o:</span>
                <button class="view-mode-btn ${currentViewMode === 'grid' ? 'active' : ''}" data-mode="grid" title="Grid">
                    <span class="material-icons">grid_view</span>
                </button>
                <button class="view-mode-btn ${currentViewMode === 'list' ? 'active' : ''}" data-mode="list" title="Lista">
                    <span class="material-icons">view_list</span>
                </button>
                <button class="view-mode-btn ${currentViewMode === 'timeline' ? 'active' : ''}" data-mode="timeline" title="Timeline">
                    <span class="material-icons">timeline</span>
                </button>
            `;

            // Adicionar estilos para os bot√µes
            if (!document.getElementById('viewModeStyles')) {
                const style = document.createElement('style');
                style.id = 'viewModeStyles';
                style.textContent = `
                    .view-mode-btn {
                        padding: 8px 12px;
                        background: var(--surface);
                        border: 1px solid var(--border);
                        border-radius: 8px;
                        color: var(--text-secondary);
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    .view-mode-btn:hover {
                        background: var(--surface-hover);
                        color: var(--text-primary);
                    }
                    .view-mode-btn.active {
                        background: var(--primary);
                        color: white;
                        border-color: var(--primary);
                    }
                `;
                document.head.appendChild(style);
            }

            const coursesPage = document.getElementById('coursesPage');
            if (coursesPage) {
                const header = coursesPage.querySelector('.page-header');
                if (header && !header.querySelector('.view-mode-selector')) {
                    header.appendChild(viewModeContainer);
                }
            }

            viewModeContainer.querySelectorAll('.view-mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentViewMode = btn.dataset.mode;
                    viewModeContainer.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    localStorage.setItem('viewMode', currentViewMode);
                    renderCoursesByLote();
                });
            });

            // Carregar modo salvo
            const savedMode = localStorage.getItem('viewMode');
            if (savedMode && ['grid', 'list', 'timeline'].includes(savedMode)) {
                currentViewMode = savedMode;
                viewModeContainer.querySelectorAll('.view-mode-btn').forEach(b => {
                    b.classList.toggle('active', b.dataset.mode === currentViewMode);
                });
            }
        }

        // 5. Integra√ß√£o com WhatsApp
        function sendWhatsAppMessage(phone, message) {
            const cleanPhone = phone.replace(/\D/g, '');
            const url = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function openWhatsAppForCourse(courseId) {
            const course = cursos.find(c => c.id === courseId);
            if (!course || !course.instrutor) {
                showToast('Instrutor n√£o encontrado ou sem telefone', 'error');
                return;
            }
            
            const instructor = instrutores.find(i => i.nome === course.instrutor);
            if (!instructor || !instructor.telefone) {
                showToast('Telefone do instrutor n√£o encontrado', 'error');
                return;
            }

            const message = `Ol√° ${instructor.nome}! Gostaria de falar sobre o curso: ${course.curso}`;
            sendWhatsAppMessage(instructor.telefone, message);
        }

        // 6. Backup e restaura√ß√£o - Interface para gerenciar backups
        function initializeBackupManager() {
            const backupSection = document.createElement('div');
            backupSection.className = 'settings-card';
            backupSection.innerHTML = `
                <div class="settings-section-header">
                    <div class="settings-icon-large">
                        <span class="material-icons">backup</span>
                    </div>
                    <div class="settings-header-content">
                        <h3>Backup e Restaura√ß√£o</h3>
                        <p>Gerencie seus backups e restaure dados quando necess√°rio</p>
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary" onclick="createManualBackup()">
                        <span class="material-icons">save</span>
                        Criar Backup Manual
                    </button>
                    <button class="btn btn-secondary" onclick="showBackupList()" style="margin-left: 1rem;">
                        <span class="material-icons">history</span>
                        Ver Backups
                    </button>
                </div>
            `;

            const settingsPage = document.getElementById('settingsPage');
            if (settingsPage) {
                settingsPage.appendChild(backupSection);
            }
        }

        function createManualBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                cursos: cursos,
                instrutores: instrutores,
                usuarios: usuarios,
                loteNames: loteNames
            };
            
            const backupKey = 'manual_backup_' + Date.now();
            localStorage.setItem(backupKey, JSON.stringify(backup));
            showActionFeedback('Backup criado com sucesso!', 'success');
        }

        function showBackupList() {
            const backups = Object.keys(localStorage)
                .filter(k => k.startsWith('backup_') || k.startsWith('manual_backup_'))
                .map(k => ({
                    key: k,
                    data: JSON.parse(localStorage.getItem(k))
                }))
                .sort((a, b) => new Date(b.data.timestamp) - new Date(a.data.timestamp));

            // Criar modal para listar backups
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>Backups Dispon√≠veis</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="backup-list">
                            ${backups.map(backup => `
                                <div class="backup-item" style="padding: 1rem; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${new Date(backup.data.timestamp).toLocaleString('pt-BR')}</strong>
                                            <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.875rem;">
                                                ${backup.data.cursos?.length || 0} cursos, ${backup.data.instrutores?.length || 0} instrutores
                                            </p>
                                        </div>
                                        <button class="btn btn-primary" onclick="restoreBackup('${backup.key}')">
                                            <span class="material-icons">restore</span>
                                            Restaurar
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function restoreBackup(backupKey) {
            if (!confirm('Tem certeza que deseja restaurar este backup? Todos os dados atuais ser√£o substitu√≠dos.')) return;
            
            const backup = JSON.parse(localStorage.getItem(backupKey));
            if (backup) {
                cursos = backup.cursos || [];
                instrutores = backup.instrutores || [];
                usuarios = backup.usuarios || usuarios;
                loteNames = backup.loteNames || {};
                
                saveAllChanges();
                loadData();
                showActionFeedback('Backup restaurado com sucesso!', 'success');
                document.querySelector('.modal-overlay.active')?.remove();
            }
        }

        // 7. Auditoria - Log detalhado
        function logAuditAction(action, details, type = 'info') {
            const auditLog = {
                timestamp: new Date().toISOString(),
                user: currentUser?.name || 'Sistema',
                action: action,
                details: details,
                type: type
            };
            
            let auditLogs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
            auditLogs.push(auditLog);
            
            // Manter apenas os √∫ltimos 1000 logs
            if (auditLogs.length > 1000) {
                auditLogs = auditLogs.slice(-1000);
            }
            
            localStorage.setItem('auditLogs', JSON.stringify(auditLogs));
        }

        function showAuditReport() {
            const auditLogs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal" style="max-width: 1000px; max-height: 90vh;">
                    <div class="modal-header">
                        <h3>Relat√≥rio de Auditoria</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="overflow-y: auto; max-height: 70vh;">
                            ${auditLogs.slice().reverse().map(log => `
                                <div class="audit-log-item" style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <strong>${log.action}</strong>
                                            <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.875rem;">
                                                ${log.details}
                                            </p>
                                            <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.75rem;">
                                                Por: ${log.user} - ${new Date(log.timestamp).toLocaleString('pt-BR')}
                                            </p>
                                        </div>
                                        <span class="status-badge ${log.type}" style="font-size: 0.7rem;">${log.type}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 8. PWA - Service Worker e Manifest
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    // Service worker n√£o dispon√≠vel, continuar normalmente
                });
            });
        }

        // 9. Gestos no mobile - Swipe para a√ß√µes (movido para initializeSwipeGestures principal)


        // 11. Integra√ß√£o com calend√°rio - Lembretes autom√°ticos
        function initializeCalendarIntegration() {
            // Configurar lembretes autom√°ticos
            setupAutomaticReminders();
        }

        function setupAutomaticReminders() {
            // Verificar cursos pr√≥ximos do vencimento diariamente
            setInterval(() => {
                const today = new Date();
                const nextWeek = new Date(today);
                nextWeek.setDate(today.getDate() + 7);

                const upcomingCourses = cursos.filter(course => {
                    if (!course.fim) return false;
                    const endDate = new Date(course.fim);
                    return endDate >= today && endDate <= nextWeek && normalizeStatus(course.status) !== 'Conclu√≠do';
                });

                if (upcomingCourses.length > 0) {
                    // Criar notifica√ß√£o
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification(`Cursos Pr√≥ximos do Vencimento`, {
                            body: `${upcomingCourses.length} curso(s) vence(m) nos pr√≥ximos 7 dias`,
                            icon: '/icon.png',
                            tag: 'course-reminder'
                        });
                    }
                }
            }, 24 * 60 * 60 * 1000); // Verificar uma vez por dia

            // Solicitar permiss√£o para notifica√ß√µes
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Inicializar todas as melhorias
        setTimeout(() => {
            initializeViewModes();
            initializeBackupManager();
            initializeSwipeGestures();
            initializeCalendarIntegration();
        }, 1000);

        // Interceptar a√ß√µes para auditoria
        const originalDeleteCourse = window.deleteCourse;
        window.deleteCourse = function(id) {
            const course = cursos.find(c => c.id === id);
            if (course) {
                logAuditAction('Exclus√£o de Curso', `Curso "${course.curso}" foi exclu√≠do`, 'danger');
            }
            return originalDeleteCourse.apply(this, arguments);
        };

        const originalSaveCourse = window.handleCourseSubmit;
        if (originalSaveCourse) {
            // Log ser√° feito dentro da fun√ß√£o original
        }
    </script>
</body>
</html>
